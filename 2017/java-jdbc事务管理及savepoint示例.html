<!DOCTYPE html>
<html lang="zh_CN"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>JAVA JDBC事务管理及SavePoint示例 | Java面试</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="JAVA JDBC事务管理及SavePoint示例" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="在JDBC教程中，我们学习了如何使用JDBC API进行数据库连接和执行SQL查询。此外，还研究了不同类型的驱动程序，以及如何编写松散耦合的JDBC程序，帮助我们轻松地切换数据库服务器。" />
<meta property="og:description" content="在JDBC教程中，我们学习了如何使用JDBC API进行数据库连接和执行SQL查询。此外，还研究了不同类型的驱动程序，以及如何编写松散耦合的JDBC程序，帮助我们轻松地切换数据库服务器。" />
<link rel="canonical" href="http://www.jfox.info/2017/java-jdbc%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%8F%8Asavepoint%E7%A4%BA%E4%BE%8B.html" />
<meta property="og:url" content="http://www.jfox.info/2017/java-jdbc%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%8F%8Asavepoint%E7%A4%BA%E4%BE%8B.html" />
<meta property="og:site_name" content="Java面试" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-01-01T23:44:12+08:00" />
<script type="application/ld+json">
{"description":"在JDBC教程中，我们学习了如何使用JDBC API进行数据库连接和执行SQL查询。此外，还研究了不同类型的驱动程序，以及如何编写松散耦合的JDBC程序，帮助我们轻松地切换数据库服务器。","@type":"BlogPosting","url":"http://www.jfox.info/2017/java-jdbc%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%8F%8Asavepoint%E7%A4%BA%E4%BE%8B.html","headline":"JAVA JDBC事务管理及SavePoint示例","dateModified":"2017-01-01T23:44:12+08:00","datePublished":"2017-01-01T23:44:12+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.jfox.info/2017/java-jdbc%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%8F%8Asavepoint%E7%A4%BA%E4%BE%8B.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://www.jfox.info/feed.xml" title="Java面试" /></head><body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Java面试</a><nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
          </svg>
        </span>
      </label>

      <div class="trigger"><a class="page-link" href="/about/">About</a></div>
    </nav></div>
</header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">JAVA JDBC事务管理及SavePoint示例</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2017-01-01T23:44:12+08:00" itemprop="datePublished">Jan 1, 2017
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    
<p>在<a href="https://www.jfox.info/go.php?url=http://www.journaldev.com/2471/jdbc-example-tutorial-drivers-connection-statement-resultset">JDBC教程</a>中，我们学习了如何使用JDBC API进行数据库连接和执行SQL查询。此外，还研究了不同类型的驱动程序，以及如何编写松散耦合的JDBC程序，帮助我们轻松地切换数据库服务器。</p>

<p>本教程旨在详细介绍<strong>JDBC事务管理</strong>，以及如何使用<strong>JDBC SavePoint</strong>进行回滚操作。</p>

<p>默认情况下，当我们创建一个数据库连接时，会运行在自动提交模式（Auto-commit）下。这意味着，任何时候我们执行一条SQL完成之后，事务都会自动提交。所以我们执行的每一条SQL都是一个事务，并且如果正在运行DML或者DDL语句，这些改变会在每一条SQL语句结束的时存入数据库。有时候我们想让一组SQL语句成为事务的一部分，那样我们就可以在所有语句运行成功的时候提交，并且如果出现任何异常，这些语句作为事务的一部分，我们可以选择将其全部回滚。</p>

<p>让我们通过一个简单的示例理解一下，这里使用JDBC的事务管理来支持数据的完整性。假设我们有一个名为UserDB的数据库，员工的信息分别存储在两张表中。比如我正在使用MySQL数据库，但是同样可以在Oracle和PostgreSQL等其他的关系型数据库上运行。</p>

<p>数据库表中存储员工信息和地址明细。两张表的DDL脚本如下：</p>

<p><code class="highlighter-rouge">CREATE</code><code class="highlighter-rouge">TABLE</code>``Employee<code class="highlighter-rouge"> (</code></p>

<p><code class="highlighter-rouge">  </code><code class="highlighter-rouge">empId`</code>int<code class="highlighter-rouge">(11) unsigned</code>NOT<code class="highlighter-rouge">NULL</code>,`</p>

<p><code class="highlighter-rouge">  </code>````name``` <code class="highlighter-rouge">varchar</code>(20) <code class="highlighter-rouge">DEFAULT</code>NULL``,`</p>

<p><code class="highlighter-rouge">  </code><code class="highlighter-rouge">PRIMARY</code><code class="highlighter-rouge">KEY</code><code class="highlighter-rouge">(</code>empId<code class="highlighter-rouge">)</code></p>

<p><code class="highlighter-rouge">) ENGINE=InnoDB </code><code class="highlighter-rouge">DEFAULT</code><code class="highlighter-rouge">CHARSET=utf8;</code></p>

<p><code class="highlighter-rouge">CREATE</code><code class="highlighter-rouge">TABLE</code>``Address<code class="highlighter-rouge"> (</code></p>

<p><code class="highlighter-rouge">  </code><code class="highlighter-rouge">empId`</code>int<code class="highlighter-rouge">(11) unsigned</code>NOT<code class="highlighter-rouge">NULL</code>,`</p>

<p><code class="highlighter-rouge">  </code><code class="highlighter-rouge">address`</code>varchar<code class="highlighter-rouge">(20)</code>DEFAULT<code class="highlighter-rouge">NULL</code>,`</p>

<p><code class="highlighter-rouge">  </code><code class="highlighter-rouge">city`</code>varchar<code class="highlighter-rouge">(5)</code>DEFAULT<code class="highlighter-rouge">NULL</code>,`</p>

<p><code class="highlighter-rouge">  </code><code class="highlighter-rouge">country`</code>varchar<code class="highlighter-rouge">(20)</code>DEFAULT<code class="highlighter-rouge">NULL</code>,`</p>

<p><code class="highlighter-rouge">  </code><code class="highlighter-rouge">PRIMARY</code><code class="highlighter-rouge">KEY</code><code class="highlighter-rouge">(</code>empId<code class="highlighter-rouge">)</code></p>

<p><code class="highlighter-rouge">) ENGINE=InnoDB </code><code class="highlighter-rouge">DEFAULT</code><code class="highlighter-rouge">CHARSET=utf8;</code></p>

<p>最终的工程如下图，我们将逐个查看这些类：
<a href="https://www.jfox.info/go.php?url=http://www.jfox.info/wp-content/uploads/2014/02/de2ab3570ed370bbea14c3bce6967248.png"><img src="5299216.png" alt="de2ab3570ed370bbea14c3bce6967248" /></a>
如图所示，在工程的build path中有一个 MySQL JDBC 的jar包，这样就可以连接到MySQL数据库。</p>

<p><strong>DBConnection.java</strong></p>

<p><code class="highlighter-rouge">package</code><code class="highlighter-rouge">com.journaldev.jdbc.transaction;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.Connection;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.DriverManager;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.SQLException;</code></p>

<p><code class="highlighter-rouge">public</code><code class="highlighter-rouge">class</code><code class="highlighter-rouge">DBConnection {</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">final</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">String DB_DRIVER_CLASS = </code><code class="highlighter-rouge">"com.mysql.jdbc.Driver"</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">final</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">String DB_URL = </code><code class="highlighter-rouge">"jdbc:mysql://localhost:3306/UserDB"</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">final</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">String DB_USERNAME = </code><code class="highlighter-rouge">"pankaj"</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">final</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">String DB_PASSWORD = </code><code class="highlighter-rouge">"pankaj123"</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">Connection getConnection() </code><code class="highlighter-rouge">throws</code><code class="highlighter-rouge">ClassNotFoundException,</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">SQLException {</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">Connection con = </code><code class="highlighter-rouge">null</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">Class.forName(DB_DRIVER_CLASS);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">con = DriverManager.getConnection(DB_URL, DB_USERNAME, DB_PASSWORD);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">System.out.println(</code><code class="highlighter-rouge">"DB Connection created successfully"</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">return</code><code class="highlighter-rouge">con;</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">}</code></p>

<p>在DBConnection类中，创建MySQL数据库连接供其他类使用。</p>

<p><strong>EmployeeJDBCInsertExample.java</strong></p>

<p><code class="highlighter-rouge">package</code><code class="highlighter-rouge">com.journaldev.jdbc.transaction;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.Connection;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.PreparedStatement;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.SQLException;</code></p>

<p><code class="highlighter-rouge">public</code><code class="highlighter-rouge">class</code><code class="highlighter-rouge">EmployeeJDBCInsertExample {</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">final</code><code class="highlighter-rouge">String INSERT_EMPLOYEE_QUERY = </code><code class="highlighter-rouge">"insert into Employee (empId, name) values (?,?)"</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">final</code><code class="highlighter-rouge">String INSERT_ADDRESS_QUERY = </code><code class="highlighter-rouge">"insert into Address (empId, address, city, country) values (?,?,?,?)"</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">void</code><code class="highlighter-rouge">main(String[] args) {</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">Connection con = </code><code class="highlighter-rouge">null</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">try</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">con = DBConnection.getConnection();</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">insertEmployeeData(con, </code><code class="highlighter-rouge">1</code><code class="highlighter-rouge">, </code><code class="highlighter-rouge">"Pankaj"</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">insertAddressData(con, </code><code class="highlighter-rouge">1</code><code class="highlighter-rouge">, </code><code class="highlighter-rouge">"Albany Dr"</code><code class="highlighter-rouge">, </code><code class="highlighter-rouge">"San Jose"</code><code class="highlighter-rouge">, </code><code class="highlighter-rouge">"USA"</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">catch</code><code class="highlighter-rouge">(SQLException | ClassNotFoundException e) {</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">e.printStackTrace();</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">finally</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">try</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">if</code><code class="highlighter-rouge">(con != </code><code class="highlighter-rouge">null</code><code class="highlighter-rouge">)</code></p>

<p><code class="highlighter-rouge">                    </code><code class="highlighter-rouge">con.close();</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">catch</code><code class="highlighter-rouge">(SQLException e) {</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">e.printStackTrace();</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">void</code><code class="highlighter-rouge">insertAddressData(Connection con,</code></p>

<p><code class="highlighter-rouge">                                         </code><code class="highlighter-rouge">int</code><code class="highlighter-rouge">id,</code></p>

<p><code class="highlighter-rouge">                                         </code><code class="highlighter-rouge">String address,</code></p>

<p><code class="highlighter-rouge">                                         </code><code class="highlighter-rouge">String city,</code></p>

<p><code class="highlighter-rouge">                                         </code><code class="highlighter-rouge">String country) </code><code class="highlighter-rouge">throws</code><code class="highlighter-rouge">SQLException {</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">PreparedStatement stmt = con.prepareStatement(INSERT_ADDRESS_QUERY);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.setInt(</code><code class="highlighter-rouge">1</code><code class="highlighter-rouge">, id);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.setString(</code><code class="highlighter-rouge">2</code><code class="highlighter-rouge">, address);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.setString(</code><code class="highlighter-rouge">3</code><code class="highlighter-rouge">, city);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.setString(</code><code class="highlighter-rouge">4</code><code class="highlighter-rouge">, country);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.executeUpdate();</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">System.out.println(</code><code class="highlighter-rouge">"Address Data inserted successfully for ID="</code><code class="highlighter-rouge">+ id);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.close();</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">void</code><code class="highlighter-rouge">insertEmployeeData(Connection con, </code><code class="highlighter-rouge">int</code><code class="highlighter-rouge">id, String name)</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">throws</code><code class="highlighter-rouge">SQLException {</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">PreparedStatement stmt = con.prepareStatement(INSERT_EMPLOYEE_QUERY);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.setInt(</code><code class="highlighter-rouge">1</code><code class="highlighter-rouge">, id);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.setString(</code><code class="highlighter-rouge">2</code><code class="highlighter-rouge">, name);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.executeUpdate();</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">System.out.println(</code><code class="highlighter-rouge">"Employee Data inserted successfully for ID="</code><code class="highlighter-rouge">+ id);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.close();</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">}</code></p>

<p>这是一个简单的JDBC程序，向前面创建的Employee表和Address表中插入用户提供的数据。当我们将运行这个程序时，将得到以下输出：</p>

<p><code class="highlighter-rouge">Employee Data inserted successfully </code><code class="highlighter-rouge">for</code><code class="highlighter-rouge">ID=1</code></p>

<p><code class="highlighter-rouge">com.mysql.jdbc.MysqlDataTruncation: Data truncation: Data too long </code><code class="highlighter-rouge">for</code><code class="highlighter-rouge">column </code><code class="highlighter-rouge">'city'</code><code class="highlighter-rouge">at row 1</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:2939)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1623)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1715)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.Connection.execSQL(Connection.java:3249)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1268)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1541)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1455)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1440)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.journaldev.jdbc.transaction.EmployeeJDBCInsertExample.insertAddressData(EmployeeJDBCInsertExample.java:45)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.journaldev.jdbc.transaction.EmployeeJDBCInsertExample.main(EmployeeJDBCInsertExample.java:23)</code></p>

<p>从结果可以看到，在我们试图往Address表中插入数据时，由于输入的值超过了字段的大小，因此抛出了SQLException异常。</p>

<p>如果浏览Employee和Address表的内容，你会发现Employee表有数据，Address表却没有。这是一个严重的问题，因为只有部分数据正确地被插入。并且如果我们再次运行这个程序，它会再次试图向Employee表插入数据，并且引发下面的异常：</p>

<p><code class="highlighter-rouge">com.mysql.jdbc.exceptions.MySQLIntegrityConstraintViolationException: Duplicate entry </code><code class="highlighter-rouge">'1'</code><code class="highlighter-rouge">for</code><code class="highlighter-rouge">key </code><code class="highlighter-rouge">'PRIMARY'</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:931)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:2941)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1623)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1715)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.Connection.execSQL(Connection.java:3249)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1268)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1541)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1455)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1440)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.journaldev.jdbc.transaction.EmployeeJDBCInsertExample.insertEmployeeData(EmployeeJDBCInsertExample.java:57)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.journaldev.jdbc.transaction.EmployeeJDBCInsertExample.main(EmployeeJDBCInsertExample.java:21)</code></p>

<p>所以，我们没有办法把Employee对应的Address数据保存到Address表中。这个程序造成了数据完整性的问题，这也是为什么需要用事务管理来确保两张表都得以成功插入，并且如果发生任何异常全部回滚。</p>

<h1 id="jdbc事务管理">JDBC事务管理</h1>

<p>JDBC API提供了setAutoCommit()方法，通过它我们可以禁用自动提交数据库连接。自动提交应该被禁用，因为只有这样事务才不会自动提交，除非调用了连接的commit()方法。数据库服务器使用表锁来实现事务管理，并且它是一种紧张的资源。因此，在操作完成后应该尽快提交事务。让我们编写另外一个程序，这里我将使用JDBC事务管理特性来保证数据的完整性不被破坏。</p>

<p><strong>EmployeeJDBCTransactionExample.java</strong></p>

<p><code class="highlighter-rouge">package</code><code class="highlighter-rouge">com.journaldev.jdbc.transaction;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.Connection;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.SQLException;</code></p>

<p><code class="highlighter-rouge">public</code><code class="highlighter-rouge">class</code><code class="highlighter-rouge">EmployeeJDBCTransactionExample {</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">void</code><code class="highlighter-rouge">main(String[] args) {</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">Connection con = </code><code class="highlighter-rouge">null</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">try</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">con = DBConnection.getConnection();</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">con.setAutoCommit(</code><code class="highlighter-rouge">false</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">EmployeeJDBCInsertExample.insertEmployeeData(con, </code><code class="highlighter-rouge">1</code><code class="highlighter-rouge">, </code><code class="highlighter-rouge">"Pankaj"</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">EmployeeJDBCInsertExample.insertAddressData(con,</code></p>

<p><code class="highlighter-rouge">                                                        </code><code class="highlighter-rouge">1</code><code class="highlighter-rouge">,</code></p>

<p><code class="highlighter-rouge">                                                        </code><code class="highlighter-rouge">"Albany Dr"</code><code class="highlighter-rouge">,</code></p>

<p><code class="highlighter-rouge">                                                        </code><code class="highlighter-rouge">"San Jose"</code><code class="highlighter-rouge">,</code></p>

<p><code class="highlighter-rouge">                                                        </code><code class="highlighter-rouge">"USA"</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">con.commit();</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">catch</code><code class="highlighter-rouge">(SQLException e) {</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">e.printStackTrace();</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">try</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">con.rollback();</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">System.out.println(</code><code class="highlighter-rouge">"JDBC Transaction rolled back successfully"</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">catch</code><code class="highlighter-rouge">(SQLException e1) {</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">System.out.println(</code><code class="highlighter-rouge">"SQLException in rollback"</code><code class="highlighter-rouge">+ e.getMessage());</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">catch</code><code class="highlighter-rouge">(ClassNotFoundException e) {</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">e.printStackTrace();</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">finally</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">try</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">if</code><code class="highlighter-rouge">(con != </code><code class="highlighter-rouge">null</code><code class="highlighter-rouge">)</code></p>

<p><code class="highlighter-rouge">                    </code><code class="highlighter-rouge">con.close();</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">catch</code><code class="highlighter-rouge">(SQLException e) {</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">e.printStackTrace();</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">}</code></p>

<p>在运行程序之前，请确保你清楚地了解之前插入的数据。当你运行这个程序时，将得到下面的输出：</p>

<p><code class="highlighter-rouge">DB Connection created successfully</code></p>

<p><code class="highlighter-rouge">Employee Data inserted successfully </code><code class="highlighter-rouge">for</code><code class="highlighter-rouge">ID=1</code></p>

<p><code class="highlighter-rouge">com.mysql.jdbc.MysqlDataTruncation: Data truncation: Data too long </code><code class="highlighter-rouge">for</code><code class="highlighter-rouge">column </code><code class="highlighter-rouge">'city'</code><code class="highlighter-rouge">at row 1</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:2939)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1623)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1715)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.Connection.execSQL(Connection.java:3249)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1268)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1541)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1455)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1440)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.journaldev.jdbc.transaction.EmployeeJDBCInsertExample.insertAddressData(EmployeeJDBCInsertExample.java:45)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.journaldev.jdbc.transaction.EmployeeJDBCTransactionExample.main(EmployeeJDBCTransactionExample.java:19)</code></p>

<p><code class="highlighter-rouge">JDBC Transaction rolled back successfully</code></p>

<p>这段输出和前面的程序很像，但是如果你查看数据库表，就会发现数据没有被插入Employee表。现在我们可以修改城市（city）的值，这样它就可以符合字段要求，重新运行程序就能够把数据插到两张表中。注意：只有当两个插入操作都执行成功时，连接才会提交。如果其中任何一个抛出异常，整个事务会回滚。</p>

<h1 id="jdbc-savepoint示例">JDBC Savepoint示例</h1>

<p>有时候一个事务可能是一组复杂的语句，因此可能想要回滚到事务中某个特殊的点。JDBC Savepoint帮我们在事务中创建检查点（checkpoint），这样就可以回滚到指定点。当事务提交或者整个事务回滚后，为事务产生的任何保存点都会自动释放并变为无效。把事务回滚到一个保存点，会使其他所有保存点自动释放并变为无效。</p>

<p>假设我们有一张日志表Logs，用来记录员工信息保存成功的日志。但是因为它只用于日志记录，当插入日志表有任何异常时，我们不希望回滚整个事务。我们来看一下如何用JDBC Savepoint来实现。</p>

<p><code class="highlighter-rouge">CREATE</code><code class="highlighter-rouge">TABLE</code>``Logs<code class="highlighter-rouge"> (</code></p>

<p><code class="highlighter-rouge">  </code><code class="highlighter-rouge">id`</code>int<code class="highlighter-rouge">(3) unsigned</code>NOT<code class="highlighter-rouge">NULL</code>AUTO_INCREMENT,`</p>

<p><code class="highlighter-rouge">  </code><code class="highlighter-rouge">message`</code>varchar<code class="highlighter-rouge">(10)</code>DEFAULT<code class="highlighter-rouge">NULL</code>,`</p>

<p><code class="highlighter-rouge">  </code><code class="highlighter-rouge">PRIMARY</code><code class="highlighter-rouge">KEY</code><code class="highlighter-rouge">(</code>id<code class="highlighter-rouge">)</code></p>

<p><code class="highlighter-rouge">) ENGINE=InnoDB </code><code class="highlighter-rouge">DEFAULT</code><code class="highlighter-rouge">CHARSET=utf8;</code></p>

<p><strong>EmployeeJDBCSavePointExample.java</strong></p>

<p><code class="highlighter-rouge">package</code><code class="highlighter-rouge">com.journaldev.jdbc.transaction;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.Connection;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.PreparedStatement;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.SQLException;</code></p>

<p><code class="highlighter-rouge">import</code><code class="highlighter-rouge">java.sql.Savepoint;</code></p>

<p><code class="highlighter-rouge">public</code><code class="highlighter-rouge">class</code><code class="highlighter-rouge">EmployeeJDBCSavePointExample {</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">final</code><code class="highlighter-rouge">String INSERT_LOGS_QUERY = </code><code class="highlighter-rouge">"insert into Logs (message) values (?)"</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">public</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">void</code><code class="highlighter-rouge">main(String[] args) {</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">Connection con = </code><code class="highlighter-rouge">null</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">Savepoint savepoint = </code><code class="highlighter-rouge">null</code><code class="highlighter-rouge">;</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">try</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">con = DBConnection.getConnection();</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">con.setAutoCommit(</code><code class="highlighter-rouge">false</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">EmployeeJDBCInsertExample.insertEmployeeData(con, </code><code class="highlighter-rouge">2</code><code class="highlighter-rouge">, </code><code class="highlighter-rouge">"Pankaj"</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">EmployeeJDBCInsertExample.insertAddressData(con,</code></p>

<p><code class="highlighter-rouge">                                                        </code><code class="highlighter-rouge">2</code><code class="highlighter-rouge">,</code></p>

<p><code class="highlighter-rouge">                                                        </code><code class="highlighter-rouge">"Albany Dr"</code><code class="highlighter-rouge">,</code></p>

<p><code class="highlighter-rouge">                                                        </code><code class="highlighter-rouge">"SFO"</code><code class="highlighter-rouge">,</code></p>

<p><code class="highlighter-rouge">                                                        </code><code class="highlighter-rouge">"USA"</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">savepoint = con.setSavepoint(</code><code class="highlighter-rouge">"EmployeeSavePoint"</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">insertLogData(con, </code><code class="highlighter-rouge">2</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">con.commit();</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">catch</code><code class="highlighter-rouge">(SQLException e) {</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">e.printStackTrace();</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">try</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">if</code><code class="highlighter-rouge">(savepoint == </code><code class="highlighter-rouge">null</code><code class="highlighter-rouge">) {</code></p>

<p><code class="highlighter-rouge">                    </code><code class="highlighter-rouge">con.rollback();</code></p>

<p><code class="highlighter-rouge">                    </code><code class="highlighter-rouge">System.out.println(</code><code class="highlighter-rouge">"JDBC Transaction rolled back successfully"</code><code class="highlighter-rouge">);</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">} </code><code class="highlighter-rouge">else</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">                    </code><code class="highlighter-rouge">con.rollback(savepoint);</code></p>

<p><code class="highlighter-rouge">                    </code><code class="highlighter-rouge">con.commit();</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">catch</code><code class="highlighter-rouge">(SQLException e1) {</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">System.out.println(</code><code class="highlighter-rouge">"SQLException in rollback"</code><code class="highlighter-rouge">+ e.getMessage());</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">catch</code><code class="highlighter-rouge">(ClassNotFoundException e) {</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">e.printStackTrace();</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">finally</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">try</code><code class="highlighter-rouge">{</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">if</code><code class="highlighter-rouge">(con != </code><code class="highlighter-rouge">null</code><code class="highlighter-rouge">)</code></p>

<p><code class="highlighter-rouge">                    </code><code class="highlighter-rouge">con.close();</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">catch</code><code class="highlighter-rouge">(SQLException e) {</code></p>

<p><code class="highlighter-rouge">                </code><code class="highlighter-rouge">e.printStackTrace();</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">private</code><code class="highlighter-rouge">static</code><code class="highlighter-rouge">void</code><code class="highlighter-rouge">insertLogData(Connection con, </code><code class="highlighter-rouge">int</code><code class="highlighter-rouge">i)</code></p>

<p><code class="highlighter-rouge">            </code><code class="highlighter-rouge">throws</code><code class="highlighter-rouge">SQLException {</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">PreparedStatement stmt = con.prepareStatement(INSERT_LOGS_QUERY);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.setString(</code><code class="highlighter-rouge">1</code><code class="highlighter-rouge">, </code><code class="highlighter-rouge">"Employee information saved successfully for ID"</code><code class="highlighter-rouge">+ i);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.executeUpdate();</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">System.out.println(</code><code class="highlighter-rouge">"Logs Data inserted successfully for ID="</code><code class="highlighter-rouge">+ i);</code></p>

<p><code class="highlighter-rouge">        </code><code class="highlighter-rouge">stmt.close();</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">}</code></p>

<p><code class="highlighter-rouge">}</code></p>

<p>这段程序非常容易理解。在数据成功插入Employee表和Address表后，创建了一个Savepoint。如果抛出SQLException，而Savepoint为空，意味着在执行插入Employee或者Address表时发生了异常，所以需要回滚整个事务。</p>

<p>如果Savepoint不为空，意味着SQLException由插入日志表Logs操作引发，所以只回滚事务到保存点，然后提交。</p>

<p>运行上面的程序，可以看到下面的输出信息：</p>

<p><code class="highlighter-rouge">DB Connection created successfully</code></p>

<p><code class="highlighter-rouge">Employee Data inserted successfully </code><code class="highlighter-rouge">for</code><code class="highlighter-rouge">ID=2</code></p>

<p><code class="highlighter-rouge">Address Data inserted successfully </code><code class="highlighter-rouge">for</code><code class="highlighter-rouge">ID=2</code></p>

<p><code class="highlighter-rouge">com.mysql.jdbc.MysqlDataTruncation: Data truncation: Data too long </code><code class="highlighter-rouge">for</code><code class="highlighter-rouge">column </code><code class="highlighter-rouge">'message'</code><code class="highlighter-rouge">at row 1</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:2939)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1623)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1715)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.Connection.execSQL(Connection.java:3249)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1268)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1541)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1455)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1440)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.journaldev.jdbc.transaction.EmployeeJDBCSavePointExample.insertLogData(EmployeeJDBCSavePointExample.java:73)</code></p>

<p><code class="highlighter-rouge">    </code><code class="highlighter-rouge">at com.journaldev.jdbc.transaction.EmployeeJDBCSavePointExample.main(EmployeeJDBCSavePointExample.java:30)</code></p>

<p>如果查看数据库表，可以看到数据成功地插入到了Employee表和Address表。需要注意的是，我们有更简单的实现方式。当数据成功插入Employee表和Address表时提交事务，使用另一个事务管理插入日志的操作。这只是为了展示Java程序中JDBC Savepoint的用法。</p>

<p>通过上面的链接下载并使用示例项目，可以尝试使用复杂的Savepoint和JDBC事务API以学习更多内容。</p>

<p>参考来源 <a href="https://www.jfox.info/go.php?url=http://www.jfox.info/url.php?url=http%3A%2F%2Fwww.importnew.com%2F8832.html">JDBC事务管理及SavePoint示例 – ImportNew</a>.</p>

  </div><div style="width:300px;height:250px;float:left;">
    <!-- 300_250_1 -->
    <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196"
        data-ad-slot="4142158067"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
<div style="width:300px;height:250px;float:left;">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- 300-250-2 -->
    <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196"
        data-ad-slot="5618891265"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div><a class="u-url" href="/2017/java-jdbc%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%8F%8Asavepoint%E7%A4%BA%E4%BE%8B.html" hidden></a>
</article>
<div class="PageNavigation">
  
  <a class="prev" href="/2017/java-jdbc%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%8F%8Asavepoint%E7%A4%BA%E4%BE%8B.html">&laquo; JAVA JDBC事务管理及SavePoint示例</a>
  
  
  <a class="next" href="/2017/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8javascript%E6%9B%B4%E6%94%B9dom%E5%85%83%E7%B4%A0%E7%9A%84css%E5%B1%9E%E6%80%A7.html">如何使用javascript更改DOM元素的CSS属性 &raquo;</a>
  
</div>
<div class="sfix"><!-- 240x600 -->
<div class="fixedme">
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9477174171188196" data-ad-slot="9597600460"
        data-ad-format="auto"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
<script type="text/javascript">
    function offset(target) {
        var top = 0,
            left = 0

        while (target.offsetParent) {
            top += target.offsetTop
            left += target.offsetLeft
            target = target.offsetParent
        }

        return {
            top: top,
            left: left,
        }
    }
    window.onload = function () {
        var e = document.getElementsByClassName('sfix')[0];
        e.offset = offset(e);

        window.onscroll = function (event) {
            var e = document.getElementsByClassName('sfix')[0];
            if (window.pageYOffset && e.offset && window.pageYOffset > e.offset.top) {
                e.style.position = 'fixed';
                e.style.left = e.offset.left + 'px';
                e.style.right = 'auto';


            } else {
                e.style.position = 'absolute';
                e.style.left = 'auto';
                e.style.right = '-240px';

            }
        }
    }

</script></div>

<style>
  .wrapper {
    position: relative;
  }

  .sfix {
    position: absolute;
    top: 0;
    right: -240px;
    width: 240px;
    height: 600px;
  }

  .PageNavigation {
    font-size: 14px;
    display: block;
    width: auto;
    overflow: hidden;
    clear: both;
  }

  .PageNavigation a {
    display: block;
    width: 50%;
    float: left;
    margin: 1em 0;
  }

  .PageNavigation .next {
    text-align: right;
    float: right;
  }
</style>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Java面试</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Java面试</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
