<!-- build time:Sat Oct 27 2018 21:00:24 GMT+0800 (CST) --><!DOCTYPE html><html class="theme-next muse use-motion"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="description" content="概述前面两章收集了一些java 国际化相关api用法，以及spring MVC对国际化的支持。今天打算采用spring MVC搭建一套支持国际化的demo环境（采用的Spring MVC版本为：4.3.1.RELEASE），代码已经放到github，地址请见文章结尾。主要整合内容包括：1、view层采用的Freemaker。2、使用自定义的formatter，对日期、货币等进行转化。springM"><meta name="keywords" content="JAVA,面试"><meta property="og:type" content="article"><meta property="og:title" content="java国际化之(三)—springMVC+Freemaker demo"><meta property="og:url" content="http://www.jfox.info/2017/java国际化之-三-springmvc-freemaker-demo.html"><meta property="og:site_name" content="java面试"><meta property="og:description" content="概述前面两章收集了一些java 国际化相关api用法，以及spring MVC对国际化的支持。今天打算采用spring MVC搭建一套支持国际化的demo环境（采用的Spring MVC版本为：4.3.1.RELEASE），代码已经放到github，地址请见文章结尾。主要整合内容包括：1、view层采用的Freemaker。2、使用自定义的formatter，对日期、货币等进行转化。springM"><meta property="og:locale" content="zh_CN"><meta property="og:updated_time" content="2018-10-27T12:29:39.341Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="java国际化之(三)—springMVC+Freemaker demo"><meta name="twitter:description" content="概述前面两章收集了一些java 国际化相关api用法，以及spring MVC对国际化的支持。今天打算采用spring MVC搭建一套支持国际化的demo环境（采用的Spring MVC版本为：4.3.1.RELEASE），代码已经放到github，地址请见文章结尾。主要整合内容包括：1、view层采用的Freemaker。2、使用自定义的formatter，对日期、货币等进行转化。springM"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.jfox.info/2017/java国际化之-三-springmvc-freemaker-demo.html"><title>java国际化之(三)—springMVC+Freemaker demo | java面试</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">java面试</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.jfox.info/2017/java国际化之-三-springmvc-freemaker-demo.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hello"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="java面试"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">java国际化之(三)—springMVC+Freemaker demo</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-01T23:49:34+08:00">2017-01-01</time></span></div></header><div class="post-body" itemprop="articleBody"><p><strong>概述</strong></p><p>前面两章收集了一些java 国际化相关api用法，以及spring MVC对国际化的支持。今天打算采用spring MVC搭建一套支持国际化的demo环境（采用的Spring MVC版本为：4.3.1.RELEASE），代码已经放到github，地址请见文章结尾。</p><p>主要整合内容包括：</p><p>1、view层采用的Freemaker。</p><p>2、使用自定义的formatter，对日期、货币等进行转化。</p><p><strong>springMVC 相关配置</strong></p><p>web.xml 配置：主要包含三部分，“Spring 容器的配置”、“Spring mvc 配置”、“spring 字符集处理配置”。完整的内容如下：</p><pre><code>&lt;web-app version=&quot;2.4&quot; xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;&gt;
    &lt;display-name&gt;locale-demo&lt;/display-name&gt;
    &lt;!--  step1 Spring 容器启动器 --&gt;
    &lt;listener&gt;
        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
    &lt;/listener&gt;
    &lt;!-- spring 容器配置 --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;classpath:spring-config.xml&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;!-- step2 Spring mvc 配置 --&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
            &lt;param-value&gt;classpath*:spring-mvc.xml&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;!-- 程序启动时装在该servlet --&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
    &lt;!-- step3 spring character encoding --&gt;
    &lt;filter&gt;
        &lt;filter-name&gt;Character Encoding&lt;/filter-name&gt;
        &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;encoding&lt;/param-name&gt;
            &lt;param-value&gt;UTF-8&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;forceEncoding&lt;/param-name&gt;
            &lt;param-value&gt;true&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;Character Encoding&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;
&lt;/web-app&gt;
</code></pre><p>Spring容器对应的配置文件是：spring-config.xml ，SpringMVC对应的配置文件是spring-mvc.xml。spring-config.xml 可以手动配置bean、指定属性配置文件(.properties)、以及制定其他子配置文件，如：数据库配置文件、工具类配置文件、外部接口配置文件等。本次demo环境，只是整合框架，具体内容根据项目需要再添加。</p><p><strong>spring-config.xml**</strong>内容如下**：</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;GBK&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
                     http://www.springframework.org/schema/beans/spring-beans.xsd&quot;
       default-autowire=&quot;byName&quot;&gt;
&lt;!-- 加载属性配置文件，主要为spring bean实例化 提供配置支持--&gt;
    &lt;bean id=&quot;propertyPlaceholder&quot; class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;
        &lt;property name=&quot;locations&quot;&gt;
            &lt;list&gt;
                &lt;value&gt;classpath:spring-locale.properties&lt;/value&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
    &lt;!--导入其他所需的配置文件 --&gt;
    &lt;!-- &lt;import resource=&quot;spring/*.xml&quot; /&gt; 配置文件尽量根据模块进行拆分--&gt;
&lt;/beans&gt;
</code></pre><p>在手动注入bean时，往往我们需要一些配置参数，比如：数据库用户名、密码等，这些参数都可以提前配置到属性配置文件spring-locale.properties中。本次demo spring-locale.properties为空，根据业务需要添加。</p><p><strong>SpringMVC对应的配置文件spring-mvc.xml</strong>，是本次讲解的重点。整合freemaker、以及国际化支持等都在该配置文件中体现，内容如下：</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;GBK&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
                     http://www.springframework.org/schema/beans/spring-beans.xsd
                                                http://www.springframework.org/schema/context
                     http://www.springframework.org/schema/context/spring-context.xsd
                     http://www.springframework.org/schema/mvc
                     http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;
       default-autowire=&quot;byName&quot;&gt;
    &lt;mvc:annotation-driven /&gt;
    &lt;mvc:default-servlet-handler /&gt;
    &lt;context:component-scan base-package=&quot;com.sky.locale.demo.controller&quot; &gt;
        &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;/&gt;
    &lt;/context:component-scan&gt;
    &lt;mvc:resources mapping=&quot;/css/**&quot; location=&quot;/css/&quot; /&gt;
    &lt;mvc:resources mapping=&quot;/*.html&quot; location=&quot;/&quot; /&gt;
    &lt;!-- Freemarker属性配置--&gt;
    &lt;bean id=&quot;freemarkerConfiguration&quot; class=&quot;org.springframework.beans.factory.config.PropertiesFactoryBean&quot;&gt;
        &lt;property name=&quot;location&quot; value=&quot;classpath:freemarker.properties&quot;/&gt;
    &lt;/bean&gt;
    &lt;bean id=&quot;fmXmlEscape&quot; class=&quot;freemarker.template.utility.XmlEscape&quot; /&gt;
    &lt;!-- Freemarker配置--&gt;
    &lt;bean class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;&gt;
        &lt;property name=&quot;freemarkerSettings&quot; ref=&quot;freemarkerConfiguration&quot;/&gt;
        &lt;property name=&quot;templateLoaderPath&quot;&gt;
            &lt;value&gt;/WEB-INF/view/&lt;/value&gt;
        &lt;/property&gt;
        &lt;property name=&quot;freemarkerVariables&quot;&gt;
            &lt;map&gt;
                &lt;entry key=&quot;xml_escape&quot; value-ref=&quot;fmXmlEscape&quot; /&gt;
            &lt;/map&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
    &lt;!-- 配置freeMarker视图解析器 --&gt;
    &lt;bean id=&quot;viewResolver&quot; class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver&quot;&gt;
        &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerView&quot;/&gt;
        &lt;property name=&quot;contentType&quot; value=&quot;text/html; charset=utf-8&quot;/&gt;
        &lt;property name=&quot;cache&quot; value=&quot;false&quot;/&gt;
        &lt;property name = &quot;suffix&quot; value = &quot;.ftl&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;exposeRequestAttributes&quot; value=&quot;true&quot; /&gt;
        &lt;property name=&quot;exposeSessionAttributes&quot; value=&quot;true&quot; /&gt;
        &lt;property name=&quot;exposeSpringMacroHelpers&quot; value=&quot;true&quot; /&gt;
        &lt;property name=&quot;requestContextAttribute&quot; value=&quot;request&quot;/&gt;
    &lt;/bean&gt;
    &lt;!-- 图片上传 处理--&gt;
    &lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;
        &lt;property name=&quot;defaultEncoding&quot; value=&quot;utf-8&quot; /&gt;
        &lt;property name=&quot;maxUploadSize&quot; value=&quot;10485760000&quot; /&gt;
        &lt;property name=&quot;maxInMemorySize&quot; value=&quot;40960&quot; /&gt;
    &lt;/bean&gt;
    &lt;!-- 国际化资源文件 --&gt;
    &lt;bean id=&quot;messageSource&quot;
          class=&quot;org.springframework.context.support.ReloadableResourceBundleMessageSource&quot;&gt;
        &lt;property name=&quot;basenames&quot; &gt;
            &lt;list&gt;
                &lt;value&gt;/WEB-INF/resource/usermsg&lt;/value&gt;
                &lt;value&gt;/WEB-INF/resource/userlabels&lt;/value&gt;
            &lt;/list&gt;
        &lt;/property&gt;
        &lt;property name=&quot;defaultEncoding&quot; value=&quot;UTF-8&quot;/&gt;
    &lt;/bean&gt;
    &lt;!-- 本地化配置 --&gt;
    &lt;bean id=&quot;localeResolver&quot; class=&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;&gt;
        &lt;property name=&quot;cookieName&quot; value=&quot;clientlanguage&quot;/&gt;
        &lt;property name=&quot;cookieMaxAge&quot; value=&quot;94608000&quot;/&gt;
        &lt;property name=&quot;defaultLocale&quot; value=&quot;en&quot; /&gt;
    &lt;/bean&gt;
    &lt;mvc:annotation-driven conversion-service=&quot;formatService&quot; /&gt;
    &lt;!-- formatter转换配置 --&gt;
    &lt;bean id=&quot;formatService&quot;
          class=&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;&gt;
        &lt;property name=&quot;formatters&quot;&gt;
            &lt;set&gt;
                &lt;!--&lt;bean class=&quot;org.springframework.format.number.CurrencyStyleFormatter&quot;&gt;
                &lt;/bean&gt;
                &lt;bean class=&quot;org.springframework.format.number.NumberStyleFormatter&quot;&gt;
                &lt;/bean&gt;
                &lt;bean class=&quot;org.springframework.format.number.PercentStyleFormatter&quot;&gt;
                &lt;/bean&gt;
                &lt;bean class=&quot;org.springframework.format.datetime.DateFormatter&quot;&gt;
                &lt;/bean&gt; --&gt;
                &lt;bean class=&quot;com.sky.locale.demo.formatter.MyDateFormatter&quot; /&gt;
                &lt;bean class=&quot;com.sky.locale.demo.formatter.MyCurrencyFormatter&quot; /&gt;
            &lt;/set&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre><p>这里主要说下与Freemaker整合的配置，其他关于国际化的配置说明可以参考上一章<a href="/blog/2378813">《</a><a href="/blog/2378813">java国际化之—springMVC(二)》</a>。</p><p>首先看下Freemaker基础配置：</p><pre><code>&lt;!-- Freemarker配置--&gt;
    &lt;bean class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;&gt;
        &lt;property name=&quot;freemarkerSettings&quot; ref=&quot;freemarkerConfiguration&quot;/&gt;
        &lt;property name=&quot;templateLoaderPath&quot;&gt;
            &lt;value&gt;/WEB-INF/view/&lt;/value&gt;
        &lt;/property&gt;
        &lt;property name=&quot;freemarkerVariables&quot;&gt;
            &lt;map&gt;
                &lt;entry key=&quot;xml_escape&quot; value-ref=&quot;fmXmlEscape&quot; /&gt;
            &lt;/map&gt;
        &lt;/property&gt;
&lt;/bean&gt;
</code></pre><p>1、freemarkerSettings属性：设置FreeMarker启动属性配置，可以直接配置，也可以配置到属性文件，这次采用的后者。对应的属性配置为：</p><pre><code>&lt;!-- Freemarker属性配置--&gt;
    &lt;bean id=&quot;freemarkerConfiguration&quot; class=&quot;org.springframework.beans.factory.config.PropertiesFactoryBean&quot;&gt;
        &lt;property name=&quot;location&quot; value=&quot;classpath:freemarker.properties&quot;/&gt;
    &lt;/bean&gt;
</code></pre><p>可以看到读取了属性配置文件freemarker.properties，再来看下中的内容：</p><pre><code>#设置标签类型：square_bracket:[]     auto_detect:[]&lt;&gt;
tag_syntax=auto_detect
#模版缓存时间，单位：秒
template_update_delay=0
default_encoding=UTF-8
output_encoding=UTF-8
locale=zh_CN
#设置数字格式 ，防止出现 000.00
number_format=#
#变量为空时，不会报错
classic_compatible=true
#这个表示每个freemarker的视图页面都会自动引入这个ftl文件。里面定议的就是一些宏，如text文本框，各种form元素
#auto_import=&quot;/WEB-INF/templates/index.ftl&quot; as do
auto_import=&quot;/common/spring.ftl&quot; as spring
</code></pre><p>具体根据自己的需要调整，这里特别说下auto_import=”/common/spring.ftl” as spring，spring.ftl是spring MVC针对Freemaker实现的宏，可以用来读取国际化配置信息等。该文件在spring-webmvc-4.3.1.RELEASE.jar中，具体路径如下：</p><p>将该文件copy到WEB-INF/common路径下，还可以根据自己需要修改和新增宏命令。</p><p>2、templateLoaderPath属性：配置Freemaker模板文件路径前缀，这里配置的/WEB-INF/view/，注意根目录别配置错了。Spring MVC还支持，多种视图一起使用，一般使用二级目录区分，比如：/WEB-INF/vm/对应velocity，/WEB-INF/jsp/ 对应原始jsp 等等。</p><p>3、freemarkerVariables属性：配置Freemaker的自定义标签，这里是个map结构，可以配置多个。</p><p>再来看下Freemaker的视图配置：</p><pre><code>&lt;!-- 配置freeMarker视图解析器 --&gt;
    &lt;bean id=&quot;viewResolver&quot; class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver&quot;&gt;
        &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerView&quot;/&gt;
        &lt;property name=&quot;contentType&quot; value=&quot;text/html; charset=utf-8&quot;/&gt;
        &lt;property name=&quot;cache&quot; value=&quot;false&quot;/&gt;
        &lt;property name = &quot;suffix&quot; value = &quot;.ftl&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;exposeRequestAttributes&quot; value=&quot;true&quot; /&gt;
        &lt;property name=&quot;exposeSessionAttributes&quot; value=&quot;true&quot; /&gt;
        &lt;property name=&quot;exposeSpringMacroHelpers&quot; value=&quot;true&quot; /&gt;
        &lt;property name=&quot;requestContextAttribute&quot; value=&quot;request&quot;/&gt;
    &lt;/bean&gt;
</code></pre><p>如前面所说，你还可以配置多个视图解析器：jsp文件对应的InternalResourceViewResolver解析器，以及velocity对应的VelocityLayoutViewResolver视图解析器，并且Spring MVC允许你配置多个一起使用，根据不同的业务使用不同的视图解析器。</p><p>最终配置相关的目录结构如下：</p><p>国际化配置文件、以及Freemaker模板文件目录结构如下：</p><p>Spring相关配置就说这些吧，关于Freemaker模板文件后面讲解，下面来看看Controller。</p><p><strong>Controller控制器代码</strong></p><p>Controller相关的代码结构如下：</p><p>controller包中对应的是本实例的控制器存放目录，首先来看下UserController，主要处理4类请求：add、save、edit、changelanguage 分别对应：添加用户、保存用户、修改用户、修改语言。具体代码如下：</p><pre><code>@Controller
public class UserController {
    @RequestMapping(value=&quot;add&quot;)
    public String addUser(Model model) {
        model.addAttribute(new User());
        return &quot;/user/UserForm&quot;;
    }
    @RequestMapping(value=&quot;save&quot;)
    public String saveUser(@ModelAttribute User user, BindingResult bindingResult,
                               Model model) {
        UserValidator userValidator = new UserValidator();
        userValidator.validate(user, bindingResult);
        if (bindingResult.hasErrors()) {
            FieldError fieldError = bindingResult.getFieldError();
            System.out.println(&quot;Code:&quot; + fieldError.getCode()
                    + &quot;, field:&quot; + fieldError.getField());
            return &quot;/user/UserForm&quot;;
        }
        // save product here
        model.addAttribute(&quot;org.springframework.validation.BindingResult.user&quot;,new BindException(bindingResult));
        return &quot;/user/UserInfo&quot;;
    }
    /**
     *
     * @param model
     * @return
     */
    @RequestMapping(value=&quot;edit&quot;)
    public String editUser(Model model) {
        //省略从数据库中查询代码
        User user = new User();
        user.setName(&quot;张三&quot;);
        Date now = new Date();
        user.setBirthday(now);
        user.setMoney(new BigDecimal(&quot;12.12&quot;));
        model.addAttribute(&quot;user&quot;,user);
        return &quot;/user/UserForm&quot;;
    }
    @RequestMapping(value = &quot;/changelanguage&quot;, method = RequestMethod.POST)
    public void changeLanguage(@RequestParam String new_lang,HttpServletRequest request, HttpServletResponse response)
    {
        String msg = &quot;&quot;;
        try
        {
            LocaleResolver localeResolver = RequestContextUtils.getLocaleResolver(request);
            if (localeResolver == null) {
                throw new IllegalStateException(&quot;No LocaleResolver found: not in a DispatcherServlet request?&quot;);
            }
            LocaleEditor localeEditor = new LocaleEditor();
            localeEditor.setAsText(new_lang);
            localeResolver.setLocale(request, response, (Locale)localeEditor.getValue());
            msg = &quot;Change Language Success!&quot;;
        }
        catch(Exception ex)
        {
            msg = &quot;error&quot;;
            ex.printStackTrace();
        }
        response.setCharacterEncoding(CharEncoding.UTF_8);
        try {
            response.getWriter().print(msg);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
</code></pre><p><strong>View视图</strong></p><p>这里采用的是Freemaker视图，模板文件主要有两个：</p><p>首先看下UserForm.ftl（UserInfo.ftl文件内容不再累述）：</p><pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;&lt;@spring.message &quot;page.user.title&quot;/&gt; &lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/main.css&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;global&quot;&gt;
&lt;@spring.message &quot;current.locale&quot;/&gt; : ${request.locale}
    &lt;br/&gt;
&lt;@spring.message &quot;select.language&quot;/&gt; : &lt;span&gt;&lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;changeLanguage(&apos;en_GB&apos;)&quot;&gt;EN&lt;/a&gt;&lt;/span&gt;
    |&lt;span&gt;&lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;changeLanguage(&apos;zh_CN&apos;)&quot;&gt;CN&lt;/a&gt;&lt;/span&gt;
    &lt;form name=&quot;user&quot; action=&quot;save&quot; method=&quot;post&quot;&gt;
        &lt;fieldset&gt;
            &lt;legend&gt;&lt;@spring.message &quot;user.form.name&quot;/&gt;&lt;/legend&gt;
            &lt;p&gt;
            &lt;@spring.bind &quot;user.name&quot; /&gt;
                &lt;label for=&quot;name&quot;&gt;&lt;@spring.message &quot;label.userName&quot;/&gt;:&lt;/label&gt;
                &lt;input id=&quot;name&quot; type=&quot;text&quot; name=&quot;name&quot; value=&quot;${user.name}&quot; cssErrorClass=&quot;error&quot;/&gt;
            &lt;@spring.showErrors &quot;&lt;br/&gt;&quot; cssClass=&quot;error&quot;/&gt;
            &lt;/p&gt;
            &lt;p&gt;
            &lt;@spring.bind &quot;user.birthday&quot; /&gt;
                &lt;label for=&quot;birthday&quot;&gt;&lt;@spring.message &quot;label.birthday&quot;/&gt;: &lt;/label&gt;
                &lt;input id=&quot;birthday&quot; type=&quot;text&quot; name=&quot;birthday&quot; value=&quot;&lt;#if (user.birthday)??&gt; ${(user.birthday?datetime)} &lt;/#if&gt;&quot; cssErrorClass=&quot;error&quot;/&gt;
            &lt;@spring.showErrors &quot;&lt;br/&gt;&quot; cssClass=&quot;error&quot;/&gt;
            &lt;/p&gt;
            &lt;p&gt;
            &lt;@spring.bind &quot;user.money&quot; /&gt;
                &lt;label for=&quot;money&quot;&gt;&lt;@spring.message &quot;label.money&quot;/&gt;: &lt;/label&gt;
                &lt;input id=&quot;money&quot; type=&quot;text&quot; name=&quot;money&quot; value=&quot;${(user.money?string.currency)!}&quot; cssErrorClass=&quot;error&quot;/&gt;
            &lt;@spring.showLastError classOrStyle=&quot;error&quot;/&gt;
            &lt;/p&gt;
            &lt;p id=&quot;buttons&quot;&gt;
                &lt;input id=&quot;reset&quot; type=&quot;reset&quot; tabindex=&quot;4&quot;
                       value=&quot;&lt;@spring.message &quot;button.reset&quot;/&gt;&quot;&gt;
                &lt;input id=&quot;submit&quot; type=&quot;submit&quot; tabindex=&quot;5&quot;
                       value=&quot;&lt;@spring.message &quot;button.submit&quot;/&gt;&quot;&gt;
            &lt;/p&gt;
        &lt;/fieldset&gt;
    &lt;/form&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;//misc.360buyimg.com/jdf/lib/jquery-1.6.4.js?t=1705252218&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    function changeLanguage(language)
    {
        $.ajax({
            type: &quot;POST&quot;,
            url:&quot;/changelanguage&quot;,
            data: &quot;new_lang=&quot;+language,
            dataType:&quot;text&quot;,
            async: true,
            error: function(data, error) {alert(&quot;change lang error!&quot;); alert(error)},
            success: function(data)
            {
                window.location.reload();
            }
        });
    }
&lt;/script&gt;
</code></pre><p>需要说明以下几点：</p><p>1、@spring.message，带有这个标记的标签，表面是本地化消息，这里会根据不同的语言选择不同的国际化配置文件，再根据不同的key选择不同的消息。</p><p>比如当前语言为cn_ZH（汉语_中国大陆），对应的配置文件为：usermsg_zh_CN.properties、userlabels_zh_CN.properties。&lt;@spring.message “page.user.title”/&gt;标签中，page.user.title对应的值在userlabels_zh_CN.properties中，配置为：page.user.title=新增用户，该位置的渲染结果即为：“新增用户”。配置文件中的内容，就不贴出来了，感兴趣的可以从文章结尾的github地址中下载。</p><p>2、@spring.bind、@spring.showErrors分别为绑定变量，和显示该变量的错误信息。连同1中的@spring.message 这三个标签都是在spring.ftl中定义的。</p><p>3、Freemaker国际化支持，${(user.birthday?datetime)}、${(user.money?string.currency)} 会根据不同的语言国家，做不同的格式显示。比如中国，货币显示为：￥12.12；英语英国，货币显示为：￡12.12。</p><p>其他关于Freemaker的标签说明，参考其官方文档：<a href="https://www.jfox.info/go.php?url=http://freemarker.org/docs/ref_directive_local.html">http://freemarker.org/docs/ref_directive_local.html</a></p><p>日期、货币国际化处理</p><p>SpringMVC主要通过定义不同Formatter实现对日期、货币等国际化处理。Springmvc 自带对日期、货币国际化处理Formatter实现，我们也可以根据自己业务定义自己的Formatter。</p><p>自定义的日期时间formatter，MyDateFormatter，调用其可以把String格式的日期转换为Date型，比如：可以把英文环境下的“Jun 13, 2017 9:40:57 PM”，以及中文环境下的” 2017-06-13 21:40:57” 转换为相同的Date，实现如下：</p><pre><code>public class MyDateFormatter implements Formatter&lt;Date&gt; {
    @Override
    public Date parse(String s, Locale locale) throws ParseException{
        DateFormat df = DateFormat.getDateTimeInstance(DateFormat.MEDIUM, DateFormat.MEDIUM, locale);
        System.out.println(&quot;parse&quot;);
        try {
            return df.parse(s);
        } catch (ParseException e) {
            throw new IllegalArgumentException(
                    &quot;invalid date format.&quot;);
        }
    }
    @Override
    public String print(Date date, Locale locale) {
        DateFormat df = DateFormat.getDateTimeInstance(DateFormat.MEDIUM, DateFormat.MEDIUM, locale);
        System.out.println(&quot;format&quot;);
        return df.format(date);
}
}
</code></pre><p>自定义的货币处理formatter，MyCurrencyFormatter，可以实现把不同国家带符号的价格转换为BigDecimal，实现如下：</p><pre><code>public class MyCurrencyFormatter implements Formatter&lt;BigDecimal&gt; {
    /**
     * 去掉货币符号，并转换为BigDecimal
     * @param s
     * @param locale
     * @return
     * @throws ParseException
     */
    @Override
    public BigDecimal parse(String s, Locale locale) throws ParseException {
        try {
            NumberFormat curF = NumberFormat.getCurrencyInstance(locale);
            BigDecimal bd = new BigDecimal(curF.parse(s).toString());//去掉货币符号
            return bd;
        } catch (ParseException e) {
            //如果没有带单位 转换会失败，但是如果是数字可以成功转换成BigDecimal，主要是springMVC做了兼容处理
            throw new IllegalArgumentException(
                    &quot;invalid Currency format.&quot;);
        }
    }
    /**
     * 把BigDecimal 转换为对应国家带货币单位的 字符串格式
     * @param bigDecimal
     * @param locale
     * @return
     */
    @Override
    public String print(BigDecimal bigDecimal, Locale locale) {
        NumberFormat curF = NumberFormat.getCurrencyInstance(locale);
        return curF.format(bigDecimal);
}
}
</code></pre></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="4142158067"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="5618891265"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/java开发框架之ninja.html" rel="next" title="【Java开发框架之Ninja】"><i class="fa fa-chevron-left"></i> 【Java开发框架之Ninja】</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/legendshop电商商城系统在技术上有些什么优势.html" rel="prev" title="Legendshop电商商城系统在技术上有些什么优势">Legendshop电商商城系统在技术上有些什么优势 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Hello</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">1358</span> <span class="site-state-item-name">posts</span></a></div></nav></div></section></div></aside><div class="sfix"><div class="fixedme"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9477174171188196" data-ad-slot="9597600460" data-ad-format="auto"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Hello</span></div><div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div><span class="post-meta-divider">|</span><div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script></body></html><!-- rebuild by neat -->