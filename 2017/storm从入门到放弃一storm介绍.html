<!-- build time:Sat Oct 27 2018 21:00:17 GMT+0800 (CST) --><!DOCTYPE html><html class="theme-next muse use-motion"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="description" content="背景:目前就职于国内最大的IT咨询公司，恰巧又是毕业季，所在部门招了100多个应届毕业生，本人要跟部门新人进行为期一个月的大数据入职培训，特此将整理的文档分享出来。原文和作者一起讨论:http://www.cnblogs.com/intsmaze/p/7274361.html微信：intsmazeStorm是一个开源的分布式实时计算系统，可以简单、可靠的处理大量的数据流。Storm支持水平扩展，具"><meta name="keywords" content="JAVA,面试"><meta property="og:type" content="article"><meta property="og:title" content="storm从入门到放弃(一)，storm介绍"><meta property="og:url" content="http://www.jfox.info/2017/storm从入门到放弃一storm介绍.html"><meta property="og:site_name" content="java面试"><meta property="og:description" content="背景:目前就职于国内最大的IT咨询公司，恰巧又是毕业季，所在部门招了100多个应届毕业生，本人要跟部门新人进行为期一个月的大数据入职培训，特此将整理的文档分享出来。原文和作者一起讨论:http://www.cnblogs.com/intsmaze/p/7274361.html微信：intsmazeStorm是一个开源的分布式实时计算系统，可以简单、可靠的处理大量的数据流。Storm支持水平扩展，具"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.jfox.info/2017/1452/85d8bdb.png"><meta property="og:image" content="http://www.jfox.info/2017/1452/c8194ce.png"><meta property="og:image" content="http://www.jfox.info/2017/1452/be4f864.png"><meta property="og:image" content="http://www.jfox.info/2017/1452/1a25b8f.png"><meta property="og:image" content="http://www.jfox.info/2017/1452/61607f7.png"><meta property="og:updated_time" content="2018-10-27T12:29:39.175Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="storm从入门到放弃(一)，storm介绍"><meta name="twitter:description" content="背景:目前就职于国内最大的IT咨询公司，恰巧又是毕业季，所在部门招了100多个应届毕业生，本人要跟部门新人进行为期一个月的大数据入职培训，特此将整理的文档分享出来。原文和作者一起讨论:http://www.cnblogs.com/intsmaze/p/7274361.html微信：intsmazeStorm是一个开源的分布式实时计算系统，可以简单、可靠的处理大量的数据流。Storm支持水平扩展，具"><meta name="twitter:image" content="http://www.jfox.info/2017/1452/85d8bdb.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.jfox.info/2017/storm从入门到放弃一storm介绍.html"><title>storm从入门到放弃(一)，storm介绍 | java面试</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">java面试</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.jfox.info/2017/storm从入门到放弃一storm介绍.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hello"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="java面试"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">storm从入门到放弃(一)，storm介绍</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-01T23:59:12+08:00">2017-01-01</time></span></div></header><div class="post-body" itemprop="articleBody"><p>背景:目前就职于国内最大的IT咨询公司，恰巧又是毕业季，所在部门招了100多个应届毕业生，本人要跟部门新人进行为期一个月的大数据入职培训，特此将整理的文档分享出来。</p><p>原文和作者一起讨论:<a href="https://www.jfox.info/go.php?url=http://www.cnblogs.com/intsmaze/p/7274361.html">http://www.cnblogs.com/intsmaze/p/7274361.html</a></p><p>微信：intsmaze</p><p><img src="/2017/1452/85d8bdb.png" alt=""></p><p>Storm是一个开源的分布式实时计算系统，可以简单、可靠的处理大量的数据流。Storm支持水平扩展，具有高容错性，保证每个消息都会得到处理。</p><p><strong>Storm核心组件</strong></p><p><strong><img src="/2017/1452/c8194ce.png" alt=""></strong><br><strong>Nimbus**</strong>：**负责资源分配和任务调度，Nimbus对任务的分配信息会落到zookeeper上面的目录下。</p><p><strong>Supervisor**</strong>：<strong>负责去zookeeper上的指定目录接受nimbus分配的任务，启动和停止属于自己管理的worker进程。（它是当前物理机器上的管理者）—通过配置文件设置当前supervisor上启动多少个worker。 </strong>Worker<strong>**：</strong>运行具体处理组件逻辑的进程。Worker运行的任务类型只有两种，一种是Spout任务，一种是Bolt任务。<br><strong>Task：</strong>worker中每一个spout/bolt的线程称为一个task. 在storm0.8之后，task不再与物理线程对应，不同spout/bolt的task可能会共享一个物理线程，该线程称为executor。</p><p><strong>Storm一些概念</strong>Topologies ： 拓扑，也俗称一个任务。（可以理解为一个storm集群）Spouts ： 拓扑的消息源。Bolts ： 拓扑的处理逻辑单元。（一个Bolt类会在集群里面很多机器上并发执行）（Spouts ，Bolts 可以理解为storm中的两个组件）tuple：消息元组（是在Spouts ，Bolts中传递数据的一种封装的格式）Streams ： 流Stream groupings ：流的分组策略Tasks ： 任务处理单元Executor :工作线程Workers ：工作进程Configuration ： topology的配置<img src="/2017/1452/be4f864.png" alt=""><strong>Storm中的Workers</strong>一个topology可能会在一个或者多个worker（工作进程）里面执行；一个进程里面会启动多个Executor :工作线程。每个worker是一个物理JVM并且执行整个topology的一部分；在一个物理节点上可以运行一个或多个独立的JVM 进程。一个Topology可以包含一个或多个worker(并行的跑在不同的物理机上), 所以worker process就是执行一个topology的子集, 并且worker只能对应于一个topology。比如，对于并行度是300的topology来说，如果我们使用50个工作进程来执行，那么每个工作进程会处理其中的6个tasks；Storm会尽量均匀的工作分配给所有的worker；一个Executor:工作线程里面可以运行多个相同的task实例。 <strong>Storm中的Tasks</strong>每一个spout和bolt会被当作很多task在整个集群里执行；每一个executor对应到一个线程，在这个线程上运行多个task；stream grouping则是定义怎么从一堆task发射tuple到另外一堆task；可以调用TopologyBuilder类的setSpout和setBolt来设置并行度（也就是有多少个task） <strong>Executors (threads) </strong>在一个worker JVM进程中运行着多个Java线程。一个executor线程可以执行一个或多个tasks。但一般默认每个executor只执行一个task。（开发中也不建议一个executor里面执行多个task.）一个worker可以包含一个或多个executor, 每个component (spout或bolt)至少对应于一个executor, 所以可以说executor执行一个compenent的子集, 同时一个executor只能对应于一个component。</p><p><strong>Storm中的Stream</strong> 消息流stream是storm里的关键抽象；一个消息流是一个没有边界的tuple序列， 而这些tuple序列会以一种分布式的方式并行地创建和处理；通过对stream中tuple序列中每个字段命名来定义stream。 在默认的情况下，tuple的字段类型可以是：integer，long，short， byte，string，double，float，boolean和byte array；可以自定义类型（只要实现相应的序列化器）。<img src="/2017/1452/1a25b8f.png" alt="">　　数据从一个节点传到另一个节点，数据是要被序列化的，但在storm中，数据序列化之前，消息必须按照一定的格式传递，这个格式就是一个一个的消息元组。消息元组是源源不断的发送的，这个元组就类似一个list，里面有若干个字段。</p><p><strong>Storm编程模型</strong><br>有向无环图<img src="/2017/1452/61607f7.png" alt=""><br>publicclass RandomSentenceSpout extends BaseRichSpout {</p><pre><code>    publicvoid nextTuple() {
        collector.emit(new Values(&quot;+ - * % /&quot;));
        Utils.sleep(50000);
    }
    ......
}
publicclass SplitSentenceBolt extends BaseBasicBolt {

    publicvoid execute(Tuple input, BasicOutputCollector collector) {
        String sentence = (String)input.getValueByField(&quot;intsmaze&quot;);
        System.out.println(Thread.currentThread().getId()+&quot;    &quot;+sentence);        
    }
    ......
}
publicclass TwoBolt extends BaseBasicBolt { 
    publicvoid execute(Tuple input, BasicOutputCollector collector) {
        String sentence = (String)input.getValueByField(&quot;intsmaze&quot;);
        System.out.println(Thread.currentThread().getId()+&quot;    &quot;+sentence);
    }
      ......
}
publicclass WordCountTopologyMain {
    publicstaticvoid main(String[] args) throws Exception {
        TopologyBuilder builder = new TopologyBuilder();
        builder.setSpout(&quot;spout1&quot;, new RandomSentenceSpout(),1);
        builder.setBolt(&quot;two&quot;, new TwoBolt(),1).shuffleGrouping(&quot;spout1&quot;);
        builder.setBolt(&quot;split1&quot;, new SplitSentenceBolt(),2).shuffleGrouping(&quot;spout1&quot;);

        Config conf = new Config();
        conf.setDebug(false);
        conf.setMaxTaskParallelism(3);
        LocalCluster cluster = new LocalCluster();
        cluster.submitTopology(&quot;word-count&quot;, conf, builder.createTopology());
        }
    }
}
</code></pre><p>可以发现spout每隔一段时间间隔发一份数据，这份数据会被两个bolt同时接收，而不是说这次A bolt接收下次B bolt接收。 同一个bolt业务逻辑如果设置了并行度，他们才会根据分组策略依次接收上游发来的消息。</p><pre><code>----------------84     + - * % /  这个是tow bolt接收
----------------78     + - * % /  这个是split1 bolt 中78线程接收的
----------------80     + - * % /  这个是split1 bolt中线程80接收的。
----------------84     + - * % /
----------------78     + - * % /
----------------84     + - * % /  
</code></pre><p><strong>Storm7种stream grouping</strong>　　Shuffle Grouping: 随机分组,随机派发stream里面的tuple，保证每个bolt接收到的tuple数目大致相同。<br>Fields Grouping：按字段分组，比如按userid来分组，具有同样userid的tuple会被分到相同的Bolts里的一个task，而不同的userid则会被分配到不同的bolts里的task。<br>All Grouping：广播发送，对于每一个tuple，所有的bolts都会收到。<br>Global Grouping：全局分组， 这个tuple被分配到storm中的一个bolt的其中一个task。再具体一点就是分配给id值最低的那个task。<br>Non Grouping：不分组，这stream grouping个分组的意思是说stream不关心到底谁会收到它的tuple。目前这种分组和Shuffle grouping是一样的效果， 有一点不同的是storm会把这个bolt放到这个bolt的订阅者同一个线程里面去执行。<br>Direct Grouping： 直接分组， 这是一种比较特别的分组方法，用这种分组意味着消息的发送者指定由消息接收者的哪个task处理这个消息。只有被声明为Direct Stream的消息流可以声明这种分组方法。而且这种消息tuple必须使用emitDirect方法来发射。消息处理者可以通过TopologyContext来获取处理它的消息的task的id （OutputCollector.emit方法也会返回task的id）。<br>Local or shuffle grouping：如果目标bolt有一个或者多个task在同一个工作进程中，tuple将会被随机发生给这些tasks。否则，和普通的Shuffle Grouping行为一致。<br>conf.setNumWorkers(4) 表示设置了4个worker来执行整个topology的所有组件<br>builder.setBolt(“boltA-intsmaze”,new BoltA(), 4) —-&gt;指明 boltA组件的线程数excutors总共有4个<br>builder.setBolt(“boltB-intsmaze”,new BoltB(), 4) —-&gt;指明 boltB组件的线程数excutors总共有4个<br>builder.setSpout(“randomSpout-intsmaze”,new RandomSpout(), 2) —-&gt;指明randomSpout组件的线程数excutors总共有2个<br>—–意味着整个topology中执行所有组件的总线程数为4+4+2=10个<br>—-worker数量是4个，有可能会出现这样的负载情况，worker-1有2个线程，worker-2有2个线程，worker-3有3个线程，worker-4有3个线程<br>如果指定某个组件的具体task并发实例数<br>builder.setSpout(“randomspout-intsmaze”, new RandomWordSpout(), 4).setNumTasks(8);<br>—-意味着对于这个组件的执行线程excutor来说，一个excutor将执行8/4=2个task，默认情况一个线程执行一个task.</p></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="4142158067"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="5618891265"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/java8新特性lambda表达式函数式接口.html" rel="next" title="Java8新特性Lambda表达式、函数式接口"><i class="fa fa-chevron-left"></i> Java8新特性Lambda表达式、函数式接口</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/springboot十四springboot集成shiro登录认证和权限管理.html" rel="prev" title="SpringBoot(十四)：springboot集成shiro-登录认证和权限管理">SpringBoot(十四)：springboot集成shiro-登录认证和权限管理 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Hello</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">1358</span> <span class="site-state-item-name">posts</span></a></div></nav></div></section></div></aside><div class="sfix"><div class="fixedme"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9477174171188196" data-ad-slot="9597600460" data-ad-format="auto"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Hello</span></div><div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div><span class="post-meta-divider">|</span><div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script></body></html><!-- rebuild by neat -->