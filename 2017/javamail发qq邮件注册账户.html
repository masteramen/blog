<!DOCTYPE html>
<html lang="zh_CN"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>javamail发qq邮件注册账户 | Java面试</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="javamail发qq邮件注册账户" />
<meta property="og:locale" content="zh_CN" />
<link rel="canonical" href="http://www.jfox.info/2017/javamail%E5%8F%91qq%E9%82%AE%E4%BB%B6%E6%B3%A8%E5%86%8C%E8%B4%A6%E6%88%B7.html" />
<meta property="og:url" content="http://www.jfox.info/2017/javamail%E5%8F%91qq%E9%82%AE%E4%BB%B6%E6%B3%A8%E5%86%8C%E8%B4%A6%E6%88%B7.html" />
<meta property="og:site_name" content="Java面试" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-01-01T23:53:32+08:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://www.jfox.info/2017/javamail%E5%8F%91qq%E9%82%AE%E4%BB%B6%E6%B3%A8%E5%86%8C%E8%B4%A6%E6%88%B7.html","headline":"javamail发qq邮件注册账户","dateModified":"2017-01-01T23:53:32+08:00","datePublished":"2017-01-01T23:53:32+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.jfox.info/2017/javamail%E5%8F%91qq%E9%82%AE%E4%BB%B6%E6%B3%A8%E5%86%8C%E8%B4%A6%E6%88%B7.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://www.jfox.info/feed.xml" title="Java面试" /></head><body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Java面试</a><nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
          </svg>
        </span>
      </label>

      <div class="trigger"><a class="page-link" href="/about/">About</a></div>
    </nav></div>
</header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">javamail发qq邮件注册账户</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2017-01-01T23:53:32+08:00" itemprop="datePublished">Jan 1, 2017
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    
<h1 id="javamail-发-qq-邮件注册账户">javamail 发 qq 邮件注册账户</h1>

<p>H2M_LI_HEADER 1、 建数据库、表
H2M_LI_HEADER 2、 User 类（实体类）
H2M_LI_HEADER 3、 UserDao 类（与数据库交互）
H2M_LI_HEADER 4、 SendMailUtils 类（发送邮件）
H2M_LI_HEADER 5、 UUIDUtils（生成随机字符串 code）
H2M_LI_HEADER 6、 RegistServlet（注册账户）
H2M_LI_HEADER 7、 ActiveServlet（激活账户）
H2M_LI_HEADER 8、 index.jsp（输入界面）
H2M_LI_HEADER 9、 success.jsp（成功界面）</p>

<h1 id="具体实现">具体实现</h1>

<h2 id="1-建数据库表">1、 建数据库、表</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">/*
    DROP TABLE IF EXISTS `user`;
    CREATE TABLE `user` (
      `id` int(11) NOT NULL AUTO_INCREMENT,
      `username` varchar(30) NOT NULL,
      `password` varchar(30) NOT NULL,
      `nickname` varchar(30) NOT NULL,
      `email` varchar(30) NOT NULL,
      `state` int(11) DEFAULT '0',
      `code` varchar(64) DEFAULT NULL,
      PRIMARY KEY (`id`)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</span></code></pre></div></div>

<h2 id="2-user-类实体类">2、 User 类（实体类）</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">look</span><span class="o">.</span><span class="na">bean</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">nickname</span><span class="o">;</span><span class="c1">//昵称</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">Integer</span> <span class="n">state</span><span class="o">;</span><span class="c1">//状态</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span><span class="c1">//随机码</span>
        <span class="n">getter</span> <span class="n">and</span> <span class="n">setter</span><span class="o">...</span>
    <span class="o">}</span>
</code></pre></div></div>

<h2 id="3-userdao-类与数据库交互">3、 UserDao 类（与数据库交互）</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">look</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">java.sql.DriverManager</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">java.sql.PreparedStatement</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">com.look.bean.User</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDao</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="n">Connection</span> <span class="n">conn</span><span class="o">;</span>
        <span class="c1">// 获取数据库连接</span>
        <span class="kd">public</span>  <span class="kt">void</span> <span class="nf">getConn</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.mysql.jdbc.Driver"</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:mysql://localhost:3306/javamail"</span><span class="o">;</span>
                <span class="n">String</span> <span class="n">rootname</span> <span class="o">=</span> <span class="s">"root"</span><span class="o">;</span>
                <span class="n">String</span> <span class="n">rootpass</span> <span class="o">=</span> <span class="s">"123456"</span><span class="o">;</span>
                <span class="n">conn</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">rootname</span><span class="o">,</span> <span class="n">rootpass</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// TODO Auto-generated catch block</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// TODO Auto-generated catch block</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">// 注册</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">regist</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"insert into user(username,password,nickname,email,code) values(?,?,?,?,?)"</span><span class="o">;</span>
                <span class="n">PreparedStatement</span> <span class="n">pstmt</span><span class="o">;</span>
                <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
                <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getUsername</span><span class="o">());</span>
                <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">());</span>
                <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getNickname</span><span class="o">());</span>
                <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
                <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getCode</span><span class="o">());</span>
                <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// TODO Auto-generated catch block</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">// 激活</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">activeByCode</span><span class="o">(</span><span class="n">String</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">//状态标志置为1，code置空</span>
            <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"update user set state=1,code=null where code=?"</span><span class="o">;</span>
            <span class="n">PreparedStatement</span> <span class="n">pstmt</span><span class="o">;</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
                <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">code</span><span class="o">);</span>
                <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// TODO Auto-generated catch block</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">// 关闭数据库连接</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">closeConn</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">conn</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// TODO Auto-generated catch block</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p><strong>注</strong>
mysql 的账号密码需要修改为自己的账号密码。</p>

<h2 id="4-sendmailutils-类发送邮件">4、 SendMailUtils 类（发送邮件）</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">look</span><span class="o">.</span><span class="na">util</span><span class="o">;</span>

    <span class="kn">import</span> <span class="nn">java.security.GeneralSecurityException</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">java.util.Properties</span><span class="o">;</span>

    <span class="kn">import</span> <span class="nn">javax.mail.Address</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.mail.Message</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.mail.MessagingException</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.mail.Session</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.mail.Transport</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.mail.internet.InternetAddress</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.mail.internet.MimeMessage</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">com.sun.mail.util.MailSSLSocketFactory</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SendMailUtils</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sendMail</span><span class="o">(</span><span class="n">String</span> <span class="n">to</span><span class="o">,</span> <span class="n">String</span> <span class="n">code</span><span class="o">)</span>
                <span class="kd">throws</span> <span class="n">GeneralSecurityException</span><span class="o">,</span> <span class="n">MessagingException</span> <span class="o">{</span>
            <span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
            <span class="c1">// 开启debug调试</span>
            <span class="c1">// props.setProperty("mail.debug", "true");</span>
            <span class="c1">// 发送服务器需要身份验证</span>
            <span class="n">props</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">"mail.smtp.auth"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
            <span class="c1">// 设置邮件服务器主机名</span>
            <span class="n">props</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">"mail.host"</span><span class="o">,</span> <span class="s">"smtp.qq.com"</span><span class="o">);</span>
            <span class="c1">// 发送邮件协议名称</span>
            <span class="n">props</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">"mail.transport.protocol"</span><span class="o">,</span> <span class="s">"smtp"</span><span class="o">);</span>
            <span class="n">MailSSLSocketFactory</span> <span class="n">sf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MailSSLSocketFactory</span><span class="o">();</span>
            <span class="n">sf</span><span class="o">.</span><span class="na">setTrustAllHosts</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"mail.smtp.ssl.enable"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
            <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"mail.smtp.ssl.socketFactory"</span><span class="o">,</span> <span class="n">sf</span><span class="o">);</span>
            <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
            <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>
            <span class="n">msg</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="s">"本邮件用于测试"</span><span class="o">);</span>
            <span class="c1">// send text to the mail</span>
            <span class="c1">// StringBuilder builder = new StringBuilder();</span>
            <span class="c1">// builder.append("点击测试&lt;a href='http://loc alhost:8080/ssm/listCategory'&gt;listCategory1&lt;/a&gt;");</span>
            <span class="c1">// msg.setText(builder.toString());</span>
            <span class="n">msg</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span>
                    <span class="s">"&lt;a href='http://localhost:8080/javamail/ActiveServlet?code="</span>
                            <span class="o">+</span> <span class="n">code</span> <span class="o">+</span> <span class="s">"'&gt;点我激活&lt;/a&gt;"</span><span class="o">,</span> <span class="s">"text/html;charset=UTF-8"</span><span class="o">);</span>
            <span class="n">msg</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="s">"1478161802@qq.com"</span><span class="o">));</span>
            <span class="n">Transport</span> <span class="n">transport</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getTransport</span><span class="o">();</span>
            <span class="n">transport</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s">"smtp.qq.com"</span><span class="o">,</span> <span class="s">"1478161802@qq.com"</span><span class="o">,</span>
                    <span class="s">"hsvsqhofljqtjgdi"</span><span class="o">);</span>
            <span class="n">transport</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="k">new</span> <span class="n">Address</span><span class="o">[]</span> <span class="o">{</span> <span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="n">to</span><span class="o">)</span> <span class="o">});</span>
            <span class="n">transport</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p><strong>注：</strong>
<code class="highlighter-rouge">msg.setFrom(new InternetAddress("12345678@qq.com"));</code>和<code class="highlighter-rouge">transport.connect("smtp.qq.com", "12345678@qq.com","hsvsqhofljqtjgdi");</code>中的<code class="highlighter-rouge">12345678@qq.com</code>需要替换为你自己的 qq 邮箱，<code class="highlighter-rouge">hsvsqhofljqtjgdi</code>要替换为自己的<strong>授权码</strong>。</p>

<h2 id="5-uuidutils生成随机字符串-code">5、 UUIDUtils（生成随机字符串 code）</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">look</span><span class="o">.</span><span class="na">util</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">UUIDUtils</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getUUID</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="s">"-"</span><span class="o">,</span> <span class="s">""</span><span class="o">)</span>
                    <span class="o">+</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="s">"-"</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<h2 id="6-registservlet注册账户">6、 RegistServlet（注册账户）</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">look</span><span class="o">.</span><span class="na">servlet</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">java.io.PrintWriter</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">java.security.GeneralSecurityException</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.mail.MessagingException</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">com.look.bean.User</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">com.look.dao.UserDao</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">com.look.util.SendMailUtils</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">com.look.util.UUIDUtils</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">RegistServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">init</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 获取数据</span>
            <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">nickname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"nickname"</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"email"</span><span class="o">);</span>
            <span class="c1">// 封装数据</span>
            <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>
            <span class="n">user</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
            <span class="n">user</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
            <span class="n">user</span><span class="o">.</span><span class="na">setNickname</span><span class="o">(</span><span class="n">nickname</span><span class="o">);</span>
            <span class="n">user</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
            <span class="n">user</span><span class="o">.</span><span class="na">setCode</span><span class="o">(</span><span class="n">UUIDUtils</span><span class="o">.</span><span class="na">getUUID</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()</span> <span class="o">+</span> <span class="s">"t"</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="na">getCode</span><span class="o">());</span>
            <span class="c1">// 注册</span>
            <span class="n">UserDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserDao</span><span class="o">();</span>
            <span class="n">dao</span><span class="o">.</span><span class="na">getConn</span><span class="o">();</span>
            <span class="n">dao</span><span class="o">.</span><span class="na">regist</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
            <span class="n">dao</span><span class="o">.</span><span class="na">closeConn</span><span class="o">();</span>
            <span class="c1">// 发送邮件</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">SendMailUtils</span><span class="o">.</span><span class="na">sendMail</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getCode</span><span class="o">());</span>
                <span class="n">request</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">"utf-8"</span><span class="o">);</span>
                <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"text/html;charset=utf-8"</span><span class="o">);</span>
                <span class="n">response</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">"utf-8"</span><span class="o">);</span>
                <span class="n">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">();</span>
                <span class="n">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"&lt;html&gt;&lt;head&gt;&lt;meta charset='utf-8'/&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;邮件已经发送到"</span>
                        <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()</span> <span class="o">+</span> <span class="s">"中，请登录邮箱点击链接完成验证&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span><span class="o">);</span>
                <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">GeneralSecurityException</span> <span class="o">|</span> <span class="n">MessagingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">destroy</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<h2 id="7-activeservlet激活账户">7、 ActiveServlet（激活账户）</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">look</span><span class="o">.</span><span class="na">servlet</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">com.look.dao.UserDao</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ActiveServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span>
    <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">init</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 获取数据</span>
            <span class="n">String</span> <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"code"</span><span class="o">);</span>
            <span class="c1">// 数据库判断对应code是否存在，（这里就不进行判断了，直接进行比对）state=1&amp;code=null代表激活</span>
            <span class="n">UserDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserDao</span><span class="o">();</span>
            <span class="n">dao</span><span class="o">.</span><span class="na">getConn</span><span class="o">();</span>
            <span class="n">dao</span><span class="o">.</span><span class="na">activeByCode</span><span class="o">(</span><span class="n">code</span><span class="o">);</span>
            <span class="n">dao</span><span class="o">.</span><span class="na">closeConn</span><span class="o">();</span>
            <span class="c1">// 重定向success.jsp</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">"success.jsp"</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span>
                        <span class="n">response</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ServletException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">destroy</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<h2 id="8-indexjsp输入界面">8、 index.jsp（输入界面）</h2>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">language=</span><span class="s">"java"</span> <span class="na">contentType=</span><span class="s">"text/html; charset=UTF-8"</span>
        <span class="na">pageEncoding=</span><span class="s">"UTF-8"</span><span class="err">%</span><span class="nt">&gt;</span>
    <span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//Dli HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dli"&gt;</span>
    <span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"Content-Type"</span> <span class="na">content=</span><span class="s">"text/html; charset=UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Insert title here<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"RegistServlet"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ul&gt;</span>
                <span class="nt">&lt;li&gt;&lt;label</span> <span class="na">for=</span><span class="s">"username"</span><span class="nt">&gt;</span>账号<span class="nt">&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="nt">/&gt;&lt;/li&gt;</span>
                <span class="nt">&lt;li&gt;&lt;label</span> <span class="na">for=</span><span class="s">"password"</span><span class="nt">&gt;</span>密码<span class="nt">&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="nt">/&gt;&lt;/li&gt;</span>
                <span class="nt">&lt;li&gt;&lt;label</span> <span class="na">for=</span><span class="s">"nickname"</span><span class="nt">&gt;</span>昵称<span class="nt">&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"nickname"</span> <span class="nt">/&gt;&lt;/li&gt;</span>
                <span class="nt">&lt;li&gt;&lt;label</span> <span class="na">for=</span><span class="s">"email"</span><span class="nt">&gt;</span>邮箱<span class="nt">&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="nt">/&gt;&lt;/li&gt;</span>
                <span class="nt">&lt;li&gt;&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"注册"</span> <span class="nt">/&gt;&lt;/li&gt;</span>
                <span class="nt">&lt;li&gt;&lt;input</span> <span class="na">type=</span><span class="s">"reset"</span> <span class="na">name=</span><span class="s">"重写"</span> <span class="nt">/&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h2 id="9-successjsp成功界面">9、 success.jsp（成功界面）</h2>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">language=</span><span class="s">"java"</span> <span class="na">contentType=</span><span class="s">"text/html; charset=UTF-8"</span>
        <span class="na">pageEncoding=</span><span class="s">"UTF-8"</span><span class="err">%</span><span class="nt">&gt;</span>
    <span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span>
    <span class="nt">&lt;html&gt;</span>
     <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;title&gt;</span>成功激活<span class="nt">&lt;/title&gt;</span>
     <span class="nt">&lt;/head&gt;</span>
     <span class="nt">&lt;body&gt;</span>
      <span class="nt">&lt;script&gt;</span>
       <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">"已成功激活"</span><span class="p">);</span>
       <span class="p">};</span>
      <span class="nt">&lt;/script&gt;</span>
     <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h2 id="10webxml">10、web.xml</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
    <span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span> <span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> <span class="na">id=</span><span class="s">"WebApp_ID"</span> <span class="na">version=</span><span class="s">"3.0"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;display-name&gt;</span>javamail<span class="nt">&lt;/display-name&gt;</span>
      <span class="nt">&lt;welcome-file-list&gt;</span>
        <span class="nt">&lt;welcome-file&gt;</span>index.jsp<span class="nt">&lt;/welcome-file&gt;</span>
      <span class="nt">&lt;/welcome-file-list&gt;</span>
      <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>RegistServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>com.look.servlet.RegistServlet<span class="nt">&lt;/servlet-class&gt;</span>
      <span class="nt">&lt;/servlet&gt;</span>
      <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>RegistServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/RegistServlet<span class="nt">&lt;/url-pattern&gt;</span>
      <span class="nt">&lt;/servlet-mapping&gt;</span>
      <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>ActiveServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>com.look.servlet.ActiveServlet<span class="nt">&lt;/servlet-class&gt;</span>
      <span class="nt">&lt;/servlet&gt;</span>
      <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>ActiveServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/ActiveServlet<span class="nt">&lt;/url-pattern&gt;</span>
      <span class="nt">&lt;/servlet-mapping&gt;</span>
    <span class="nt">&lt;/web-app&gt;</span>
</code></pre></div></div>


  </div><div style="width:300px;height:250px;float:left;">
    <!-- 300_250_1 -->
    <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196"
        data-ad-slot="4142158067"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
<div style="width:300px;height:250px;float:left;">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- 300-250-2 -->
    <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196"
        data-ad-slot="5618891265"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div><a class="u-url" href="/2017/javamail%E5%8F%91qq%E9%82%AE%E4%BB%B6%E6%B3%A8%E5%86%8C%E8%B4%A6%E6%88%B7.html" hidden></a>
</article>
<div class="PageNavigation">
  
  <a class="prev" href="/2017/springbootlog4j2%E6%97%A5%E5%BF%97%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85.html">&laquo; Spring Boot Log4j2 日志性能之巅</a>
  
  
  <a class="next" href="/2017/javaopcclient%E5%BC%80%E5%8F%91%E8%B8%A9%E5%9D%91%E8%AE%B0.html">Java OPC client开发踩坑记 &raquo;</a>
  
</div>
<div class="sfix"><!-- 240x600 -->
<div class="fixedme">
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9477174171188196" data-ad-slot="9597600460"
        data-ad-format="auto"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
<script type="text/javascript">
    function offset(target) {
        var top = 0,
            left = 0

        while (target.offsetParent) {
            top += target.offsetTop
            left += target.offsetLeft
            target = target.offsetParent
        }

        return {
            top: top,
            left: left,
        }
    }
    window.onload = function () {
        var e = document.getElementsByClassName('sfix')[0];
        e.offset = offset(e);

        window.onscroll = function (event) {
            var e = document.getElementsByClassName('sfix')[0];
            if (window.pageYOffset && e.offset && window.pageYOffset > e.offset.top) {
                e.style.position = 'fixed';
                e.style.left = e.offset.left + 'px';
                e.style.right = 'auto';


            } else {
                e.style.position = 'absolute';
                e.style.left = 'auto';
                e.style.right = '-240px';

            }
        }
    }

</script></div>

<style>
  .wrapper {
    position: relative;
  }

  .sfix {
    position: absolute;
    top: 0;
    right: -240px;
    width: 240px;
    height: 600px;
  }

  .PageNavigation {
    font-size: 14px;
    display: block;
    width: auto;
    overflow: hidden;
    clear: both;
  }

  .PageNavigation a {
    display: block;
    width: 50%;
    float: left;
    margin: 1em 0;
  }

  .PageNavigation .next {
    text-align: right;
    float: right;
  }
</style>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Java面试</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Java面试</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
