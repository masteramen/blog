<!-- build time:Sat Oct 27 2018 21:00:17 GMT+0800 (CST) --><!DOCTYPE html><html class="theme-next muse use-motion"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="description" content="今天写篇springboot的博客，主要介绍一下springboot搭建以及一些整合。首先介绍springboot搭建，我今天选择Maven，想用Gradle搭建的就自己百度一下吧，访问“http://start.spring.io/”官网。填写好Maven的GroupId以及ArtifactId然后Generate Project。我这次使用的是IntellIj IDEA,导入generate出"><meta name="keywords" content="JAVA,面试"><meta property="og:type" content="article"><meta property="og:title" content="SpringBoot系列一（入门，ORM，Transaction,log4j2等）"><meta property="og:url" content="http://www.jfox.info/2017/springboot系列一入门ormtransactionlog4j2等.html"><meta property="og:site_name" content="java面试"><meta property="og:description" content="今天写篇springboot的博客，主要介绍一下springboot搭建以及一些整合。首先介绍springboot搭建，我今天选择Maven，想用Gradle搭建的就自己百度一下吧，访问“http://start.spring.io/”官网。填写好Maven的GroupId以及ArtifactId然后Generate Project。我这次使用的是IntellIj IDEA,导入generate出"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.jfox.info/2017/1399/593d920.png"><meta property="og:image" content="http://www.jfox.info/2017/1399/b785d67.png"><meta property="og:image" content="http://www.jfox.info/2017/1399/7528a6c.png"><meta property="og:image" content="http://www.jfox.info/2017/1399/26a83f3.png"><meta property="og:image" content="http://www.jfox.info/2017/1399/ca07b79.png"><meta property="og:image" content="http://www.jfox.info/2017/1399/14d3ce6.png"><meta property="og:image" content="http://www.jfox.info/2017/1399/6ec0d65.png"><meta property="og:updated_time" content="2018-10-27T12:29:39.337Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="SpringBoot系列一（入门，ORM，Transaction,log4j2等）"><meta name="twitter:description" content="今天写篇springboot的博客，主要介绍一下springboot搭建以及一些整合。首先介绍springboot搭建，我今天选择Maven，想用Gradle搭建的就自己百度一下吧，访问“http://start.spring.io/”官网。填写好Maven的GroupId以及ArtifactId然后Generate Project。我这次使用的是IntellIj IDEA,导入generate出"><meta name="twitter:image" content="http://www.jfox.info/2017/1399/593d920.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.jfox.info/2017/springboot系列一入门ormtransactionlog4j2等.html"><title>SpringBoot系列一（入门，ORM，Transaction,log4j2等） | java面试</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">java面试</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.jfox.info/2017/springboot系列一入门ormtransactionlog4j2等.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hello"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="java面试"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">SpringBoot系列一（入门，ORM，Transaction,log4j2等）</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-01T23:58:19+08:00">2017-01-01</time></span></div></header><div class="post-body" itemprop="articleBody"><p>今天写篇springboot的博客，主要介绍一下springboot搭建以及一些整合。</p><p>首先介绍springboot搭建，我今天选择Maven，想用Gradle搭建的就自己百度一下吧，访问“<a href="http://start.spring.io/”官网。" target="_blank" rel="noopener">http://start.spring.io/”官网。</a></p><p><img src="/2017/1399/593d920.png" alt=""></p><p>填写好Maven的GroupId以及ArtifactId然后Generate Project。</p><p>我这次使用的是IntellIj IDEA,导入generate出来的project，选择maven导入，一直选next就行了（记得选一下jdk版本，我用的是1.8），eclipse的话直接import project就行了。</p><p>初始的项目结构应该就是一个普通的maven项目，只有一个配置文件就是application.properties，也是springboot整合所有东西的配置文件。</p><p>maven pom文件的依赖只需要以下：</p><dependency><groupid>org.springframework.boot</groupid><artifactid>spring-boot-starter</artifactid></dependency><p><dependency><groupid>org.springframework.boot</groupid><artifactid>spring-boot-starter-test</artifactid><scope>test</scope></dependency><br>如果加入web模块：</p><p><dependency><groupid>org.springframework.boot</groupid><artifactid>spring-boot-starter-web</artifactid></dependency><br>我用的版本是1.5.4</p><p><img src="/2017/1399/b785d67.png" alt=""></p><p>可以按照我上面的项目结构去建立resource文件夹以及package包，注意一点，test和main的根包名需要一致，否则会报错（具体报错可以自己试试）。</p><p>首先来试试最基础的helloworld。</p><p><img src="/2017/1399/7528a6c.png" alt=""><br><img src="/2017/1399/26a83f3.png" alt=""><br>写一个跟SpringMVC类似的controller就可以试试helloworld了，在包的根路径建立一个Application类作为程序入口(springboot的规矩)，也可以直接运行main方法启动springboot，相当于内嵌了tomcat。</p><p>运行起来之后就可以在localhost:8080/hello看到映射结果了。</p><p>如果使用Test访问：</p><p><img src="/2017/1399/ca07b79.png" alt=""></p><p>Mock一下，然后引入</p><pre><code>import static org.hamcrest.Matchers.equalTo;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
具体代码不解释了，看一看能猜出来。
然后来看一下普通restful风格的controller咋写,通俗点说就是我咋用springboot实现springmvc一样的东东

package com.zhengyu.web;

import com.zhengyu.model.User;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * Created by niezy on 2017/7/26.
 */
@RestController
@RequestMapping(value = &quot;/users&quot;) // 通过这里配置使下面的映射都在/users下publicclass UserController {

  // 创建线程安全的Mapstatic Map&lt;Long, User&gt; users = Collections.synchronizedMap(new HashMap&lt;Long, User&gt;());

  @RequestMapping(value = &quot;/&quot;, method = RequestMethod.GET)
  public List&lt;User&gt; getUserList() {
    // 处理&quot;/users/&quot;的GET请求，用来获取用户列表
    // 还可以通过@RequestParam从页面中传递参数来进行查询条件或者翻页信息的传递
    List&lt;User&gt; r = new ArrayList&lt;User&gt;(users.values());
    return r;
  }

  @RequestMapping(value = &quot;/&quot;, method = RequestMethod.POST)
  public String postUser(@ModelAttribute User user) {
    // 处理&quot;/users/&quot;的POST请求，用来创建User
    // 除了@ModelAttribute绑定参数之外，还可以通过@RequestParam从页面中传递参数    users.put(user.getId(), user);
    return &quot;success&quot;;
  }

  @RequestMapping(value = &quot;/{id}&quot;, method = RequestMethod.GET)
  public User getUser(@PathVariable Long id) {
    // 处理&quot;/users/{id}&quot;的GET请求，用来获取url中id值的User信息
    // url中的id可通过@PathVariable绑定到函数的参数中return users.get(id);
  }

  @RequestMapping(value = &quot;/{id}&quot;, method = RequestMethod.PUT)
  public String putUser(@PathVariable Long id, @ModelAttribute User user) {
    // 处理&quot;/users/{id}&quot;的PUT请求，用来更新User信息
    User u = users.get(id);
    u.setName(user.getName());
    u.setAge(user.getAge());
    users.put(id, u);
    return &quot;success&quot;;
  }

  @RequestMapping(value = &quot;/{id}&quot;, method = RequestMethod.DELETE)
  public String deleteUser(@PathVariable Long id) {
    // 处理&quot;/users/{id}&quot;的DELETE请求，用来删除User    users.remove(id);
    return &quot;success&quot;;
  }

}
</code></pre><p>一样的controller如上图，然后开始测试呗</p><pre><code>package com.zhengyu;

import com.zhengyu.web.UserController;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.test.context.web.WebAppConfiguration;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.RequestBuilder;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.setup.MockMvcBuilders;
importstatic org.hamcrest.Matchers.equalTo;
importstatic org.springframework.test.web.servlet.request.MockMvcRequestBuilders.delete;
importstatic org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
importstatic org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;
importstatic org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
importstatic org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
publicclass ApplicationTests {

  private MockMvc mvc;

  @Before
  publicvoid setUp() throws Exception {
    mvc = MockMvcBuilders.standaloneSetup(new UserController()).build();
  }

  @Test
  publicvoid testUserController() throws Exception {
    // 测试UserController
    RequestBuilder request = null;

    // 1、get查一下user列表，应该为空
    request = MockMvcRequestBuilders.get(&quot;/users/&quot;);
    mvc.perform(request).andExpect(status().isOk()).andExpect(content().string(equalTo(&quot;[]&quot;)));

    // 2、post提交一个user
    request = post(&quot;/users/&quot;).param(&quot;id&quot;, &quot;1&quot;).param(&quot;name&quot;, &quot;测试大师&quot;).param(&quot;age&quot;, &quot;20&quot;);
    mvc.perform(request).andExpect(content().string(equalTo(&quot;success&quot;)));

    // 3、get获取user列表，应该有刚才插入的数据
    request = MockMvcRequestBuilders.get(&quot;/users/&quot;);
    mvc.perform(request).andExpect(status().isOk())
        .andExpect(content().string(equalTo(&quot;[{\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;测试大师\&quot;,\&quot;age\&quot;:20}]&quot;)));

    // 4、put修改id为1的user
    request = put(&quot;/users/1&quot;).param(&quot;name&quot;, &quot;测试终极大师&quot;).param(&quot;age&quot;, &quot;30&quot;);
    mvc.perform(request).andExpect(content().string(equalTo(&quot;success&quot;)));

    // 5、get一个id为1的user
    request = MockMvcRequestBuilders.get(&quot;/users/1&quot;);
    mvc.perform(request).andExpect(content().string(equalTo(&quot;{\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;测试终极大师\&quot;,\&quot;age\&quot;:30}&quot;)));

    // 6、del删除id为1的user
    request = delete(&quot;/users/1&quot;);
    mvc.perform(request).andExpect(content().string(equalTo(&quot;success&quot;)));

    // 7、get查一下user列表，应该为空
    request = MockMvcRequestBuilders.get(&quot;/users/&quot;);
    mvc.perform(request).andExpect(status().isOk()).andExpect(content().string(equalTo(&quot;[]&quot;)));

  }



}
</code></pre><p>好咯~</p><pre><code>下面说一下log,spring1.5.4版本是不支持log4j老用法了，我查了一下然后选择的是log4j2xml的方式，pom如下：

&lt;dependency&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
&lt;exclusions&gt;
&lt;exclusion&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
&lt;/exclusion&gt;
&lt;/exclusions&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;
&lt;/dependency&gt;
首先springboot自带的是logback,我们首先更改之前的pom，加上


 &lt;exclusions&gt;
&lt;exclusion&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
&lt;/exclusion&gt;
&lt;/exclusions&gt;

除去logback，然后引入log4j2.
然后在resource文件夹底下新建一个log4j2.xml

&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;
&lt;!--Configuration后面的status，这个用于设置log4j2自身内部的信息输出，可以不设置，当设置成trace时，你会看到log4j2内部各种详细输出--&gt;
&lt;!--monitorInterval：Log4j能够自动检测修改配置 文件和重新配置本身，设置间隔秒数--&gt;
&lt;configuration status=&quot;WARN&quot; monitorInterval=&quot;30&quot;&gt;
    &lt;!--先定义所有的appender--&gt;
    &lt;appenders&gt;
        &lt;!--这个输出控制台的配置--&gt;
        &lt;console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;
            &lt;!--输出日志的格式--&gt;
            &lt;PatternLayout pattern=&quot;[%d{HH:mm:ss:SSS}] [%p] - %l - %m%n&quot;/&gt;
        &lt;/console&gt;
        &lt;!--文件会打印出所有信息，这个log每次运行程序会自动清空，由append属性决定，这个也挺有用的，适合临时测试用--&gt;
        &lt;File name=&quot;log&quot; fileName=&quot;log/test.log&quot; append=&quot;false&quot;&gt;
            &lt;PatternLayout pattern=&quot;%d{HH:mm:ss.SSS} %-5level %class{36} %L %M - %msg%xEx%n&quot;/&gt;
        &lt;/File&gt;
        &lt;!-- 这个会打印出所有的info及以下级别的信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档--&gt;
        &lt;RollingFile name=&quot;RollingFileInfo&quot; fileName=&quot;${sys:user.home}/logs/info.log&quot;
                     filePattern=&quot;${sys:user.home}/logs/$${date:yyyy-MM}/info-%d{yyyy-MM-dd}-%i.log&quot;&gt;
            &lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;
            &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;
            &lt;PatternLayout pattern=&quot;[%d{HH:mm:ss:SSS}] [%p] - %l - %m%n&quot;/&gt;
            &lt;Policies&gt;
                &lt;TimeBasedTriggeringPolicy/&gt;
                &lt;SizeBasedTriggeringPolicy size=&quot;100 MB&quot;/&gt;
            &lt;/Policies&gt;
        &lt;/RollingFile&gt;
        &lt;RollingFile name=&quot;RollingFileWarn&quot; fileName=&quot;${sys:user.home}/logs/warn.log&quot;
                     filePattern=&quot;${sys:user.home}/logs/$${date:yyyy-MM}/warn-%d{yyyy-MM-dd}-%i.log&quot;&gt;
            &lt;ThresholdFilter level=&quot;warn&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;
            &lt;PatternLayout pattern=&quot;[%d{HH:mm:ss:SSS}] [%p] - %l - %m%n&quot;/&gt;
            &lt;Policies&gt;
                &lt;TimeBasedTriggeringPolicy/&gt;
                &lt;SizeBasedTriggeringPolicy size=&quot;100 MB&quot;/&gt;
            &lt;/Policies&gt;
            &lt;!-- DefaultRolloverStrategy属性如不设置，则默认为最多同一文件夹下7个文件，这里设置了20 --&gt;
            &lt;DefaultRolloverStrategy max=&quot;20&quot;/&gt;
        &lt;/RollingFile&gt;
        &lt;RollingFile name=&quot;RollingFileError&quot; fileName=&quot;${sys:user.home}/logs/error.log&quot;
                     filePattern=&quot;${sys:user.home}/logs/$${date:yyyy-MM}/error-%d{yyyy-MM-dd}-%i.log&quot;&gt;
            &lt;ThresholdFilter level=&quot;error&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;
            &lt;PatternLayout pattern=&quot;[%d{HH:mm:ss:SSS}] [%p] - %l - %m%n&quot;/&gt;
            &lt;Policies&gt;
                &lt;TimeBasedTriggeringPolicy/&gt;
                &lt;SizeBasedTriggeringPolicy size=&quot;100 MB&quot;/&gt;
            &lt;/Policies&gt;
        &lt;/RollingFile&gt;
    &lt;/appenders&gt;
    &lt;!--然后定义logger，只有定义了logger并引入的appender，appender才会生效--&gt;
    &lt;loggers&gt;
        &lt;!--过滤掉spring和mybatis的一些无用的DEBUG信息--&gt;
        &lt;logger name=&quot;org.springframework&quot; level=&quot;INFO&quot;&gt;&lt;/logger&gt;
        &lt;logger name=&quot;org.mybatis&quot; level=&quot;INFO&quot;&gt;&lt;/logger&gt;
        &lt;root level=&quot;all&quot;&gt;
            &lt;appender-ref ref=&quot;Console&quot;/&gt;
            &lt;appender-ref ref=&quot;RollingFileInfo&quot;/&gt;
            &lt;appender-ref ref=&quot;RollingFileWarn&quot;/&gt;
            &lt;appender-ref ref=&quot;RollingFileError&quot;/&gt;
        &lt;/root&gt;
    &lt;/loggers&gt;
&lt;/configuration&gt;
</code></pre><p>然后在application.properties配置文件里加上</p><pre><code>logging.config=classpath:log4j2.xml 
其实不加也行，起码我测试这个版本没问题，随便你啦，强迫症的加上吧。
下面说说spring jdbcTemplate


&lt;dependency&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
&lt;version&gt;1.5.2.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;mysql&lt;/groupId&gt;
&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;version&gt;5.1.21&lt;/version&gt;
&lt;/dependency&gt;
加上这个依赖，然后我们开始codeing
</code></pre><p><img src="/2017/1399/14d3ce6.png" alt=""></p><p>建个user类</p><p>application.properties加上：</p><pre><code>spring.datasource.url=jdbc:mysql://localhost:3306/boot
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.jpa.properties.hibernate.hbm2ddl.auto=create-drop
log4j.logger.org.springframework.jdbc.core=DEBUG, file
log4j.logger.org.springframework.jdbc.core.StatementCreatorUtils=TRACE, file
然后建一个UserService，跟springmvc没什么两样

/**
 * Created by niezy on 2017/7/26.
 */publicinterface UserService {
  /**
   * 新增一个用户
   * 
   * @param name
   * @param age
   */void create(String name, Integer age);

  /**
   * 根据name删除一个用户高
   * 
   * @param name
   */void deleteByName(String name);

  /**
   * 获取用户总量
   */
  Integer getAllUsers();

  /**
   * 删除所有用户
   */void deleteAllUsers();

  /**
   * 根据姓名更新年龄
   * @param name
   * @param age
   */void update(String name,int age);


  /**
   * 根据姓名查对象
   * @param name
   * @return*/
  User querySingleUser(String name);



}

/**
 * Created by niezy on 2017/7/26.
 */
@Service
publicclass UserServiceImpl implements UserService {
  @Autowired
  private JdbcTemplate jdbcTemplate;

  @Override
  publicvoid create(String name, Integer age) {
    jdbcTemplate.update(&quot;insert into USER(NAME, AGE) values(?, ?)&quot;, name, age);
  }

  @Override
  publicvoid deleteByName(String name) {
    jdbcTemplate.update(&quot;delete from USER where NAME = ?&quot;, name);
  }

  @Override
  public Integer getAllUsers() {
    return jdbcTemplate.queryForObject(&quot;select count(1) from USER&quot;, Integer.class);
  }

  @Override
  publicvoid deleteAllUsers() {
    jdbcTemplate.update(&quot;delete from USER&quot;);
  }

  @Override
  publicvoid update(String name, int age) {
    jdbcTemplate.update(&quot;update user set age = ? where name=? &quot;, age, name);
  }

  @Override
  public User querySingleUser(String name) {
    User user = new User();
    user.setName(name);
    // 返回对象需要beanPropertyRowMapper映射，查询条件放到Object数组return jdbcTemplate.queryForObject(&quot;select * from user where name=? &quot;, new Object[] {name},
        new BeanPropertyRowMapper&lt;User&gt;(User.class));
  }
}
</code></pre><p>然后测试</p><pre><code>package com.zhengyu;

import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import com.zhengyu.jdbcservice.UserService;

/**
 * Created by niezy on 2017/7/26.
 */


@RunWith(SpringRunner.class)
@SpringBootTest
publicclass JdbcApplicationTests {
  @Autowired
  private UserService userSerivce;

  @Before
  publicvoid setUp() {
    // 准备，清空user表    userSerivce.deleteAllUsers();
  }

  @Test
  publicvoid test() throws Exception {
    // 插入5个用户
    userSerivce.create(&quot;zhangsan&quot;, 18);
    userSerivce.create(&quot;lisi&quot;, 19);
    userSerivce.create(&quot;wangwu&quot;, 20);
    userSerivce.create(&quot;haozi&quot;, 25);
    userSerivce.create(&quot;zhengyu&quot;, 23);
    // 查数据库，应该有5个用户
    Assert.assertEquals(5, userSerivce.getAllUsers().intValue());
    // 删除两个用户
    userSerivce.deleteByName(&quot;zhangsan&quot;);
    userSerivce.deleteByName(&quot;haozi&quot;);
    userSerivce.update(&quot;wangwu&quot;, 28);
    System.out.println(userSerivce.querySingleUser(&quot;zhengyu&quot;).toString());
    // 查数据库，应该有3个用户
    Assert.assertEquals(3, userSerivce.getAllUsers().intValue());
  }
}
</code></pre><p>自己跑一下试试 ~</p><p>jdbcTemplate只有一点注意的，返回对象稍微麻烦点，需要按他的BeanPropertyRowMapper规矩来，其实还有很多种玩法，ORM框架都有很多玩法，包括我进携程以后用的携程的dal框架，返回Object数组啦，集合啦，List<map>等等，说到底都是封装的jdbc，然后有的框架是全mapping，有的是半mapping，包括Hibernate实现的JPA标准，也可以nativeSql支持数组[]选字段返回，也可以直接mapping整个类，甚至级联操作，下次专门写个博客好好说说ORM</map></p><p>插一点事务的东东，springboot整合jpa jdbctempalte等ORM的depency已经自带Transaction注解了，也是默认的</p><p>你可以在@Test处加上</p><pre><code>@Transactional(propagation = Propagation.REQUIRED)
</code></pre><p>然后我们开始spring-data-jpa黑魔法，号称业务操作几乎不需要写任何sql的ORM框架，也是spring进军ORM的产品</p><p>pom：</p><pre><code>&lt;dependency&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
&lt;version&gt;1.5.3.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;javax.persistence&lt;/groupId&gt;
&lt;artifactId&gt;persistence-api&lt;/artifactId&gt;
&lt;version&gt;1.0.2&lt;/version&gt;
&lt;/dependency&gt;
IDEA 1.5.4版本要选择一下jpa的版本，否则会有引不到JPA注解的bug，我当时就被坑了十几分钟，换了很多persistence的depency
老规矩，model开始

package com.zhengyu.model;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.Table;
import java.math.BigDecimal;

/**
 * Created by niezy on 2017/7/26.
 */
@Entity
@Table(name = &quot;student&quot;)
publicclass Student {
  @Id
  @GeneratedValue
  private Long id;
  @Column(nullable = false,length = 5)
  private String name;
  @Column(nullable = false)
  private Integer age;

  @Column(nullable = false)
  private BigDecimal salary;

  @Column(nullable = false)
  private String address;

  public Student() {}

  public Student(String name, Integer age) {
    this.name = name;
    this.age = age;
  }

  public Student(Long id, String name, Integer age) {
    this.id = id;
    this.name = name;
    this.age = age;
  }

  public Student(String name, Integer age, BigDecimal salary, String address) {
    this.name = name;
    this.age = age;
    this.salary = salary;
    this.address = address;
  }

  public BigDecimal getSalary() {
    return salary;
  }

  publicvoid setSalary(BigDecimal salary) {
    this.salary = salary;
  }

  public String getAddress() {
    return address;
  }

  publicvoid setAddress(String address) {
    this.address = address;
  }

  public Long getId() {
    return id;
  }

  publicvoid setId(Long id) {
    this.id = id;
  }

  public String getName() {
    return name;
  }

  publicvoid setName(String name) {
    this.name = name;
  }

  public Integer getAge() {
    return age;
  }

  publicvoid setAge(Integer age) {
    this.age = age;
  }

  @Override
  public String toString() {
    return &quot;Student{&quot; + &quot;id=&quot; + id + &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; + &quot;, age=&quot; + age + &quot;, salary=&quot; + salary + &quot;, address=&apos;&quot;
        + address + &apos;\&apos;&apos; + &apos;}&apos;;
  }
}
</code></pre><p>然后service：</p><pre><code>package com.zhengyu.datajpaservice;

import com.zhengyu.model.Student;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;

import java.math.BigDecimal;
import java.util.List;

/**
 * Created by niezy on 2017/7/26.
 */publicinterface StudentRepository extends JpaRepository&lt;Student, Long&gt; {

  Student findByName(String name);

  List&lt;Student&gt; findListByName(String name);

  Student findByNameAndAge(String name, Integer age);

  @Query(&quot;from Student  where name=:name&quot;)
  Student findStudent(@Param(&quot;name&quot;) String name);

  List&lt;Student&gt; findByNameOrderBySalaryDesc(String name);

  List&lt;Student&gt; findBySalary(BigDecimal salary);

}

测试：

package com.zhengyu;


import com.zhengyu.datajpaservice.StudentRepository;
import com.zhengyu.model.Student;
import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

import java.math.BigDecimal;
import java.util.List;

/**
 * Created by niezy on 2017/7/26.
 */
@RunWith(SpringRunner.class)
@SpringBootTest
publicclass SpringdatajpaTest {
  @Autowired
  private StudentRepository studentRepository;

  // @Before
  // public void setUp() {
  //// 准备工作
  // studentRepository.deleteAll();
  //// }
  @Test
  @Transactional(propagation = Propagation.REQUIRED)
  publicvoid test() throws Exception {

    // 创建10条记录
    studentRepository.save(new Student(&quot;AAA&quot;, 10, new BigDecimal(20000), &quot;shanghai&quot;));
    studentRepository.save(new Student(&quot;BBB&quot;, 20, new BigDecimal(50000), &quot;beijing&quot;));
    studentRepository.save(new Student(&quot;CCC&quot;, 30, new BigDecimal(20000), &quot;shanghai&quot;));
    studentRepository.save(new Student(&quot;DDD&quot;, 40, new BigDecimal(50000), &quot;beijing&quot;));
    studentRepository.save(new Student(&quot;EEE&quot;, 50, new BigDecimal(20000), &quot;shanghai&quot;));
    studentRepository.save(new Student(&quot;EEE&quot;, 60, new BigDecimal(50000), &quot;beijing&quot;));
    studentRepository.save(new Student(&quot;EEE&quot;, 70, new BigDecimal(20000), &quot;shanghai&quot;));
    studentRepository.save(new Student(&quot;FFF&quot;, 60, new BigDecimal(50000), &quot;beijing&quot;));
    studentRepository.save(new Student(&quot;III&quot;, 90, new BigDecimal(20000), &quot;shanghai&quot;));
    studentRepository.save(new Student(&quot;JJJ&quot;, 100, new BigDecimal(50000), &quot;beijing&quot;));

    // 测试findAll, 查询所有记录
    Assert.assertEquals(10, studentRepository.findAll().size());
    // 测试findByName, 查询姓名为FFF的User
    Assert.assertEquals(60, studentRepository.findByName(&quot;FFF&quot;).getAge().longValue());
    // 测试findUser, 查询姓名为FFF的User
    Assert.assertEquals(60, studentRepository.findStudent(&quot;FFF&quot;).getAge().longValue());
    // 测试findByNameAndAge, 查询姓名为FFF并且年龄为60的User
    Assert.assertEquals(&quot;FFF&quot;, studentRepository.findByNameAndAge(&quot;FFF&quot;, 60).getName());
    // 测试删除姓名为AAA的User
    studentRepository.delete(studentRepository.findByName(&quot;AAA&quot;));
    // 测试findAll, 查询所有记录, 验证上面的删除是否成功
    Assert.assertEquals(9, studentRepository.findAll().size());

    // List&lt;Student&gt; stuList = studentRepository.findByNameOrderBySalaryDesc(&quot;EEE&quot;);
    List&lt;Student&gt; stuList = studentRepository.findBySalary(new BigDecimal(20000));
    for (Student stu : stuList) {
      System.out.println(stu.toString());
    }

    List&lt;Student&gt; stuList2 = studentRepository.findListByName(&quot;EEE&quot;);
    for (Student stu : stuList2) {
      System.out.println(stu.toString());
    }


  }
}
</code></pre><p>application.properties加上：</p><pre><code>spring.jpa.properties.hibernate.hbm2ddl.auto=create-drop
关于hbm2ddl:
</code></pre><p><img src="/2017/1399/6ec0d65.png" alt=""></p><p>这个属于hibernate知识点了，我这里选择create-drop。</p><p>关于spring-data-jpa,确实很轻量很给力</p><p>在实际开发过程中，对数据库的操作无非就“增删改查”。就最为普遍的单表操作而言，除了表和字段不同外，语句都是类似的，开发人员需要写大量类似而枯燥的语句来完成业务逻辑。</p><p>为了解决这些大量枯燥的数据操作语句，我们第一个想到的是使用ORM框架，比如：Hibernate。通过整合Hibernate之后，我们以操作Java实体的方式最终将数据改变映射到数据库表中。</p><p>为了解决抽象各个Java实体基本的“增删改查”操作，我们通常会以泛型的方式封装一个模板Dao来进行抽象简化，但是这样依然不是很方便，我们需要针对每个实体编写一个继承自泛型模板Dao的接口，再编写该接口的实现。虽然一些基础的数据访问已经可以得到很好的复用，但是在代码结构上针对每个实体都会有一堆Dao的接口和实现。</p><p>由于模板Dao的实现，使得这些具体实体的Dao层已经变的非常“薄”，有一些具体实体的Dao实现可能完全就是对模板Dao的简单代理，并且往往这样的实现类可能会出现在很多实体上。Spring-data-jpa的出现正可以让这样一个已经很“薄”的数据访问层变成只是一层接口的编写方式。</p><p><strong>Spring-data-jpa的能力远不止本文提到的这些，由于本文主要以整合介绍为主，对于Spring-data-jpa的使用只是介绍了常见的使用方式。诸如@Modifying操作、分页排序、原生SQL支持以及与Spring MVC的结合使用等等内容就不在本文中详细展开</strong></p><p>@Transactional(isolation = Isolation.DEFAULT)</p></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="4142158067"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="5618891265"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/dubbo注解方式集成springmvc.html" rel="next" title="dubbo 注解方式集成 springmvc"><i class="fa fa-chevron-left"></i> dubbo 注解方式集成 springmvc</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/java线程数过高原因分析.html" rel="prev" title="java线程数过高原因分析">java线程数过高原因分析 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Hello</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">1358</span> <span class="site-state-item-name">posts</span></a></div></nav></div></section></div></aside><div class="sfix"><div class="fixedme"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9477174171188196" data-ad-slot="9597600460" data-ad-format="auto"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Hello</span></div><div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div><span class="post-meta-divider">|</span><div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script></body></html><!-- rebuild by neat -->