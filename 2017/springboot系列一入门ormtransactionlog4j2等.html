<!DOCTYPE html>
<html lang="zh_CN"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>SpringBoot系列一（入门，ORM，Transaction,log4j2等） | Java面试</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="SpringBoot系列一（入门，ORM，Transaction,log4j2等）" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="今天写篇springboot的博客，主要介绍一下springboot搭建以及一些整合。" />
<meta property="og:description" content="今天写篇springboot的博客，主要介绍一下springboot搭建以及一些整合。" />
<link rel="canonical" href="http://www.jfox.info/2017/springboot%E7%B3%BB%E5%88%97%E4%B8%80%E5%85%A5%E9%97%A8ormtransactionlog4j2%E7%AD%89.html" />
<meta property="og:url" content="http://www.jfox.info/2017/springboot%E7%B3%BB%E5%88%97%E4%B8%80%E5%85%A5%E9%97%A8ormtransactionlog4j2%E7%AD%89.html" />
<meta property="og:site_name" content="Java面试" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-01-01T23:58:19+08:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"SpringBoot系列一（入门，ORM，Transaction,log4j2等）","dateModified":"2017-01-01T23:58:19+08:00","datePublished":"2017-01-01T23:58:19+08:00","url":"http://www.jfox.info/2017/springboot%E7%B3%BB%E5%88%97%E4%B8%80%E5%85%A5%E9%97%A8ormtransactionlog4j2%E7%AD%89.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.jfox.info/2017/springboot%E7%B3%BB%E5%88%97%E4%B8%80%E5%85%A5%E9%97%A8ormtransactionlog4j2%E7%AD%89.html"},"description":"今天写篇springboot的博客，主要介绍一下springboot搭建以及一些整合。","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://www.jfox.info/feed.xml" title="Java面试" /></head><body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Java面试</a><nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
          </svg>
        </span>
      </label>

      <div class="trigger"><a class="page-link" href="/about/">About</a></div>
    </nav></div>
</header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SpringBoot系列一（入门，ORM，Transaction,log4j2等）</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2017-01-01T23:58:19+08:00" itemprop="datePublished">Jan 1, 2017
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    
<p>今天写篇springboot的博客，主要介绍一下springboot搭建以及一些整合。</p>

<p>首先介绍springboot搭建，我今天选择Maven，想用Gradle搭建的就自己百度一下吧，访问“http://start.spring.io/”官网。</p>

<p><img src="593d920.png" alt="" /></p>

<p>填写好Maven的GroupId以及ArtifactId然后Generate Project。</p>

<p>我这次使用的是IntellIj IDEA,导入generate出来的project，选择maven导入，一直选next就行了（记得选一下jdk版本，我用的是1.8），eclipse的话直接import project就行了。</p>

<p>初始的项目结构应该就是一个普通的maven项目，只有一个配置文件就是application.properties，也是springboot整合所有东西的配置文件。</p>

<p>maven pom文件的依赖只需要以下：</p>
<dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter</artifactId></dependency>

<dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter-test</artifactId><scope>test</scope></dependency>
<p>如果加入web模块：</p>
<dependency><groupId>org.springframework.boot</groupId><artifactId>spring-boot-starter-web</artifactId></dependency>
<p>我用的版本是1.5.4</p>

<p><img src="b785d67.png" alt="" /></p>

<p>可以按照我上面的项目结构去建立resource文件夹以及package包，注意一点，test和main的根包名需要一致，否则会报错（具体报错可以自己试试）。</p>

<p>首先来试试最基础的helloworld。</p>

<p><img src="7528a6c.png" alt="" />
<img src="26a83f3.png" alt="" />
 写一个跟SpringMVC类似的controller就可以试试helloworld了，在包的根路径建立一个Application类作为程序入口(springboot的规矩)，也可以直接运行main方法启动springboot，相当于内嵌了tomcat。</p>

<p>运行起来之后就可以在localhost:8080/hello看到映射结果了。</p>

<p>如果使用Test访问：</p>

<p><img src="ca07b79.png" alt="" /></p>

<p>Mock一下，然后引入</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">import</span> <span class="n">static</span> <span class="n">org</span><span class="p">.</span><span class="n">hamcrest</span><span class="p">.</span><span class="n">Matchers</span><span class="p">.</span><span class="n">equalTo</span><span class="p">;</span>
<span class="n">import</span> <span class="n">static</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">MockMvcResultMatchers</span><span class="p">.</span><span class="n">content</span><span class="p">;</span>
<span class="n">import</span> <span class="n">static</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">MockMvcResultMatchers</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="err">具体代码不解释了，看一看能猜出来。</span>
<span class="err">然后来看一下普通</span><span class="n">restful</span><span class="err">风格的</span><span class="n">controller</span><span class="err">咋写</span><span class="p">,</span><span class="err">通俗点说就是我咋用</span><span class="n">springboot</span><span class="err">实现</span><span class="n">springmvc</span><span class="err">一样的东东</span>

<span class="k">package</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">.</span><span class="n">web</span><span class="p">;</span>

<span class="n">import</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">.</span><span class="k">model</span><span class="p">.</span><span class="n">User</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">bind</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">ModelAttribute</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">bind</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">PathVariable</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">bind</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">RequestMapping</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">bind</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">RequestMethod</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">bind</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">RestController</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">ArrayList</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">Collections</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">HashMap</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="k">List</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">Map</span><span class="p">;</span>

<span class="p">/**</span>
 <span class="p">*</span> <span class="n">Created</span> <span class="n">by</span> <span class="n">niezy</span> <span class="n">on</span> <span class="m">2017</span><span class="p">/</span><span class="m">7</span><span class="p">/</span><span class="m">26.</span>
 <span class="p">*/</span>
<span class="p">@</span><span class="n">RestController</span>
<span class="p">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="p">=</span> <span class="s2">"/users"</span><span class="p">)</span> <span class="p">//</span> <span class="err">通过这里配置使下面的映射都在</span><span class="p">/</span><span class="n">users</span><span class="err">下</span><span class="n">publicclass</span> <span class="n">UserController</span> <span class="p">{</span>

  <span class="p">//</span> <span class="err">创建线程安全的</span><span class="n">Mapstatic</span> <span class="n">Map</span><span class="p">&lt;</span><span class="n">Long</span><span class="p">,</span> <span class="n">User</span><span class="p">&gt;</span> <span class="n">users</span> <span class="p">=</span> <span class="n">Collections</span><span class="p">.</span><span class="n">synchronizedMap</span><span class="p">(</span><span class="n">new</span> <span class="n">HashMap</span><span class="p">&lt;</span><span class="n">Long</span><span class="p">,</span> <span class="n">User</span><span class="p">&gt;());</span>

  <span class="p">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="p">=</span> <span class="s2">"/"</span><span class="p">,</span> <span class="n">method</span> <span class="p">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="n">GET</span><span class="p">)</span>
  <span class="k">public</span> <span class="k">List</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">getUserList</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">//</span> <span class="err">处理</span><span class="s2">"/users/"</span><span class="err">的</span><span class="n">GET</span><span class="err">请求，用来获取用户列表</span>
    <span class="p">//</span> <span class="err">还可以通过</span><span class="p">@</span><span class="n">RequestParam</span><span class="err">从页面中传递参数来进行查询条件或者翻页信息的传递</span>
    <span class="k">List</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">r</span> <span class="p">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;(</span><span class="n">users</span><span class="p">.</span><span class="n">values</span><span class="p">());</span>
    <span class="n">return</span> <span class="n">r</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="p">=</span> <span class="s2">"/"</span><span class="p">,</span> <span class="n">method</span> <span class="p">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="n">POST</span><span class="p">)</span>
  <span class="k">public</span> <span class="k">String</span> <span class="n">postUser</span><span class="p">(@</span><span class="n">ModelAttribute</span> <span class="n">User</span> <span class="n">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">//</span> <span class="err">处理</span><span class="s2">"/users/"</span><span class="err">的</span><span class="n">POST</span><span class="err">请求，用来创建</span><span class="n">User</span>
    <span class="p">//</span> <span class="err">除了</span><span class="p">@</span><span class="n">ModelAttribute</span><span class="err">绑定参数之外，还可以通过</span><span class="p">@</span><span class="n">RequestParam</span><span class="err">从页面中传递参数</span>    <span class="n">users</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="nf">getId</span><span class="p">(),</span> <span class="n">user</span><span class="p">);</span>
    <span class="n">return</span> <span class="s2">"success"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="p">=</span> <span class="s2">"/{id}"</span><span class="p">,</span> <span class="n">method</span> <span class="p">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="n">GET</span><span class="p">)</span>
  <span class="k">public</span> <span class="n">User</span> <span class="n">getUser</span><span class="p">(@</span><span class="n">PathVariable</span> <span class="n">Long</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">//</span> <span class="err">处理</span><span class="s2">"/users/{id}"</span><span class="err">的</span><span class="n">GET</span><span class="err">请求，用来获取</span><span class="n">url</span><span class="err">中</span><span class="n">id</span><span class="err">值的</span><span class="n">User</span><span class="err">信息</span>
    <span class="p">//</span> <span class="n">url</span><span class="err">中的</span><span class="n">id</span><span class="err">可通过</span><span class="p">@</span><span class="n">PathVariable</span><span class="err">绑定到函数的参数中</span><span class="n">return</span> <span class="n">users</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="p">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="p">=</span> <span class="s2">"/{id}"</span><span class="p">,</span> <span class="n">method</span> <span class="p">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="n">PUT</span><span class="p">)</span>
  <span class="k">public</span> <span class="k">String</span> <span class="n">putUser</span><span class="p">(@</span><span class="n">PathVariable</span> <span class="n">Long</span> <span class="n">id</span><span class="p">,</span> <span class="p">@</span><span class="n">ModelAttribute</span> <span class="n">User</span> <span class="n">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">//</span> <span class="err">处理</span><span class="s2">"/users/{id}"</span><span class="err">的</span><span class="n">PUT</span><span class="err">请求，用来更新</span><span class="n">User</span><span class="err">信息</span>
    <span class="n">User</span> <span class="n">u</span> <span class="p">=</span> <span class="n">users</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="n">u</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">getName</span><span class="p">());</span>
    <span class="n">u</span><span class="p">.</span><span class="n">setAge</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">getAge</span><span class="p">());</span>
    <span class="n">users</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
    <span class="n">return</span> <span class="s2">"success"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="p">=</span> <span class="s2">"/{id}"</span><span class="p">,</span> <span class="n">method</span> <span class="p">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="n">DELETE</span><span class="p">)</span>
  <span class="k">public</span> <span class="k">String</span> <span class="n">deleteUser</span><span class="p">(@</span><span class="n">PathVariable</span> <span class="n">Long</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">//</span> <span class="err">处理</span><span class="s2">"/users/{id}"</span><span class="err">的</span><span class="n">DELETE</span><span class="err">请求，用来删除</span><span class="n">User</span>    <span class="n">users</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="n">return</span> <span class="s2">"success"</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>一样的controller如上图，然后开始测试呗</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">;</span>

<span class="n">import</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">UserController</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">Before</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">Test</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">runner</span><span class="p">.</span><span class="n">RunWith</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">junit4</span><span class="p">.</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">WebAppConfiguration</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">MockMvc</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">RequestBuilder</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">MockMvcRequestBuilders</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">setup</span><span class="p">.</span><span class="n">MockMvcBuilders</span><span class="p">;</span>
<span class="n">importstatic</span> <span class="n">org</span><span class="p">.</span><span class="n">hamcrest</span><span class="p">.</span><span class="n">Matchers</span><span class="p">.</span><span class="n">equalTo</span><span class="p">;</span>
<span class="n">importstatic</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">MockMvcRequestBuilders</span><span class="p">.</span><span class="n">delete</span><span class="p">;</span>
<span class="n">importstatic</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">MockMvcRequestBuilders</span><span class="p">.</span><span class="n">post</span><span class="p">;</span>
<span class="n">importstatic</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">MockMvcRequestBuilders</span><span class="p">.</span><span class="n">put</span><span class="p">;</span>
<span class="n">importstatic</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">MockMvcResultMatchers</span><span class="p">.</span><span class="n">content</span><span class="p">;</span>
<span class="n">importstatic</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">MockMvcResultMatchers</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>

<span class="p">@</span><span class="n">RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="n">class</span><span class="p">)</span>
<span class="p">@</span><span class="n">WebAppConfiguration</span>
<span class="n">publicclass</span> <span class="n">ApplicationTests</span> <span class="p">{</span>

  <span class="n">private</span> <span class="n">MockMvc</span> <span class="n">mvc</span><span class="p">;</span>

  <span class="p">@</span><span class="n">Before</span>
  <span class="n">publicvoid</span> <span class="n">setUp</span><span class="p">()</span> <span class="n">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="n">mvc</span> <span class="p">=</span> <span class="n">MockMvcBuilders</span><span class="p">.</span><span class="n">standaloneSetup</span><span class="p">(</span><span class="n">new</span> <span class="n">UserController</span><span class="p">()).</span><span class="n">build</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="p">@</span><span class="n">Test</span>
  <span class="n">publicvoid</span> <span class="n">testUserController</span><span class="p">()</span> <span class="n">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="p">//</span> <span class="err">测试</span><span class="n">UserController</span>
    <span class="n">RequestBuilder</span> <span class="n">request</span> <span class="p">=</span> <span class="n">null</span><span class="p">;</span>

    <span class="p">//</span> <span class="m">1</span><span class="err">、</span><span class="n">get</span><span class="err">查一下</span><span class="n">user</span><span class="err">列表，应该为空</span>
    <span class="n">request</span> <span class="p">=</span> <span class="n">MockMvcRequestBuilders</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/users/"</span><span class="p">);</span>
    <span class="n">mvc</span><span class="p">.</span><span class="n">perform</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">andExpect</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="n">isOk</span><span class="p">()).</span><span class="n">andExpect</span><span class="p">(</span><span class="n">content</span><span class="p">().</span><span class="k">string</span><span class="p">(</span><span class="n">equalTo</span><span class="p">(</span><span class="s2">"[]"</span><span class="p">)));</span>

    <span class="p">//</span> <span class="m">2</span><span class="err">、</span><span class="n">post</span><span class="err">提交一个</span><span class="n">user</span>
    <span class="n">request</span> <span class="p">=</span> <span class="n">post</span><span class="p">(</span><span class="s2">"/users/"</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"1"</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"测试大师"</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="s2">"age"</span><span class="p">,</span> <span class="s2">"20"</span><span class="p">);</span>
    <span class="n">mvc</span><span class="p">.</span><span class="n">perform</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">andExpect</span><span class="p">(</span><span class="n">content</span><span class="p">().</span><span class="k">string</span><span class="p">(</span><span class="n">equalTo</span><span class="p">(</span><span class="s2">"success"</span><span class="p">)));</span>

    <span class="p">//</span> <span class="m">3</span><span class="err">、</span><span class="n">get</span><span class="err">获取</span><span class="n">user</span><span class="err">列表，应该有刚才插入的数据</span>
    <span class="n">request</span> <span class="p">=</span> <span class="n">MockMvcRequestBuilders</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/users/"</span><span class="p">);</span>
    <span class="n">mvc</span><span class="p">.</span><span class="n">perform</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">andExpect</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="n">isOk</span><span class="p">())</span>
        <span class="p">.</span><span class="n">andExpect</span><span class="p">(</span><span class="n">content</span><span class="p">().</span><span class="k">string</span><span class="p">(</span><span class="n">equalTo</span><span class="p">(</span><span class="s2">"[{</span><span class="se">\"</span><span class="s2">id</span><span class="se">\"</span><span class="s2">:1,</span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">测试大师</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">age</span><span class="se">\"</span><span class="s2">:20}]"</span><span class="p">)));</span>

    <span class="p">//</span> <span class="m">4</span><span class="err">、</span><span class="n">put</span><span class="err">修改</span><span class="n">id</span><span class="err">为</span><span class="m">1</span><span class="err">的</span><span class="n">user</span>
    <span class="n">request</span> <span class="p">=</span> <span class="n">put</span><span class="p">(</span><span class="s2">"/users/1"</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"测试终极大师"</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="s2">"age"</span><span class="p">,</span> <span class="s2">"30"</span><span class="p">);</span>
    <span class="n">mvc</span><span class="p">.</span><span class="n">perform</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">andExpect</span><span class="p">(</span><span class="n">content</span><span class="p">().</span><span class="k">string</span><span class="p">(</span><span class="n">equalTo</span><span class="p">(</span><span class="s2">"success"</span><span class="p">)));</span>

    <span class="p">//</span> <span class="m">5</span><span class="err">、</span><span class="n">get</span><span class="err">一个</span><span class="n">id</span><span class="err">为</span><span class="m">1</span><span class="err">的</span><span class="n">user</span>
    <span class="n">request</span> <span class="p">=</span> <span class="n">MockMvcRequestBuilders</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/users/1"</span><span class="p">);</span>
    <span class="n">mvc</span><span class="p">.</span><span class="n">perform</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">andExpect</span><span class="p">(</span><span class="n">content</span><span class="p">().</span><span class="k">string</span><span class="p">(</span><span class="n">equalTo</span><span class="p">(</span><span class="s2">"{</span><span class="se">\"</span><span class="s2">id</span><span class="se">\"</span><span class="s2">:1,</span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">测试终极大师</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">age</span><span class="se">\"</span><span class="s2">:30}"</span><span class="p">)));</span>

    <span class="p">//</span> <span class="m">6</span><span class="err">、</span><span class="n">del</span><span class="err">删除</span><span class="n">id</span><span class="err">为</span><span class="m">1</span><span class="err">的</span><span class="n">user</span>
    <span class="n">request</span> <span class="p">=</span> <span class="n">delete</span><span class="p">(</span><span class="s2">"/users/1"</span><span class="p">);</span>
    <span class="n">mvc</span><span class="p">.</span><span class="n">perform</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">andExpect</span><span class="p">(</span><span class="n">content</span><span class="p">().</span><span class="k">string</span><span class="p">(</span><span class="n">equalTo</span><span class="p">(</span><span class="s2">"success"</span><span class="p">)));</span>

    <span class="p">//</span> <span class="m">7</span><span class="err">、</span><span class="n">get</span><span class="err">查一下</span><span class="n">user</span><span class="err">列表，应该为空</span>
    <span class="n">request</span> <span class="p">=</span> <span class="n">MockMvcRequestBuilders</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/users/"</span><span class="p">);</span>
    <span class="n">mvc</span><span class="p">.</span><span class="n">perform</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">andExpect</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="n">isOk</span><span class="p">()).</span><span class="n">andExpect</span><span class="p">(</span><span class="n">content</span><span class="p">().</span><span class="k">string</span><span class="p">(</span><span class="n">equalTo</span><span class="p">(</span><span class="s2">"[]"</span><span class="p">)));</span>

  <span class="p">}</span>



<span class="p">}</span>
</code></pre></div></div>

<p>好咯~</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>下面说一下log,spring1.5.4版本是不支持log4j老用法了，我查了一下然后选择的是log4j2xml的方式，pom如下：

&lt;dependency&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
&lt;exclusions&gt;
&lt;exclusion&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
&lt;/exclusion&gt;
&lt;/exclusions&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;
&lt;/dependency&gt;
首先springboot自带的是logback,我们首先更改之前的pom，加上


 &lt;exclusions&gt;
&lt;exclusion&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
&lt;/exclusion&gt;
&lt;/exclusions&gt;

除去logback，然后引入log4j2.
然后在resource文件夹底下新建一个log4j2.xml

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;
&lt;!--Configuration后面的status，这个用于设置log4j2自身内部的信息输出，可以不设置，当设置成trace时，你会看到log4j2内部各种详细输出--&gt;
&lt;!--monitorInterval：Log4j能够自动检测修改配置 文件和重新配置本身，设置间隔秒数--&gt;
&lt;configuration status="WARN" monitorInterval="30"&gt;
    &lt;!--先定义所有的appender--&gt;
    &lt;appenders&gt;
        &lt;!--这个输出控制台的配置--&gt;
        &lt;console name="Console" target="SYSTEM_OUT"&gt;
            &lt;!--输出日志的格式--&gt;
            &lt;PatternLayout pattern="[%d{HH:mm:ss:SSS}] [%p] - %l - %m%n"/&gt;
        &lt;/console&gt;
        &lt;!--文件会打印出所有信息，这个log每次运行程序会自动清空，由append属性决定，这个也挺有用的，适合临时测试用--&gt;
        &lt;File name="log" fileName="log/test.log" append="false"&gt;
            &lt;PatternLayout pattern="%d{HH:mm:ss.SSS} %-5level %class{36} %L %M - %msg%xEx%n"/&gt;
        &lt;/File&gt;
        &lt;!-- 这个会打印出所有的info及以下级别的信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档--&gt;
        &lt;RollingFile name="RollingFileInfo" fileName="${sys:user.home}/logs/info.log"
                     filePattern="${sys:user.home}/logs/$${date:yyyy-MM}/info-%d{yyyy-MM-dd}-%i.log"&gt;
            &lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;
            &lt;ThresholdFilter level="info" onMatch="ACCEPT" onMismatch="DENY"/&gt;
            &lt;PatternLayout pattern="[%d{HH:mm:ss:SSS}] [%p] - %l - %m%n"/&gt;
            &lt;Policies&gt;
                &lt;TimeBasedTriggeringPolicy/&gt;
                &lt;SizeBasedTriggeringPolicy size="100 MB"/&gt;
            &lt;/Policies&gt;
        &lt;/RollingFile&gt;
        &lt;RollingFile name="RollingFileWarn" fileName="${sys:user.home}/logs/warn.log"
                     filePattern="${sys:user.home}/logs/$${date:yyyy-MM}/warn-%d{yyyy-MM-dd}-%i.log"&gt;
            &lt;ThresholdFilter level="warn" onMatch="ACCEPT" onMismatch="DENY"/&gt;
            &lt;PatternLayout pattern="[%d{HH:mm:ss:SSS}] [%p] - %l - %m%n"/&gt;
            &lt;Policies&gt;
                &lt;TimeBasedTriggeringPolicy/&gt;
                &lt;SizeBasedTriggeringPolicy size="100 MB"/&gt;
            &lt;/Policies&gt;
            &lt;!-- DefaultRolloverStrategy属性如不设置，则默认为最多同一文件夹下7个文件，这里设置了20 --&gt;
            &lt;DefaultRolloverStrategy max="20"/&gt;
        &lt;/RollingFile&gt;
        &lt;RollingFile name="RollingFileError" fileName="${sys:user.home}/logs/error.log"
                     filePattern="${sys:user.home}/logs/$${date:yyyy-MM}/error-%d{yyyy-MM-dd}-%i.log"&gt;
            &lt;ThresholdFilter level="error" onMatch="ACCEPT" onMismatch="DENY"/&gt;
            &lt;PatternLayout pattern="[%d{HH:mm:ss:SSS}] [%p] - %l - %m%n"/&gt;
            &lt;Policies&gt;
                &lt;TimeBasedTriggeringPolicy/&gt;
                &lt;SizeBasedTriggeringPolicy size="100 MB"/&gt;
            &lt;/Policies&gt;
        &lt;/RollingFile&gt;
    &lt;/appenders&gt;
    &lt;!--然后定义logger，只有定义了logger并引入的appender，appender才会生效--&gt;
    &lt;loggers&gt;
        &lt;!--过滤掉spring和mybatis的一些无用的DEBUG信息--&gt;
        &lt;logger name="org.springframework" level="INFO"&gt;&lt;/logger&gt;
        &lt;logger name="org.mybatis" level="INFO"&gt;&lt;/logger&gt;
        &lt;root level="all"&gt;
            &lt;appender-ref ref="Console"/&gt;
            &lt;appender-ref ref="RollingFileInfo"/&gt;
            &lt;appender-ref ref="RollingFileWarn"/&gt;
            &lt;appender-ref ref="RollingFileError"/&gt;
        &lt;/root&gt;
    &lt;/loggers&gt;
&lt;/configuration&gt;
</code></pre></div></div>

<p>　　然后在application.properties配置文件里加上</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logging.config=classpath:log4j2.xml 
其实不加也行，起码我测试这个版本没问题，随便你啦，强迫症的加上吧。
下面说说spring jdbcTemplate


&lt;dependency&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
&lt;version&gt;1.5.2.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;mysql&lt;/groupId&gt;
&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;version&gt;5.1.21&lt;/version&gt;
&lt;/dependency&gt;
加上这个依赖，然后我们开始codeing
</code></pre></div></div>

<p><img src="14d3ce6.png" alt="" /></p>

<p>建个user类</p>

<p>application.properties加上：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring.datasource.url=jdbc:mysql://localhost:3306/boot
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.jpa.properties.hibernate.hbm2ddl.auto=create-drop
log4j.logger.org.springframework.jdbc.core=DEBUG, file
log4j.logger.org.springframework.jdbc.core.StatementCreatorUtils=TRACE, file
然后建一个UserService，跟springmvc没什么两样

/**
 * Created by niezy on 2017/7/26.
 */publicinterface UserService {
  /**
   * 新增一个用户
   * 
   * @param name
   * @param age
   */void create(String name, Integer age);

  /**
   * 根据name删除一个用户高
   * 
   * @param name
   */void deleteByName(String name);

  /**
   * 获取用户总量
   */
  Integer getAllUsers();

  /**
   * 删除所有用户
   */void deleteAllUsers();

  /**
   * 根据姓名更新年龄
   * @param name
   * @param age
   */void update(String name,int age);


  /**
   * 根据姓名查对象
   * @param name
   * @return*/
  User querySingleUser(String name);



}

/**
 * Created by niezy on 2017/7/26.
 */
@Service
publicclass UserServiceImpl implements UserService {
  @Autowired
  private JdbcTemplate jdbcTemplate;

  @Override
  publicvoid create(String name, Integer age) {
    jdbcTemplate.update("insert into USER(NAME, AGE) values(?, ?)", name, age);
  }

  @Override
  publicvoid deleteByName(String name) {
    jdbcTemplate.update("delete from USER where NAME = ?", name);
  }

  @Override
  public Integer getAllUsers() {
    return jdbcTemplate.queryForObject("select count(1) from USER", Integer.class);
  }

  @Override
  publicvoid deleteAllUsers() {
    jdbcTemplate.update("delete from USER");
  }

  @Override
  publicvoid update(String name, int age) {
    jdbcTemplate.update("update user set age = ? where name=? ", age, name);
  }

  @Override
  public User querySingleUser(String name) {
    User user = new User();
    user.setName(name);
    // 返回对象需要beanPropertyRowMapper映射，查询条件放到Object数组return jdbcTemplate.queryForObject("select * from user where name=? ", new Object[] {name},
        new BeanPropertyRowMapper&lt;User&gt;(User.class));
  }
}
</code></pre></div></div>

<p>然后测试</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">;</span>

<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">Assert</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">Before</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">Test</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">runner</span><span class="p">.</span><span class="n">RunWith</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">beans</span><span class="p">.</span><span class="n">factory</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">Autowired</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">boot</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">SpringBootTest</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">junit4</span><span class="p">.</span><span class="n">SpringRunner</span><span class="p">;</span>

<span class="n">import</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">.</span><span class="n">jdbcservice</span><span class="p">.</span><span class="n">UserService</span><span class="p">;</span>

<span class="p">/**</span>
 <span class="p">*</span> <span class="n">Created</span> <span class="n">by</span> <span class="n">niezy</span> <span class="n">on</span> <span class="m">2017</span><span class="p">/</span><span class="m">7</span><span class="p">/</span><span class="m">26.</span>
 <span class="p">*/</span>


<span class="p">@</span><span class="n">RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="n">class</span><span class="p">)</span>
<span class="p">@</span><span class="n">SpringBootTest</span>
<span class="n">publicclass</span> <span class="n">JdbcApplicationTests</span> <span class="p">{</span>
  <span class="p">@</span><span class="n">Autowired</span>
  <span class="n">private</span> <span class="n">UserService</span> <span class="n">userSerivce</span><span class="p">;</span>

  <span class="p">@</span><span class="n">Before</span>
  <span class="n">publicvoid</span> <span class="n">setUp</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">//</span> <span class="err">准备，清空</span><span class="n">user</span><span class="err">表</span>    <span class="n">userSerivce</span><span class="p">.</span><span class="n">deleteAllUsers</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="p">@</span><span class="n">Test</span>
  <span class="n">publicvoid</span> <span class="n">test</span><span class="p">()</span> <span class="n">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="p">//</span> <span class="err">插入</span><span class="m">5</span><span class="err">个用户</span>
    <span class="n">userSerivce</span><span class="p">.</span><span class="nb">create</span><span class="p">(</span><span class="s2">"zhangsan"</span><span class="p">,</span> <span class="m">18</span><span class="p">);</span>
    <span class="n">userSerivce</span><span class="p">.</span><span class="nb">create</span><span class="p">(</span><span class="s2">"lisi"</span><span class="p">,</span> <span class="m">19</span><span class="p">);</span>
    <span class="n">userSerivce</span><span class="p">.</span><span class="nb">create</span><span class="p">(</span><span class="s2">"wangwu"</span><span class="p">,</span> <span class="m">20</span><span class="p">);</span>
    <span class="n">userSerivce</span><span class="p">.</span><span class="nb">create</span><span class="p">(</span><span class="s2">"haozi"</span><span class="p">,</span> <span class="m">25</span><span class="p">);</span>
    <span class="n">userSerivce</span><span class="p">.</span><span class="nb">create</span><span class="p">(</span><span class="s2">"zhengyu"</span><span class="p">,</span> <span class="m">23</span><span class="p">);</span>
    <span class="p">//</span> <span class="err">查数据库，应该有</span><span class="m">5</span><span class="err">个用户</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="n">userSerivce</span><span class="p">.</span><span class="n">getAllUsers</span><span class="p">().</span><span class="n">intValue</span><span class="p">());</span>
    <span class="p">//</span> <span class="err">删除两个用户</span>
    <span class="n">userSerivce</span><span class="p">.</span><span class="n">deleteByName</span><span class="p">(</span><span class="s2">"zhangsan"</span><span class="p">);</span>
    <span class="n">userSerivce</span><span class="p">.</span><span class="n">deleteByName</span><span class="p">(</span><span class="s2">"haozi"</span><span class="p">);</span>
    <span class="n">userSerivce</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="s2">"wangwu"</span><span class="p">,</span> <span class="m">28</span><span class="p">);</span>
    <span class="nf">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">userSerivce</span><span class="p">.</span><span class="n">querySingleUser</span><span class="p">(</span><span class="s2">"zhengyu"</span><span class="p">).</span><span class="n">toString</span><span class="p">());</span>
    <span class="p">//</span> <span class="err">查数据库，应该有</span><span class="m">3</span><span class="err">个用户</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="n">userSerivce</span><span class="p">.</span><span class="n">getAllUsers</span><span class="p">().</span><span class="n">intValue</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>自己跑一下试试  ~</p>

<p>jdbcTemplate只有一点注意的，返回对象稍微麻烦点，需要按他的BeanPropertyRowMapper规矩来，其实还有很多种玩法，ORM框架都有很多玩法，包括我进携程以后用的携程的dal框架，返回Object数组啦，集合啦，List&lt;Map&gt;等等，说到底都是封装的jdbc，然后有的框架是全mapping，有的是半mapping，包括Hibernate实现的JPA标准，也可以nativeSql支持数组[]选字段返回，也可以直接mapping整个类，甚至级联操作，下次专门写个博客好好说说ORM</p>

<p>插一点事务的东东，springboot整合jpa jdbctempalte等ORM的depency已经自带Transaction注解了，也是默认的</p>

<p>你可以在@Test处加上</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Transactional(propagation = Propagation.REQUIRED)
</code></pre></div></div>

<p>然后我们开始spring-data-jpa黑魔法，号称业务操作几乎不需要写任何sql的ORM框架，也是spring进军ORM的产品</p>

<p>pom：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="n">dependency</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="n">groupId</span><span class="p">&gt;</span><span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">boot</span><span class="p">&lt;/</span><span class="n">groupId</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="n">artifactId</span><span class="p">&gt;</span><span class="n">spring</span><span class="p">-</span><span class="n">boot</span><span class="p">-</span><span class="n">starter</span><span class="p">-</span><span class="n">data</span><span class="p">-</span><span class="n">jpa</span><span class="p">&lt;/</span><span class="n">artifactId</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="k">version</span><span class="p">&gt;</span><span class="m">1.5.3</span><span class="p">.</span><span class="n">RELEASE</span><span class="p">&lt;/</span><span class="k">version</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="n">dependency</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="n">dependency</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="n">groupId</span><span class="p">&gt;</span><span class="n">javax</span><span class="p">.</span><span class="n">persistence</span><span class="p">&lt;/</span><span class="n">groupId</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="n">artifactId</span><span class="p">&gt;</span><span class="n">persistence</span><span class="p">-</span><span class="n">api</span><span class="p">&lt;/</span><span class="n">artifactId</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="k">version</span><span class="p">&gt;</span><span class="m">1.0.2</span><span class="p">&lt;/</span><span class="k">version</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="n">dependency</span><span class="p">&gt;</span>
<span class="n">IDEA</span> <span class="m">1.5.4</span><span class="err">版本要选择一下</span><span class="n">jpa</span><span class="err">的版本，否则会有引不到</span><span class="n">JPA</span><span class="err">注解的</span><span class="n">bug</span><span class="err">，我当时就被坑了十几分钟，换了很多</span><span class="n">persistence</span><span class="err">的</span><span class="n">depency</span>
<span class="err">老规矩，</span><span class="n">model</span><span class="err">开始</span>

<span class="k">package</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">.</span><span class="k">model</span><span class="p">;</span>

<span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">persistence</span><span class="p">.</span><span class="n">Column</span><span class="p">;</span>
<span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">persistence</span><span class="p">.</span><span class="n">Entity</span><span class="p">;</span>
<span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">persistence</span><span class="p">.</span><span class="n">GeneratedValue</span><span class="p">;</span>
<span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">persistence</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>
<span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">persistence</span><span class="p">.</span><span class="n">Table</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">BigDecimal</span><span class="p">;</span>

<span class="p">/**</span>
 <span class="p">*</span> <span class="n">Created</span> <span class="n">by</span> <span class="n">niezy</span> <span class="n">on</span> <span class="m">2017</span><span class="p">/</span><span class="m">7</span><span class="p">/</span><span class="m">26.</span>
 <span class="p">*/</span>
<span class="p">@</span><span class="n">Entity</span>
<span class="p">@</span><span class="n">Table</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s2">"student"</span><span class="p">)</span>
<span class="n">publicclass</span> <span class="n">Student</span> <span class="p">{</span>
  <span class="p">@</span><span class="n">Id</span>
  <span class="p">@</span><span class="n">GeneratedValue</span>
  <span class="n">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>
  <span class="p">@</span><span class="n">Column</span><span class="p">(</span><span class="n">nullable</span> <span class="p">=</span> <span class="nb">false</span><span class="p">,</span><span class="n">length</span> <span class="p">=</span> <span class="m">5</span><span class="p">)</span>
  <span class="n">private</span> <span class="k">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="p">@</span><span class="n">Column</span><span class="p">(</span><span class="n">nullable</span> <span class="p">=</span> <span class="nb">false</span><span class="p">)</span>
  <span class="n">private</span> <span class="k">Integer</span> <span class="n">age</span><span class="p">;</span>

  <span class="p">@</span><span class="n">Column</span><span class="p">(</span><span class="n">nullable</span> <span class="p">=</span> <span class="nb">false</span><span class="p">)</span>
  <span class="n">private</span> <span class="n">BigDecimal</span> <span class="n">salary</span><span class="p">;</span>

  <span class="p">@</span><span class="n">Column</span><span class="p">(</span><span class="n">nullable</span> <span class="p">=</span> <span class="nb">false</span><span class="p">)</span>
  <span class="n">private</span> <span class="k">String</span> <span class="n">address</span><span class="p">;</span>

  <span class="k">public</span> <span class="n">Student</span><span class="p">()</span> <span class="p">{}</span>

  <span class="k">public</span> <span class="n">Student</span><span class="p">(</span><span class="k">String</span> <span class="n">name</span><span class="p">,</span> <span class="k">Integer</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="n">this</span><span class="p">.</span><span class="n">age</span> <span class="p">=</span> <span class="n">age</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="n">Student</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">,</span> <span class="k">String</span> <span class="n">name</span><span class="p">,</span> <span class="k">Integer</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="p">.</span><span class="n">id</span> <span class="p">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">this</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="n">this</span><span class="p">.</span><span class="n">age</span> <span class="p">=</span> <span class="n">age</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="n">Student</span><span class="p">(</span><span class="k">String</span> <span class="n">name</span><span class="p">,</span> <span class="k">Integer</span> <span class="n">age</span><span class="p">,</span> <span class="n">BigDecimal</span> <span class="n">salary</span><span class="p">,</span> <span class="k">String</span> <span class="n">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="n">this</span><span class="p">.</span><span class="n">age</span> <span class="p">=</span> <span class="n">age</span><span class="p">;</span>
    <span class="n">this</span><span class="p">.</span><span class="n">salary</span> <span class="p">=</span> <span class="n">salary</span><span class="p">;</span>
    <span class="n">this</span><span class="p">.</span><span class="n">address</span> <span class="p">=</span> <span class="n">address</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="n">BigDecimal</span> <span class="n">getSalary</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">return</span> <span class="n">salary</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">publicvoid</span> <span class="n">setSalary</span><span class="p">(</span><span class="n">BigDecimal</span> <span class="n">salary</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="p">.</span><span class="n">salary</span> <span class="p">=</span> <span class="n">salary</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">String</span> <span class="n">getAddress</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">return</span> <span class="n">address</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">publicvoid</span> <span class="n">setAddress</span><span class="p">(</span><span class="k">String</span> <span class="n">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="p">.</span><span class="n">address</span> <span class="p">=</span> <span class="n">address</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">return</span> <span class="n">id</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">publicvoid</span> <span class="n">setId</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="p">.</span><span class="n">id</span> <span class="p">=</span> <span class="n">id</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">String</span> <span class="n">getName</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">return</span> <span class="n">name</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">publicvoid</span> <span class="n">setName</span><span class="p">(</span><span class="k">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">Integer</span> <span class="n">getAge</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">return</span> <span class="n">age</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">publicvoid</span> <span class="n">setAge</span><span class="p">(</span><span class="k">Integer</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="p">.</span><span class="n">age</span> <span class="p">=</span> <span class="n">age</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">@</span><span class="n">Override</span>
  <span class="k">public</span> <span class="k">String</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">return</span> <span class="s2">"Student{"</span> <span class="p">+</span> <span class="s2">"id="</span> <span class="p">+</span> <span class="n">id</span> <span class="p">+</span> <span class="s2">", name='"</span> <span class="p">+</span> <span class="n">name</span> <span class="p">+</span> <span class="s1">'\'' + ", age=" + age + ", salary=" + salary + ", address='</span><span class="s2">"
        + address + '\'' + '}';
  }
}
</span></code></pre></div></div>

<p>然后service：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">.</span><span class="n">datajpaservice</span><span class="p">;</span>

<span class="n">import</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">.</span><span class="k">model</span><span class="p">.</span><span class="n">Student</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">jpa</span><span class="p">.</span><span class="n">repository</span><span class="p">.</span><span class="n">JpaRepository</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">jpa</span><span class="p">.</span><span class="n">repository</span><span class="p">.</span><span class="n">Query</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">repository</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="n">Param</span><span class="p">;</span>

<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">BigDecimal</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="k">List</span><span class="p">;</span>

<span class="p">/**</span>
 <span class="p">*</span> <span class="n">Created</span> <span class="n">by</span> <span class="n">niezy</span> <span class="n">on</span> <span class="m">2017</span><span class="p">/</span><span class="m">7</span><span class="p">/</span><span class="m">26.</span>
 <span class="p">*/</span><span class="n">publicinterface</span> <span class="n">StudentRepository</span> <span class="n">extends</span> <span class="n">JpaRepository</span><span class="p">&lt;</span><span class="n">Student</span><span class="p">,</span> <span class="n">Long</span><span class="p">&gt;</span> <span class="p">{</span>

  <span class="n">Student</span> <span class="n">findByName</span><span class="p">(</span><span class="k">String</span> <span class="n">name</span><span class="p">);</span>

  <span class="k">List</span><span class="p">&lt;</span><span class="n">Student</span><span class="p">&gt;</span> <span class="n">findListByName</span><span class="p">(</span><span class="k">String</span> <span class="n">name</span><span class="p">);</span>

  <span class="n">Student</span> <span class="n">findByNameAndAge</span><span class="p">(</span><span class="k">String</span> <span class="n">name</span><span class="p">,</span> <span class="k">Integer</span> <span class="n">age</span><span class="p">);</span>

  <span class="p">@</span><span class="n">Query</span><span class="p">(</span><span class="s2">"from Student  where name=:name"</span><span class="p">)</span>
  <span class="n">Student</span> <span class="n">findStudent</span><span class="p">(@</span><span class="n">Param</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span> <span class="k">String</span> <span class="n">name</span><span class="p">);</span>

  <span class="k">List</span><span class="p">&lt;</span><span class="n">Student</span><span class="p">&gt;</span> <span class="n">findByNameOrderBySalaryDesc</span><span class="p">(</span><span class="k">String</span> <span class="n">name</span><span class="p">);</span>

  <span class="k">List</span><span class="p">&lt;</span><span class="n">Student</span><span class="p">&gt;</span> <span class="n">findBySalary</span><span class="p">(</span><span class="n">BigDecimal</span> <span class="n">salary</span><span class="p">);</span>

<span class="p">}</span>

<span class="err">测试：</span>

<span class="k">package</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">;</span>


<span class="n">import</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">.</span><span class="n">datajpaservice</span><span class="p">.</span><span class="n">StudentRepository</span><span class="p">;</span>
<span class="n">import</span> <span class="n">com</span><span class="p">.</span><span class="n">zhengyu</span><span class="p">.</span><span class="k">model</span><span class="p">.</span><span class="n">Student</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">Assert</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">Test</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">runner</span><span class="p">.</span><span class="n">RunWith</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">beans</span><span class="p">.</span><span class="n">factory</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">Autowired</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">boot</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">SpringBootTest</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">junit4</span><span class="p">.</span><span class="n">SpringRunner</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">transaction</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">Propagation</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">transaction</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">Transactional</span><span class="p">;</span>

<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">BigDecimal</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="k">List</span><span class="p">;</span>

<span class="p">/**</span>
 <span class="p">*</span> <span class="n">Created</span> <span class="n">by</span> <span class="n">niezy</span> <span class="n">on</span> <span class="m">2017</span><span class="p">/</span><span class="m">7</span><span class="p">/</span><span class="m">26.</span>
 <span class="p">*/</span>
<span class="p">@</span><span class="n">RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="n">class</span><span class="p">)</span>
<span class="p">@</span><span class="n">SpringBootTest</span>
<span class="n">publicclass</span> <span class="n">SpringdatajpaTest</span> <span class="p">{</span>
  <span class="p">@</span><span class="n">Autowired</span>
  <span class="n">private</span> <span class="n">StudentRepository</span> <span class="n">studentRepository</span><span class="p">;</span>

  <span class="p">//</span> <span class="p">@</span><span class="n">Before</span>
  <span class="p">//</span> <span class="k">public</span> <span class="n">void</span> <span class="n">setUp</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">////</span> <span class="err">准备工作</span>
  <span class="p">//</span> <span class="n">studentRepository</span><span class="p">.</span><span class="n">deleteAll</span><span class="p">();</span>
  <span class="p">////</span> <span class="p">}</span>
  <span class="p">@</span><span class="n">Test</span>
  <span class="p">@</span><span class="n">Transactional</span><span class="p">(</span><span class="n">propagation</span> <span class="p">=</span> <span class="n">Propagation</span><span class="p">.</span><span class="n">REQUIRED</span><span class="p">)</span>
  <span class="n">publicvoid</span> <span class="n">test</span><span class="p">()</span> <span class="n">throws</span> <span class="n">Exception</span> <span class="p">{</span>

    <span class="p">//</span> <span class="err">创建</span><span class="m">10</span><span class="err">条记录</span>
    <span class="n">studentRepository</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">new</span> <span class="n">Student</span><span class="p">(</span><span class="s2">"AAA"</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="n">new</span> <span class="n">BigDecimal</span><span class="p">(</span><span class="m">20000</span><span class="p">),</span> <span class="s2">"shanghai"</span><span class="p">));</span>
    <span class="n">studentRepository</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">new</span> <span class="n">Student</span><span class="p">(</span><span class="s2">"BBB"</span><span class="p">,</span> <span class="m">20</span><span class="p">,</span> <span class="n">new</span> <span class="n">BigDecimal</span><span class="p">(</span><span class="m">50000</span><span class="p">),</span> <span class="s2">"beijing"</span><span class="p">));</span>
    <span class="n">studentRepository</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">new</span> <span class="n">Student</span><span class="p">(</span><span class="s2">"CCC"</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">new</span> <span class="n">BigDecimal</span><span class="p">(</span><span class="m">20000</span><span class="p">),</span> <span class="s2">"shanghai"</span><span class="p">));</span>
    <span class="n">studentRepository</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">new</span> <span class="n">Student</span><span class="p">(</span><span class="s2">"DDD"</span><span class="p">,</span> <span class="m">40</span><span class="p">,</span> <span class="n">new</span> <span class="n">BigDecimal</span><span class="p">(</span><span class="m">50000</span><span class="p">),</span> <span class="s2">"beijing"</span><span class="p">));</span>
    <span class="n">studentRepository</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">new</span> <span class="n">Student</span><span class="p">(</span><span class="s2">"EEE"</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="n">new</span> <span class="n">BigDecimal</span><span class="p">(</span><span class="m">20000</span><span class="p">),</span> <span class="s2">"shanghai"</span><span class="p">));</span>
    <span class="n">studentRepository</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">new</span> <span class="n">Student</span><span class="p">(</span><span class="s2">"EEE"</span><span class="p">,</span> <span class="m">60</span><span class="p">,</span> <span class="n">new</span> <span class="n">BigDecimal</span><span class="p">(</span><span class="m">50000</span><span class="p">),</span> <span class="s2">"beijing"</span><span class="p">));</span>
    <span class="n">studentRepository</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">new</span> <span class="n">Student</span><span class="p">(</span><span class="s2">"EEE"</span><span class="p">,</span> <span class="m">70</span><span class="p">,</span> <span class="n">new</span> <span class="n">BigDecimal</span><span class="p">(</span><span class="m">20000</span><span class="p">),</span> <span class="s2">"shanghai"</span><span class="p">));</span>
    <span class="n">studentRepository</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">new</span> <span class="n">Student</span><span class="p">(</span><span class="s2">"FFF"</span><span class="p">,</span> <span class="m">60</span><span class="p">,</span> <span class="n">new</span> <span class="n">BigDecimal</span><span class="p">(</span><span class="m">50000</span><span class="p">),</span> <span class="s2">"beijing"</span><span class="p">));</span>
    <span class="n">studentRepository</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">new</span> <span class="n">Student</span><span class="p">(</span><span class="s2">"III"</span><span class="p">,</span> <span class="m">90</span><span class="p">,</span> <span class="n">new</span> <span class="n">BigDecimal</span><span class="p">(</span><span class="m">20000</span><span class="p">),</span> <span class="s2">"shanghai"</span><span class="p">));</span>
    <span class="n">studentRepository</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">new</span> <span class="n">Student</span><span class="p">(</span><span class="s2">"JJJ"</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="n">new</span> <span class="n">BigDecimal</span><span class="p">(</span><span class="m">50000</span><span class="p">),</span> <span class="s2">"beijing"</span><span class="p">));</span>

    <span class="p">//</span> <span class="err">测试</span><span class="n">findAll</span><span class="p">,</span> <span class="err">查询所有记录</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="n">studentRepository</span><span class="p">.</span><span class="n">findAll</span><span class="p">().</span><span class="n">size</span><span class="p">());</span>
    <span class="p">//</span> <span class="err">测试</span><span class="n">findByName</span><span class="p">,</span> <span class="err">查询姓名为</span><span class="n">FFF</span><span class="err">的</span><span class="n">User</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="m">60</span><span class="p">,</span> <span class="n">studentRepository</span><span class="p">.</span><span class="n">findByName</span><span class="p">(</span><span class="s2">"FFF"</span><span class="p">).</span><span class="n">getAge</span><span class="p">().</span><span class="n">longValue</span><span class="p">());</span>
    <span class="p">//</span> <span class="err">测试</span><span class="n">findUser</span><span class="p">,</span> <span class="err">查询姓名为</span><span class="n">FFF</span><span class="err">的</span><span class="n">User</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="m">60</span><span class="p">,</span> <span class="n">studentRepository</span><span class="p">.</span><span class="n">findStudent</span><span class="p">(</span><span class="s2">"FFF"</span><span class="p">).</span><span class="n">getAge</span><span class="p">().</span><span class="n">longValue</span><span class="p">());</span>
    <span class="p">//</span> <span class="err">测试</span><span class="n">findByNameAndAge</span><span class="p">,</span> <span class="err">查询姓名为</span><span class="n">FFF</span><span class="err">并且年龄为</span><span class="m">60</span><span class="err">的</span><span class="n">User</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="s2">"FFF"</span><span class="p">,</span> <span class="n">studentRepository</span><span class="p">.</span><span class="n">findByNameAndAge</span><span class="p">(</span><span class="s2">"FFF"</span><span class="p">,</span> <span class="m">60</span><span class="p">).</span><span class="n">getName</span><span class="p">());</span>
    <span class="p">//</span> <span class="err">测试删除姓名为</span><span class="n">AAA</span><span class="err">的</span><span class="n">User</span>
    <span class="n">studentRepository</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">studentRepository</span><span class="p">.</span><span class="n">findByName</span><span class="p">(</span><span class="s2">"AAA"</span><span class="p">));</span>
    <span class="p">//</span> <span class="err">测试</span><span class="n">findAll</span><span class="p">,</span> <span class="err">查询所有记录</span><span class="p">,</span> <span class="err">验证上面的删除是否成功</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="m">9</span><span class="p">,</span> <span class="n">studentRepository</span><span class="p">.</span><span class="n">findAll</span><span class="p">().</span><span class="n">size</span><span class="p">());</span>

    <span class="p">//</span> <span class="k">List</span><span class="p">&lt;</span><span class="n">Student</span><span class="p">&gt;</span> <span class="n">stuList</span> <span class="p">=</span> <span class="n">studentRepository</span><span class="p">.</span><span class="n">findByNameOrderBySalaryDesc</span><span class="p">(</span><span class="s2">"EEE"</span><span class="p">);</span>
    <span class="k">List</span><span class="p">&lt;</span><span class="n">Student</span><span class="p">&gt;</span> <span class="n">stuList</span> <span class="p">=</span> <span class="n">studentRepository</span><span class="p">.</span><span class="n">findBySalary</span><span class="p">(</span><span class="n">new</span> <span class="n">BigDecimal</span><span class="p">(</span><span class="m">20000</span><span class="p">));</span>
    <span class="n">for</span> <span class="p">(</span><span class="n">Student</span> <span class="n">stu</span> <span class="p">:</span> <span class="n">stuList</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">stu</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">List</span><span class="p">&lt;</span><span class="n">Student</span><span class="p">&gt;</span> <span class="n">stuList2</span> <span class="p">=</span> <span class="n">studentRepository</span><span class="p">.</span><span class="n">findListByName</span><span class="p">(</span><span class="s2">"EEE"</span><span class="p">);</span>
    <span class="n">for</span> <span class="p">(</span><span class="n">Student</span> <span class="n">stu</span> <span class="p">:</span> <span class="n">stuList2</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">stu</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
    <span class="p">}</span>


  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>application.properties加上：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring.jpa.properties.hibernate.hbm2ddl.auto=create-drop
关于hbm2ddl:
</code></pre></div></div>

<p><img src="6ec0d65.png" alt="" /></p>

<p>这个属于hibernate知识点了，我这里选择create-drop。</p>

<p>关于spring-data-jpa,确实很轻量很给力</p>

<p>在实际开发过程中，对数据库的操作无非就“增删改查”。就最为普遍的单表操作而言，除了表和字段不同外，语句都是类似的，开发人员需要写大量类似而枯燥的语句来完成业务逻辑。</p>

<p>为了解决这些大量枯燥的数据操作语句，我们第一个想到的是使用ORM框架，比如：Hibernate。通过整合Hibernate之后，我们以操作Java实体的方式最终将数据改变映射到数据库表中。</p>

<p>为了解决抽象各个Java实体基本的“增删改查”操作，我们通常会以泛型的方式封装一个模板Dao来进行抽象简化，但是这样依然不是很方便，我们需要针对每个实体编写一个继承自泛型模板Dao的接口，再编写该接口的实现。虽然一些基础的数据访问已经可以得到很好的复用，但是在代码结构上针对每个实体都会有一堆Dao的接口和实现。</p>

<p>由于模板Dao的实现，使得这些具体实体的Dao层已经变的非常“薄”，有一些具体实体的Dao实现可能完全就是对模板Dao的简单代理，并且往往这样的实现类可能会出现在很多实体上。Spring-data-jpa的出现正可以让这样一个已经很“薄”的数据访问层变成只是一层接口的编写方式。</p>

<p><strong>Spring-data-jpa的能力远不止本文提到的这些，由于本文主要以整合介绍为主，对于Spring-data-jpa的使用只是介绍了常见的使用方式。诸如@Modifying操作、分页排序、原生SQL支持以及与Spring MVC的结合使用等等内容就不在本文中详细展开</strong></p>

<p>@Transactional(isolation = Isolation.DEFAULT)</p>

  </div><div style="width:300px;height:250px;float:left;">
    <!-- 300_250_1 -->
    <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196"
        data-ad-slot="4142158067"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
<div style="width:300px;height:250px;float:left;">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- 300-250-2 -->
    <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196"
        data-ad-slot="5618891265"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div><a class="u-url" href="/2017/springboot%E7%B3%BB%E5%88%97%E4%B8%80%E5%85%A5%E9%97%A8ormtransactionlog4j2%E7%AD%89.html" hidden></a>
</article>
<div class="PageNavigation">
  
  <a class="prev" href="/2017/dubbo%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F%E9%9B%86%E6%88%90springmvc.html">&laquo; dubbo 注解方式集成 springmvc</a>
  
  
  <a class="next" href="/2017/java%E7%BA%BF%E7%A8%8B%E6%95%B0%E8%BF%87%E9%AB%98%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90.html">java线程数过高原因分析 &raquo;</a>
  
</div>
<div class="sfix"><!-- 240x600 -->
<div class="fixedme">
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9477174171188196" data-ad-slot="9597600460"
        data-ad-format="auto"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
<script type="text/javascript">
    function offset(target) {
        var top = 0,
            left = 0

        while (target.offsetParent) {
            top += target.offsetTop
            left += target.offsetLeft
            target = target.offsetParent
        }

        return {
            top: top,
            left: left,
        }
    }
    window.onload = function () {
        var e = document.getElementsByClassName('sfix')[0];
        e.offset = offset(e);

        window.onscroll = function (event) {
            var e = document.getElementsByClassName('sfix')[0];
            if (window.pageYOffset && e.offset && window.pageYOffset > e.offset.top) {
                e.style.position = 'fixed';
                e.style.left = e.offset.left + 'px';
                e.style.right = 'auto';


            } else {
                e.style.position = 'absolute';
                e.style.left = 'auto';
                e.style.right = '-240px';

            }
        }
    }

</script></div>

<style>
  .wrapper {
    position: relative;
  }

  .sfix {
    position: absolute;
    top: 0;
    right: -240px;
    width: 240px;
    height: 600px;
  }

  .PageNavigation {
    font-size: 14px;
    display: block;
    width: auto;
    overflow: hidden;
    clear: both;
  }

  .PageNavigation a {
    display: block;
    width: 50%;
    float: left;
    margin: 1em 0;
  }

  .PageNavigation .next {
    text-align: right;
    float: right;
  }
</style>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Java面试</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Java面试</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
