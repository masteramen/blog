<!-- build time:Sat Oct 27 2018 21:00:22 GMT+0800 (CST) --><!DOCTYPE html><html class="theme-next muse use-motion"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="description" content="在代码中，我们通过 Job job = context.getBean(Job.class); 就可以获得对应的Job类的实例。那么，现在问题来了；仅仅通过一个 getBean 调用就可以获得对应的实例，这是怎么做到的？同时，我们只是get一个Bean，而我们又是从哪里get这个Bean的呢？这篇文章就先来大致说说我们是从哪里获取这个实例对象的。在基于Spring的应用中，我们的应用对象生存于Sp"><meta name="keywords" content="JAVA,面试"><meta property="og:type" content="article"><meta property="og:title" content="初窥Spring之容器"><meta property="og:url" content="http://www.jfox.info/2017/初窥spring之容器.html"><meta property="og:site_name" content="java面试"><meta property="og:description" content="在代码中，我们通过 Job job = context.getBean(Job.class); 就可以获得对应的Job类的实例。那么，现在问题来了；仅仅通过一个 getBean 调用就可以获得对应的实例，这是怎么做到的？同时，我们只是get一个Bean，而我们又是从哪里get这个Bean的呢？这篇文章就先来大致说说我们是从哪里获取这个实例对象的。在基于Spring的应用中，我们的应用对象生存于Sp"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.jfox.info/2017/1043/0c6c67f.png"><meta property="og:updated_time" content="2018-10-27T12:29:37.413Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="初窥Spring之容器"><meta name="twitter:description" content="在代码中，我们通过 Job job = context.getBean(Job.class); 就可以获得对应的Job类的实例。那么，现在问题来了；仅仅通过一个 getBean 调用就可以获得对应的实例，这是怎么做到的？同时，我们只是get一个Bean，而我们又是从哪里get这个Bean的呢？这篇文章就先来大致说说我们是从哪里获取这个实例对象的。在基于Spring的应用中，我们的应用对象生存于Sp"><meta name="twitter:image" content="http://www.jfox.info/2017/1043/0c6c67f.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.jfox.info/2017/初窥spring之容器.html"><title>初窥Spring之容器 | java面试</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">java面试</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.jfox.info/2017/初窥spring之容器.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hello"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="java面试"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">初窥Spring之容器</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-01T23:52:23+08:00">2017-01-01</time></span></div></header><div class="post-body" itemprop="articleBody"><bean id="job" class="com.jellythink.Job"><br><br><constructor-arg ref="juniorengineer"><br></constructor-arg></bean><p>在代码中，我们通过 <code>Job job = context.getBean(Job.class);</code> 就可以获得对应的Job类的实例。那么，现在问题来了；仅仅通过一个 <code>getBean</code> 调用就可以获得对应的实例，这是怎么做到的？同时，我们只是get一个Bean，而我们又是从哪里get这个Bean的呢？这篇文章就先来大致说说我们是从哪里获取这个实例对象的。</p><p>在基于Spring的应用中，我们的应用对象生存于Spring容器中。Spring容器负责创建对象，配置它们并管理它们的整个生命周期，从生存到死亡。首先最重要的是了解容纳对象的容器。理解容器将有助于理解对象是如何被管理的。</p><p>Spring容器并不是只有一个。Spring自带了多个容器实现，可以归为以下两种不同的类型：</p><ul><li>bean工厂（由 <code>org.springframework. beans. factory.eanFactory</code> 接口定义），是最简单的容器，提供基本的DI 支持；</li><li><p>应用上下文（由 <code>org.springframework.context.ApplicationContext</code> 接口定义）基于BeanFactory构建，并提供应用框架级别的服务，例如 从属性文件解析文本信息以及发布应用事件给感兴趣的事件监听者。</p><p>由于bean工厂对大多数应用来说往往太低级了，所以我这里只总结应用上下文的使用。</p></li></ul><h4 id="使用应用上下文"><a href="#使用应用上下文" class="headerlink" title="使用应用上下文"></a>使用应用上下文</h4><p>Spring自带了多种类型的应用上下文，以下几种是比较常用的：</p><ul><li><code>AnnotationConfigApplicationContext</code> ：从一个或多个基于Java的配置类中加载Spring应用上下文；</li><li><code>AnnotationConfigWebApplicationContext</code> ：从一个或多个基于Java的配置类中加载Spring Web应用上下文；</li><li><code>ClassPathXmlApplicationContext</code> ：从类路径下的一个或多个XML配置文件中加载上下文定义，把应用上下文的定义文件 作为类资源；</li><li><code>FileSystemXmlapplicationcontext</code> ：从文件系统下的一个或多个XML配置文件中加载上下文定义；</li><li><p><code>XmlWebApplicationContext</code> ：从Web应用下的一个或多个XML配置文件中加载上下文定义。</p><p>其中 <code>AnnotationConfigWebApplicationContext</code> 和 <code>XmlWebApplicationContext</code> 我会在后面的博文会进行详细的总结，这里先说说剩下三种的使用。</p><p>无论是从文件系统中装载应用上下文还是从类路径下装载应用上下 文，将bean加载到bean工厂的过程都是相似的。</p><p>// 从类路径中加载应用上下文<br>ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(“job.xml”);</p><p>// 从文件系统中加载应用上下文<br>FileSystemXmlApplicationContext context = new FileSystemXmlApplicationContext(“file:/Users/Jelly/job.xml”);</p></li></ul><p>这里有篇文章，重点的总结了 <a href="https://www.jfox.info/go.php?url=http://www.cnblogs.com/homesea/p/4711401.html">Spring中ClassPathXmlApplication和FileSystemXmlApplicationContext使用区别 </a>。</p><p>使用 <code>AnnotationConfigApplicationContext</code> 来配置应用上下文则比较麻烦一些，因为要单独编写一个配置类。</p><p>对于以下的XML配置来说：</p><pre><code>&lt;!-- 创建SeniorEngineer对象 --&gt;
&lt;bean id=&quot;seniorengineer&quot; class=&quot;com.jellythink.SeniorEngineer&quot; /&gt;

&lt;!-- 创建JuniorEngineer对象 --&gt;
&lt;bean id=&quot;juniorengineer&quot; class=&quot;com.jellythink.JuniorEngineer&quot; /&gt;
&lt;bean id=&quot;job&quot; class=&quot;com.jellythink.Job&quot;&gt;
    &lt;!-- 将juniorengineer通过构造函数的方式注入到Job对象中 --&gt;
    &lt;constructor-arg ref=&quot;juniorengineer&quot; /&gt;
&lt;/bean&gt;
</code></pre><p>则需要编写这样的一个配置类：</p><pre><code>@Configuration
public class AppContextDemo {
    @Bean
    public SeniorEngineer seniorengineer() {
        SeniorEngineer seniorengineer = new SeniorEngineer();
        return seniorengineer;
    }

    @Bean
    public JuniorEngineer juniorengineer() {
        JuniorEngineer juniorengineer = new JuniorEngineer();
        return juniorengineer;
    }

    @Bean
    public Job job() {
        JuniorEngineer juniorengineer = new JuniorEngineer();
        Job job = new Job(juniorengineer);
        return job;
    }
}
</code></pre><p>正如您通过以上代码所看到的那样，现在可以以编程的方式将bean 定义为基于Java的配置的一部分。AppContextDemo类现在就像XML一样表示配置类。这是通过利用@Configuration注释实现的。@Configuration注释位于类的顶端。它告知Spring容器这个类是一个拥有bean定义和依赖项的配置类。@Bean注释用于定义bean。上述注释位于实例化bean并设置依赖项的方法上方。方法名称与bean id或默认名称相同。该方法的返回类型是向Spring应用程序上下文注册的bean。您可使用bean的setter方法来设置依赖项，容器将调用它们来连接相关项。基于Java的配置也被视为基于注释的配置。通过以下代码来使用AnnotationConfigApplicationContext注册配置类：</p><pre><code>ApplicationContext context = new AnnotationConfigApplicationContext(AppContextDemo.class);
</code></pre><h4 id="Bean的生命周期"><a href="#Bean的生命周期" class="headerlink" title="Bean的生命周期"></a>Bean的生命周期</h4><p>在传统的Java应用中，bean的生命周期很简单。使用Java关键字new进行bean实例化，然后该bean就可以使用了。一旦该bean不再被使用，则由Java自动进行垃圾回收。</p><p>相比之下，Spring容器中的bean的生命周期就显得相对复杂多了。正确理解Spring bean的生命周期非常重要，因为将来我们可能要利用Spring提供的扩展点来自定义bean的创建过程。下面先通过一张图来说明bean的整个生命周期。</p><p><img src="/2017/1043/0c6c67f.png" alt=""></p><p>从上图中可以看到，在bean准备就绪之前，bean工厂执行了若干启动步骤。下面就对上面的每一步都进行简单的说明：</p><ol><li>Spring对bean进行实例化；</li><li>Spring将值和bean的引用注入到bean对应的属性中；</li><li>如果bean实现了 <code>BeanNameAware</code> 接口，Spring将bean的ID传递给setBean-Name()方法；</li><li>如果bean实现了 <code>BeanFactoryAware</code> 接口，Spring将调用 <code>setBeanFactory()</code> 方法，将BeanFactory容器实例传入；</li><li>如果bean实现了 <code>ApplicationContextAware</code> 接口，Spring将调用 <code>setApplicationContext()</code> 方法，将bean所在的应用上下文的 引用传入进来；</li><li>如果bean实现了 <code>BeanPostProcessor</code> 接口，Spring将调用它们的post-ProcessBeforeInitialization()方法；</li><li>如果bean实现了 <code>InitializingBean</code> 接口，Spring将调用它们的after-PropertiesSet()方法。类似地，如果bean使用init- method声明了初始化方法，该方法也会被调用；</li><li>如果bean实现了 <code>BeanPostProcessor</code> 接口，Spring将调用它们的post-ProcessAfterInitialization()方法；</li><li>此时，bean已经准备就绪，可以被应用程序使用了，它们将一直驻留在应用上下文中，直到该应用上下文被销毁；</li><li><p>如果bean实现了 <code>DisposableBean</code> 接口，Spring将调用它的 <code>destroy()</code> 接口方法。同样，如果bean使用destroy-method声明了销毁方法，该方法也会被调用。</p><p>上面就是一个bean在Spring容器中的整个生命周期。每一阶段都可以针对Spring如何管理bean进行个性化定制，这个就可以根据我们的需要来搞了。</p></li></ol><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>Spring容器这个概念贯穿着整个Spring，我们必须要掌握的知识点，这篇文章也只是总结了一点皮毛，但是对于入门Spring容器还是有很大帮助的，希望大家喜欢。</p><p>无聊而有趣的一天，虚度而又充实的一个周末。</p><p><a href="https://www.jfox.info/go.php?url=http://www.jellythink.com">果冻想 </a>-一个原创技术文章分享网站。</p><p>2017年6月4日 于呼和浩特。</p></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="4142158067"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="5618891265"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/java机试题解析命令行参数.html" rel="next" title="Java 机试题：解析命令行参数"><i class="fa fa-chevron-left"></i> Java 机试题：解析命令行参数</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/关于拒绝测试驱动开发notdd.html" rel="prev" title="关于拒绝测试驱动开发（NoTDD）">关于拒绝测试驱动开发（NoTDD） <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">Overview</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Hello</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">1358</span> <span class="site-state-item-name">posts</span></a></div></nav></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用应用上下文"><span class="nav-number">1.</span> <span class="nav-text">使用应用上下文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bean的生命周期"><span class="nav-number">2.</span> <span class="nav-text">Bean的生命周期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">3.</span> <span class="nav-text">总结</span></a></li></ol></div></div></section></div></aside><div class="sfix"><div class="fixedme"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9477174171188196" data-ad-slot="9597600460" data-ad-format="auto"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Hello</span></div><div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div><span class="post-meta-divider">|</span><div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script></body></html><!-- rebuild by neat -->