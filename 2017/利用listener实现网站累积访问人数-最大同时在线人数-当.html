<!-- build time:Sat Oct 27 2018 21:00:23 GMT+0800 (CST) --><!DOCTYPE html><html class="theme-next muse use-motion"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="description" content="1package com.lt.listener;2 3import java.util.Date;4import java.util.HashMap;5import java.util.Map;6 7import javax.servlet.http.HttpSession;8/ 9 网站全局变量类10 @author LIUTIE11 12/13publicabstractclass Appl"><meta name="keywords" content="JAVA,面试"><meta property="og:type" content="article"><meta property="og:title" content="利用Listener实现网站累积访问人数、最大同时在线人数、当前登录用户数的记录"><meta property="og:url" content="http://www.jfox.info/2017/利用listener实现网站累积访问人数-最大同时在线人数-当.html"><meta property="og:site_name" content="java面试"><meta property="og:description" content="1package com.lt.listener;2 3import java.util.Date;4import java.util.HashMap;5import java.util.Map;6 7import javax.servlet.http.HttpSession;8/ 9 网站全局变量类10 @author LIUTIE11 12/13publicabstractclass Appl"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.jfox.info/2017/0939/f52e568.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/06/ExpandedBlockStart.gif"><meta property="og:image" content="http://www.jfox.info/2017/0939/f52e568.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/06/ExpandedBlockStart.gif"><meta property="og:image" content="http://www.jfox.info/2017/0939/f52e568.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/06/ExpandedBlockStart.gif"><meta property="og:image" content="http://www.jfox.info/2017/0939/f52e568.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/06/ExpandedBlockStart.gif"><meta property="og:updated_time" content="2018-10-27T12:29:40.333Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="利用Listener实现网站累积访问人数、最大同时在线人数、当前登录用户数的记录"><meta name="twitter:description" content="1package com.lt.listener;2 3import java.util.Date;4import java.util.HashMap;5import java.util.Map;6 7import javax.servlet.http.HttpSession;8/ 9 网站全局变量类10 @author LIUTIE11 12/13publicabstractclass Appl"><meta name="twitter:image" content="http://www.jfox.info/2017/0939/f52e568.gif"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.jfox.info/2017/利用listener实现网站累积访问人数-最大同时在线人数-当.html"><title>利用Listener实现网站累积访问人数、最大同时在线人数、当前登录用户数的记录 | java面试</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">java面试</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.jfox.info/2017/利用listener实现网站累积访问人数-最大同时在线人数-当.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hello"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="java面试"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">利用Listener实现网站累积访问人数、最大同时在线人数、当前登录用户数的记录</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-01T23:50:39+08:00">2017-01-01</time></span></div></header><div class="post-body" itemprop="articleBody"><p>1package com.lt.listener;<br>2 3import java.util.Date;<br>4import java.util.HashMap;<br>5import java.util.Map;<br>6 7import javax.servlet.http.HttpSession;<br>8/<strong> 9 <em>网站全局变量类<br>10 </em>@author LIUTIE<br>11 <em><br>12</em>/13publicabstractclass ApplicationConstants {<br>1415/</strong>16 <em>用户登录session名称<br>17</em>/18publicstaticfinal String LOGIN_SESSION_NAME = “userInfo”;<br>1920/<strong>21 <em>索引所有的session<br>22 </em>用于单一登录<br>23*/24publicstatic Map&lt;String,HttpSession&gt; SESSION_MAP = new HashMap&lt;&gt;();<br>2526/</strong>27 <em>当前在线用户数<br>28</em>/29publicstaticint CURRENT_LOGIN_COUNT = 0;<br>3031/<strong>32 <em>历史访客总数<br>33</em>/34publicstaticint TOTAL_HISTORY_COUNT = 0;<br>3536/</strong>37 <em>最高同时在线人数<br>38</em>/39publicstaticint MAX_ONLINE_COUNT = 0;<br>4041/<strong>42 <em>服务器启动时间<br>43</em>/44publicstatic Date SERVER_START_DATE = new Date();<br>4546/</strong>47 <em>最高在线人数时间<br>48</em>/49publicstatic Date MAX_ONLINE_COUNT_DATE = new Date();<br>50515253 }</p><p>View Code<br>2.实现servletContext监听，用于记录服务器信息<br><img src="/2017/0939/f52e568.gif" alt=""><img src="/wp-content/uploads/2017/06/ExpandedBlockStart.gif" alt=""><br>1package com.lt.listener;<br>2 3import java.util.Date;<br>4 5import javax.servlet.ServletContextEvent;<br>6import javax.servlet.ServletContextListener;<br>7 8/<strong><br>9 <em>servletContext监听<br>10 </em>记录服务器信息 启动关闭时间等<br>11 <em>@author LIUTIE<br>12</em><br>13 */<br>14public class MyContextListener implements ServletContextListener {<br>1516 /</strong><br>17 <em>服务器启动时被调用<br>18 </em>/<br>19 @Override<br>20 public void contextDestroyed(ServletContextEvent arg0) {<br>21 //记录启动时间<br>22 ApplicationConstants.SERVER_START_DATE = new Date();<br>23 }<br>2425 /*<em><br>26 </em>服务器关闭时被调用<br>27 */<br>28 @Override<br>29 public void contextInitialized(ServletContextEvent arg0) {<br>30 //保存数据到硬盘<br>31 // TODO Auto-generated method stub<br>32 }<br>3334 }</p><p>View Code<br>3.实现 HttpSessionListener, HttpSessionAttributeListener监听，用于记录登录信息、访问总人数、在线人数，实现单一登录等<br><img src="/2017/0939/f52e568.gif" alt=""><img src="/wp-content/uploads/2017/06/ExpandedBlockStart.gif" alt=""><br>1package com.lt.listener;<br>2 3import java.util.Date;<br>4 5import javax.servlet.http.HttpSession;<br>6import javax.servlet.http.HttpSessionAttributeListener;<br>7import javax.servlet.http.HttpSessionBindingEvent;<br>8import javax.servlet.http.HttpSessionEvent;<br>9import javax.servlet.http.HttpSessionListener;<br>10 11/<strong> 12 <em>session监听<br>13 </em>记录登录信息 访问总人数 在线人数等<br>14 <em>实现单一登录<br>15 </em>@author LIUTIE<br>16 <em><br>17</em>/ 18publicclass MySessionListener implements HttpSessionListener, HttpSessionAttributeListener {<br>19 20/</strong> 21 <em>session创建时被调用<br>22</em>/ 23 @Override<br>24publicvoid sessionCreated(HttpSessionEvent sessionEvent) {<br>25// 获取创建的session 26 HttpSession session = sessionEvent.getSession();<br>27// 添加到map 28 ApplicationConstants.SESSION_MAP.put(session.getId(), session);<br>29// 访问总人数++ 30 ApplicationConstants.TOTAL_HISTORY_COUNT++;<br>31// 如果map总数大于最高同时在线人数则更新最高在线人数及时间 32if (ApplicationConstants.MAX_ONLINE_COUNT &lt; ApplicationConstants.SESSION_MAP.size()) {<br>33 ApplicationConstants.MAX_ONLINE_COUNT = ApplicationConstants.SESSION_MAP.size();<br>34 ApplicationConstants.MAX_ONLINE_COUNT_DATE = new Date();<br>35 }<br>36 37 }<br>38 39/<strong> 40 <em>session销毁时被调用<br>41</em>/ 42 @Override<br>43publicvoid sessionDestroyed(HttpSessionEvent sessionEvent) {<br>44// 获取即将被销毁的session 45 HttpSession session = sessionEvent.getSession();<br>46// 在map中根据key移除 47 ApplicationConstants.SESSION_MAP.remove(session.getId());<br>48 }<br>49 50/</strong> 51 <em>添加session属性时被调用<br>52</em>/ 53 @Override<br>54publicvoid attributeAdded(HttpSessionBindingEvent event) {<br>55// 判断是否添加的用户登录信息session 56if (event.getName().equals(ApplicationConstants.LOGIN_SESSION_NAME)) {<br>57// 当前登录用户数++ 58 ApplicationConstants.CURRENT_LOGIN_COUNT++;<br>59// 是否在其他机器登录处理 60 isLoginInOtherPlace(event);<br>61 }<br>62 }<br>63 64/<strong> 65 <em>移除session属性时被调用<br>66</em>/ 67 @Override<br>68publicvoid attributeRemoved(HttpSessionBindingEvent event) {<br>69// 判断是否移除的用户登录信息session 70if (event.getName().equals(ApplicationConstants.LOGIN_SESSION_NAME)) {<br>71// 当前登录用户数– 72 ApplicationConstants.CURRENT_LOGIN_COUNT–;<br>73// 是否在其他机器登录处理 74 isLoginInOtherPlace(event);<br>75 }<br>76 }<br>77 78/</strong> 79 <em>修改session属性时被调用<br>80</em>/ 81 @Override<br>82publicvoid attributeReplaced(HttpSessionBindingEvent event) {<br>83 84// 判断是否修改的用户登录信息session 85if (event.getName().equals(ApplicationConstants.LOGIN_SESSION_NAME)) {<br>86// 是否在其他机器登录处理 87 isLoginInOtherPlace(event);<br>88 }<br>89 }<br>90 91/*<em> 92 </em>是否在其他机器登录处理<br>93 <em><br>94 </em>@param event<br>95*/ 96privatevoid isLoginInOtherPlace(HttpSessionBindingEvent event) {<br>97// 获取添加的session 98 HttpSession session = event.getSession();<br>99// 遍历查找此用户是否登录100for (HttpSession s : ApplicationConstants.SESSION_MAP.values()) {<br>101// 如果已经在其他机器登录则使其失效102if (event.getValue().equals(s.getAttribute(ApplicationConstants.LOGIN_SESSION_NAME))<br>103 &amp;&amp; session.getId() != s.getId()) {<br>104// 使session失效105 session.invalidate();<br>106break;<br>107 }<br>108 }<br>109 }<br>110 }</p><p>View Code<br>4.实现 request监听，用于记录客户信息 ip、url等<br><img src="/2017/0939/f52e568.gif" alt=""><img src="/wp-content/uploads/2017/06/ExpandedBlockStart.gif" alt=""><br>1package com.lt.listener;<br>2 3import javax.servlet.ServletRequestEvent;<br>4import javax.servlet.ServletRequestListener;<br>5import javax.servlet.http.HttpServletRequest;<br>6 7/<strong> 8 <em>request监听 用于记录客户信息 ip、url等<br>9</em><br>10 <em>@author LIUTIE<br>11</em><br>12*/13publicclass MyRequestListener implements ServletRequestListener {<br>1415/</strong>16 <em>request销毁时调用<br>17</em>/18 @Override<br>19publicvoid requestDestroyed(ServletRequestEvent event) {<br>20// TODO Auto-generated method stub2122 }<br>2324/*<em>25 </em>request创建时调用<br>26*/27 @Override<br>28publicvoid requestInitialized(ServletRequestEvent event) {<br>29 HttpServletRequest request = (HttpServletRequest) event;<br>30// 客户端ip31 String ip = request.getRemoteAddr();<br>32// 访问的URL地址33 String url = request.getRequestURI();<br>34// 只做简单后台打印35 System.out.println(“The client ip is “ + ip);<br>36 System.out.println(“The address url is “ + url);<br>37 }<br>3839 }</p><p>View Code<br>5.在web.xml中配置队一行的listener<br><img src="/2017/0939/f52e568.gif" alt=""><img src="/wp-content/uploads/2017/06/ExpandedBlockStart.gif" alt=""><br><listener><listener-class><br>com.lt.listener.MyContextListener<br></listener-class></listener><listener><listener-class><br>com.lt.listener.MySessionListener<br></listener-class></listener><listener><listener-class><br>com.lt.listener.MyRequestListener<br></listener-class></listener></p><p>View Code<br>Listener种类：</p><p>1.监听对象的创建与销毁的Listener：</p><p>HttpSessionListener： sessionCreated(HttpSessionEvent sessionEvent)、sessionDestroyed(HttpSessionEvent sessionEvent)</p><p>ServletRequestListener： requestInitialized(ServletRequestEvent event)、requestDestroyed(ServletRequestEvent event)</p><p>ServletContextListener： contextInitialized(ServletContextEvent event)、contextDestroyed(ServletContextEvent event)</p><p>2.监听对象的属性变化的Listener：</p><p>HttpSessionAttributeListener：(添加、更新、移除session时触发)</p><p>attributeAdded(HttpSessionBindingEvent event)、attributeReplaced(HttpSessionBindingEvent event)、attributeRemoved(HttpSessionBindingEvent event)</p><p>ServletContextAttributeListener：(添加、更新、移除context时触发)</p><p>attributeAdded(ServletContextAttributeEvent event)、attributeReplaced(ServletContextAttributeEvent event)、attributeRemoved(ServletContextAttributeEvent event)</p><p>ServletRequestAttributeListener：(添加、更新、移除request时触发)</p><p>attributeAdded(ServletRequestAttributeEvent event)、attributeReplaced(ServletRequestAttributeEvent event)、attributeRemoved(ServletRequestAttributeEvent event)</p><p>3.监听Session内的对象</p><p>HttpSessionBindingListener：(对象放入session、对象从session移除时触发)</p><p>valueBound(HttpSessionBindingEvent event)、valueUnbound(HttpSessionBindingEvent event)</p><p>HttpSessionActivationListener：(session中的对象被钝化、对象被重新加载时触发ps：将session中的内容保存到硬盘的过程叫做钝化，钝化需实现Serializable序列化接口)</p><p>sessionWillPassivate(HttpSessionEvent event)、sessionDidActivate(HttpSessionEvent event)</p></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="4142158067"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="5618891265"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/sonarqube搭建.html" rel="next" title="sonarqube搭建"><i class="fa fa-chevron-left"></i> sonarqube搭建</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/最全java学习路线图-java学习指南.html" rel="prev" title="最全Java学习路线图——Java学习指南">最全Java学习路线图——Java学习指南 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Hello</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">1358</span> <span class="site-state-item-name">posts</span></a></div></nav></div></section></div></aside><div class="sfix"><div class="fixedme"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9477174171188196" data-ad-slot="9597600460" data-ad-format="auto"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Hello</span></div><div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div><span class="post-meta-divider">|</span><div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script></body></html><!-- rebuild by neat -->