<!DOCTYPE html>
<html lang="zh_CN"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>java对excel表格的上传和下载处理 | Java面试</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="java对excel表格的上传和下载处理" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="Excel表格文件的上传和下载，java中涉及到文件肯定会有io流的知识。" />
<meta property="og:description" content="Excel表格文件的上传和下载，java中涉及到文件肯定会有io流的知识。" />
<link rel="canonical" href="http://www.jfox.info/2017/java%E5%AF%B9excel%E8%A1%A8%E6%A0%BC%E7%9A%84%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD%E5%A4%84%E7%90%86.html" />
<meta property="og:url" content="http://www.jfox.info/2017/java%E5%AF%B9excel%E8%A1%A8%E6%A0%BC%E7%9A%84%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD%E5%A4%84%E7%90%86.html" />
<meta property="og:site_name" content="Java面试" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-01-01T23:59:49+08:00" />
<script type="application/ld+json">
{"description":"Excel表格文件的上传和下载，java中涉及到文件肯定会有io流的知识。","@type":"BlogPosting","url":"http://www.jfox.info/2017/java%E5%AF%B9excel%E8%A1%A8%E6%A0%BC%E7%9A%84%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD%E5%A4%84%E7%90%86.html","headline":"java对excel表格的上传和下载处理","dateModified":"2017-01-01T23:59:49+08:00","datePublished":"2017-01-01T23:59:49+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.jfox.info/2017/java%E5%AF%B9excel%E8%A1%A8%E6%A0%BC%E7%9A%84%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD%E5%A4%84%E7%90%86.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://www.jfox.info/feed.xml" title="Java面试" /></head><body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Java面试</a><nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
          </svg>
        </span>
      </label>

      <div class="trigger"><a class="page-link" href="/about/">About</a></div>
    </nav></div>
</header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">java对excel表格的上传和下载处理</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2017-01-01T23:59:49+08:00" itemprop="datePublished">Jan 1, 2017
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    
<p>Excel表格文件的上传和下载，java中涉及到文件肯定会有io流的知识。</p>

<p>而excel文件就要涉及到poi技术，而excel的版本包括：2003-2007和2010两个版本， 即excel的后缀名为：xls和xlsx。</p>

<p>这里我是按照正规的项目流程做的案例，所以可能会比网上的一些Demo复杂一些。不过文件的上传和下载基本都是一套固定的流程，只是每个人的实现方式不太相同。</p>

<p>数据库我用的是MySql。</p>

<p><strong>下面是我的项目目录：</strong></p>

<p><img src="4caadfd.png" alt="" /></p>

<p>按照正常的项目做了分层处理，文件上传的业务我放到了service处理，而文件下载业务还在controller层。</p>

<p>对前端请求处理，我分成了两个方法都放在HandleExcelController里面，这个类继承了BaseExcelController,基本的文件操作处理在BaseExcelController里面。</p>

<p>BaseExcelController继承了BaseController，BaseController类是所有controller的父类，这里用到的不太多，这个类封装了response返回值等的处理等一些方法。</p>

<p><strong>项目中除了springMVC和mybatis的jar包之外还引入了：</strong></p>

<p><img src="99dc4d4.png" alt="" /></p>

<p><strong>上传和下载excel文件：</strong></p>

<p><strong>1、创建需要上传的excel文件，为了简化，我这里只写了四列，即四个字段</strong></p>

<p><img src="03ce312.png" alt="" /></p>

<p><strong>2、创建jsp页面</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%@</span> <span class="na">page</span> <span class="na">language=</span><span class="s">"java"</span> <span class="na">import=</span><span class="s">"java.util.*"</span> <span class="na">pageEncoding=</span><span class="s">"UTF-8"</span><span class="err">%</span><span class="nt">&gt;</span> <span class="nt">&lt;</span><span class="err">%@</span><span class="na">taglib</span> <span class="na">prefix=</span><span class="s">"c"</span> <span class="na">uri=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="err">%</span><span class="nt">&gt;</span> <span class="cp">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span> <span class="nt">&lt;html&gt;</span> <span class="nt">&lt;head&gt;</span> <span class="nt">&lt;title&gt;</span>Excel文件处理<span class="nt">&lt;/title&gt;</span> <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"&lt;c:url value='/res/js/jquery.js'/&gt;"</span><span class="nt">&gt;&lt;/script&gt;</span> <span class="nt">&lt;script&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="kd">var</span> <span class="nx">$wrap</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">".wrap"</span><span class="p">);</span> <span class="kd">var</span> <span class="nx">find</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span> <span class="k">return</span> <span class="nx">$wrap</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span> <span class="p">}</span> <span class="kd">var</span> <span class="nx">getJname</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span> <span class="k">return</span> <span class="nx">find</span><span class="p">(</span><span class="s2">"input[name='"</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">"']"</span><span class="p">);</span> <span class="p">}</span> <span class="nx">getJname</span><span class="p">(</span><span class="s2">"Upload"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"tf"</span><span class="p">));</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span> <span class="na">url</span><span class="p">:</span><span class="s2">"&lt;c:url value='/File/UploadExcel'/&gt;"</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span><span class="s2">"post"</span><span class="p">,</span> <span class="na">data</span><span class="p">:</span><span class="nx">form</span><span class="p">,</span> <span class="na">dataType</span><span class="p">:</span><span class="s2">"json"</span><span class="p">,</span> <span class="na">processData</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span> <span class="na">contentType</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span> <span class="na">success</span><span class="p">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span> <span class="c1">//window.clearInterval(timer); if(data.success == "success"){ alert("提交文件成功,已将数据存入数据库"); } }, error:function(e){ alert("错误！"); //window.clearInterval(timer);  } }); }) getJname("Download").click(function(){ $.post("</span><span class="o">&lt;</span><span class="na">c</span><span class="p">:</span><span class="nx">url</span> <span class="nx">value</span><span class="o">=</span><span class="s1">'/File/DownLoadExcel'</span><span class="o">/&gt;</span><span class="s2">",{"</span><span class="nx">id</span><span class="s2">":"</span><span class="mi">3</span><span class="s2">"},function(data){ //alert("</span><span class="err">下载文件成功</span><span class="s2">");  },"</span><span class="nx">json</span><span class="s2">") }) }) </span><span class="nt">&lt;/script&gt;</span> <span class="nt">&lt;/head&gt;</span> <span class="nt">&lt;body&gt;</span> <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"wrap"</span><span class="nt">&gt;</span> <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"tf"</span><span class="nt">&gt;</span> <span class="nt">&lt;p&gt;</span> <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">value=</span><span class="s">"选择文件"</span><span class="nt">/&gt;</span> Excel文件上传：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">name=</span><span class="s">"Upload"</span> <span class="na">value=</span><span class="s">"upload"</span><span class="nt">/&gt;</span> <span class="nt">&lt;/p&gt;</span> <span class="nt">&lt;p&gt;</span> Excel文件下载：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">name=</span><span class="s">"Download"</span> <span class="na">value=</span><span class="s">"updown"</span><span class="nt">/&gt;</span> <span class="nt">&lt;/p&gt;</span> <span class="nt">&lt;/form&gt;</span> <span class="nt">&lt;/div&gt;</span> <span class="nt">&lt;/body&gt;</span> <span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p><strong>3、依次创建controller、service、domain、mapper层，注意它们的依赖关系</strong></p>

<p>1）、controller层的处理，在HandleExcelController里面注入BaseExcelService。因为只是做个示范，所欲我这里将泛型固定为Students类</p>

<p>BaseExcelController代码：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">cn</span><span class="p">.</span><span class="n">wangze</span><span class="p">.</span><span class="n">controller</span><span class="p">;</span>

<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">File</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">FileInputStream</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">FileNotFoundException</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">FileOutputStream</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">IOException</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">InputStream</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">Method</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">SimpleDateFormat</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">Collection</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">Date</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">Iterator</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="k">List</span><span class="p">;</span> <span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">HttpServletResponse</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">commons</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">StringUtils</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">hssf</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">HSSFCell</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">hssf</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">HSSFCellStyle</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">hssf</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">HSSFFont</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">hssf</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">HSSFPalette</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">hssf</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">HSSFRichTextString</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">hssf</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">HSSFRow</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">hssf</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">HSSFSheet</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">hssf</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">HSSFWorkbook</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">hssf</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">CellRangeAddress</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">hssf</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">HSSFColor</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">ss</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">Sheet</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">xssf</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">XSSFWorkbook</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">multipart</span><span class="p">.</span><span class="n">MultipartFile</span><span class="p">;</span> <span class="n">import</span> <span class="n">cn</span><span class="p">.</span><span class="n">wangze</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">Students</span><span class="p">;</span> <span class="k">public</span> <span class="n">class</span> <span class="n">BaseExcelController</span> <span class="n">extends</span> <span class="n">BaseController</span><span class="p">{</span> <span class="p">//</span><span class="err">获取文件的路径</span> <span class="k">String</span> <span class="n">separator</span> <span class="p">=</span> <span class="nf">System</span><span class="p">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s2">"file.separator"</span><span class="p">);</span> <span class="p">//</span><span class="err">验证元素是否为空</span> <span class="p">@</span><span class="n">SuppressWarnings</span><span class="p">(</span><span class="s2">"all"</span><span class="p">)</span> <span class="k">public</span> <span class="k">boolean</span> <span class="n">isEmpty</span><span class="p">(</span><span class="n">Object</span> <span class="n">obj</span><span class="p">){</span> <span class="k">if</span><span class="p">(</span><span class="n">obj</span> <span class="n">instanceof</span> <span class="n">Object</span><span class="p">[]){</span> <span class="k">if</span><span class="p">(((</span><span class="n">Object</span><span class="p">[])</span> <span class="n">obj</span><span class="p">).</span><span class="n">length</span><span class="p">==</span><span class="m">0</span><span class="p">){</span> <span class="n">return</span> <span class="nb">true</span><span class="p">;</span> <span class="p">}</span> <span class="k">if</span><span class="p">(</span><span class="n">obj</span> <span class="p">==</span> <span class="n">null</span><span class="p">)</span> <span class="n">return</span> <span class="nb">true</span><span class="p">;</span> <span class="k">if</span><span class="p">((</span><span class="k">String</span><span class="p">.</span><span class="n">valueOf</span><span class="p">(</span><span class="n">obj</span><span class="p">).</span><span class="nf">trim</span><span class="p">()).</span><span class="n">length</span><span class="p">()</span> <span class="p">==</span> <span class="m">0</span><span class="p">){</span> <span class="n">return</span> <span class="nb">true</span><span class="p">;</span> <span class="p">}</span> <span class="k">if</span><span class="p">(</span><span class="n">obj</span> <span class="n">instanceof</span> <span class="k">List</span><span class="p">){</span> <span class="k">if</span><span class="p">(((</span><span class="k">List</span><span class="p">)</span> <span class="n">obj</span><span class="p">)</span> <span class="p">==</span> <span class="n">null</span> <span class="p">||</span> <span class="p">((</span><span class="k">List</span><span class="p">)</span><span class="n">obj</span><span class="p">).</span><span class="n">size</span><span class="p">()</span> <span class="p">==</span> <span class="m">0</span><span class="p">){</span> <span class="n">return</span> <span class="nb">true</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="n">return</span> <span class="nb">false</span><span class="p">;</span> <span class="p">}</span> <span class="p">/**</span> <span class="p">*</span> <span class="err">文件上传部分</span> <span class="p">*</span> <span class="p">*/</span> <span class="p">//</span><span class="err">验证文件</span> <span class="n">protected</span> <span class="k">boolean</span> <span class="n">checkPathName</span><span class="p">(</span><span class="k">String</span> <span class="n">fileName</span><span class="p">,</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="p">){</span> <span class="p">//</span><span class="err">验证文件是否存在</span> <span class="k">if</span><span class="p">(</span><span class="n">isEmpty</span><span class="p">(</span><span class="n">fileName</span><span class="p">)){</span> <span class="n">sendError</span><span class="p">(</span><span class="s2">"上传文件不存在"</span><span class="p">,</span><span class="n">response</span><span class="p">);</span> <span class="n">return</span> <span class="nb">false</span><span class="p">;</span> <span class="p">}</span> <span class="p">//</span><span class="err">验证文件是否是以</span><span class="n">xls</span><span class="err">或者</span><span class="n">xlsx</span><span class="err">做后缀的文件，如果不是就返回错误信息</span> <span class="k">if</span><span class="p">(</span><span class="c1">!(StringUtils.endsWithIgnoreCase(fileName,".xls")||StringUtils.endsWithIgnoreCase(fileName, ".xlsx"))){ sendError("上传文件类型错误，请核对后重新上传?",response); } return true; } //获取文件的sheet protected Sheet getSheet(MultipartFile file,String path,String fileName) throws IllegalStateException, IOException{ //找到要存放到项目里面的路径，新建文件 File targetFile = new File(path, fileName); targetFile.mkdirs(); if (targetFile.exists()) { targetFile.delete(); file.transferTo(targetFile); } else { file.transferTo(targetFile); } //封装输入流,封装sheet里面的内容 InputStream is = null; try{ is = new FileInputStream(path+separator+fileName); //判断版本是否为Excel加强版 if(StringUtils.endsWithIgnoreCase(fileName, ".xls")){ return new HSSFWorkbook(is).getSheetAt(0); }else if(StringUtils.endsWithIgnoreCase(fileName, ".xlsx")){ return new XSSFWorkbook(is).getSheetAt(0); } return null; } finally{ if(is != null){ is.close(); } } } /** * 文件下载部分 * */ //根据传入的Sting值，判断生成在excel表的位置 private HSSFCellStyle getPublicStyle(HSSFWorkbook workbook,String key){ HSSFFont font = workbook.createFont(); HSSFCellStyle style = workbook.createCellStyle(); HSSFPalette customPalette = workbook.getCustomPalette(); customPalette.setColorAtIndex(HSSFColor.TEAL.index, (byte) 64, (byte) 148, (byte) 160); customPalette.setColorAtIndex(HSSFColor.ORANGE.index, (byte) 170, (byte) 204, (byte) 204); style.setAlignment(HSSFCellStyle.ALIGN_CENTER); style.setVerticalAlignment(HSSFCellStyle.VERTICAL_CENTER); if(key=="head"){ style.setFillPattern(HSSFCellStyle.SOLID_FOREGROUND); font.setFontHeightInPoints((short)12); font.setColor(HSSFColor.TEAL.index); font.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD); style.setFont(font); } if(key=="title"){ font.setColor(HSSFColor.WHITE.index); font.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD); style.setBorderLeft(HSSFCellStyle.BORDER_THIN); style.setLeftBorderColor(HSSFColor.WHITE.index); style.setBorderRight(HSSFCellStyle.BORDER_THIN); style.setRightBorderColor(HSSFColor.WHITE.index); style.setFont(font); style.setFillPattern(HSSFCellStyle.SOLID_FOREGROUND); style.setFillForegroundColor(HSSFColor.ORANGE.index); style.setFillBackgroundColor(HSSFColor.ORANGE.index); } return style; } //创建head头信息 private void createHead(HSSFSheet sheet,HSSFCellStyle style,String[] title){ HSSFRow row1 = sheet.createRow(0); HSSFCell cellTitle = row1.createCell(0); cellTitle.setCellValue(new HSSFRichTextString(title[0])); sheet.addMergedRegion(new CellRangeAddress(0,0,0,title.length-2)); cellTitle.setCellStyle(style); } //创建title信息 private void createTitle(HSSFSheet sheet,HSSFCellStyle style,String[] label,int columnNum){ HSSFRow row2 = sheet.createRow(1); HSSFCell cell1 = null; for(int n=0;n&lt;columnNum;n++){ cell1 = row2.createCell(n); cell1.setCellValue(label[n+1]); cell1.setCellStyle(style); } } //创建content数据信息 private void createContent(HSSFSheet sheet,HSSFCellStyle style,Collection&lt;Students&gt; list,int columnNum,String[] parameters){ int index= 0; Iterator&lt;Students&gt; it = list.iterator(); while(it.hasNext()){ index++; Students cash = it.next(); int num2 = parameters.length; HSSFRow row = sheet.createRow(index+1); initCells(style, num2,cash, parameters,row); } } //验证是否为中文 public boolean checkChinese(String s){ int n=0; boolean flag =false; for(int i=0; i&lt;s.length(); i++) { n = (int)s.charAt(i); flag=(19968 &lt;= n &amp;&amp; n &lt;40623)?true:false; } return flag; } //将数据设置到excel表格内 public void initCells(HSSFCellStyle style, int columnNum, Students t, String[] endContent, HSSFRow row3) { for(int j=0;j&lt;columnNum;j++){ HSSFCell cell = row3.createCell(j); String fieldName = endContent[j]; try{ if(fieldName!="" &amp;&amp; !checkChinese(fieldName)){ String getMethodName = "get" +fieldName.substring(0,1).toUpperCase()+fieldName.substring(1); Class clazz = t.getClass(); Method getMethod = clazz.getMethod(getMethodName, new Class[]{}); String value = (String)getMethod.invoke(t, new Object[]{}); cell.setCellValue(value); }else{ cell.setCellValue(fieldName); } cell.setCellStyle(style); }catch(Exception e){ e.printStackTrace(); } } } public void createEnd(HSSFSheet sheet,HSSFCellStyle style,int numText,int columnNum,Students t,String[] endContent){ HSSFRow row3 = sheet.createRow(numText+2); initCells(style, columnNum, t, endContent, row3); } //根据service查询到的数据，创建excel表并插入查询的数据信息 protected String getOutputName(List&lt;Students&gt; list, String path, String[] title, String[] parameters, Students t, String[] endContent) throws IOException{ //根据传入的title数组的第一个值，设置文件名称 String filename = title[0]+"_"+ new SimpleDateFormat("yyyyMMdd").format(new Date())+".xls"; //输出流放到文件的本地位置 FileOutputStream fos = new FileOutputStream(path+separator+filename); //列数，根据title的个数，除去第一个就是每列title的信息 int columnNum = title.length-1; int numText = list.size(); HSSFWorkbook workbook = new HSSFWorkbook(); HSSFSheet sheet = workbook.createSheet(); sheet.setDefaultColumnWidth (20); sheet.setDefaultRowHeight((short)400); HSSFCellStyle contentStyle = this.getPublicStyle(workbook,""); HSSFCellStyle titleStyle = this.getPublicStyle(workbook,"title"); HSSFCellStyle headerStyle = this.getPublicStyle(workbook,"head"); createHead(sheet,headerStyle,title); createTitle(sheet,titleStyle,title,columnNum); createContent(sheet,contentStyle,list,columnNum,parameters); //createEnd(sheet,contentStyle,numText,columnNum,t,endContent);  workbook.write(fos); fos.flush(); fos.close(); return filename; } }
</span></code></pre></div></div>

<p>HandleExcelController用来处理前端请求，代码如下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">cn</span><span class="p">.</span><span class="n">wangze</span><span class="p">.</span><span class="n">controller</span><span class="p">;</span>

<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">File</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="k">List</span><span class="p">;</span> <span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">ServletOutputStream</span><span class="p">;</span> <span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">HttpServletResponse</span><span class="p">;</span> <span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">HttpSession</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">commons</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">FileUtils</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">beans</span><span class="p">.</span><span class="n">factory</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">Autowired</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">stereotype</span><span class="p">.</span><span class="n">Controller</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">bind</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">RequestMapping</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">multipart</span><span class="p">.</span><span class="n">MultipartFile</span><span class="p">;</span> <span class="n">import</span> <span class="n">cn</span><span class="p">.</span><span class="n">wangze</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">Students</span><span class="p">;</span> <span class="n">import</span> <span class="n">cn</span><span class="p">.</span><span class="n">wangze</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">BaseExcelService</span><span class="p">;</span> <span class="p">@</span><span class="n">Controller</span> <span class="p">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="s2">"/File"</span><span class="p">)</span> <span class="k">public</span> <span class="n">class</span> <span class="n">HandleExcelController</span> <span class="n">extends</span> <span class="n">BaseExcelController</span><span class="p">{</span> <span class="p">@</span><span class="n">Autowired</span> <span class="n">private</span> <span class="n">BaseExcelService</span> <span class="n">baseExcelService</span><span class="p">;</span> <span class="p">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="s2">"/UploadExcel"</span><span class="p">)</span> <span class="k">public</span> <span class="n">void</span> <span class="n">UploadExcel</span><span class="p">(</span><span class="n">MultipartFile</span> <span class="n">file</span><span class="p">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="p">,</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="p">)</span> <span class="n">throws</span> <span class="n">Exception</span><span class="p">{</span> <span class="p">//</span><span class="err">如果上传的文件不存在，抛出异常</span> <span class="k">if</span><span class="p">(</span><span class="n">file</span> <span class="p">==</span> <span class="n">null</span><span class="p">){</span> <span class="n">throw</span> <span class="n">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s2">"文件不存在"</span><span class="p">);</span> <span class="p">}</span> <span class="p">//</span><span class="err">获取文件名</span> <span class="k">String</span> <span class="n">fileName</span> <span class="p">=</span> <span class="n">file</span><span class="p">.</span><span class="n">getOriginalFilename</span><span class="p">();</span> <span class="p">//</span><span class="err">选择上传的文件存放到项目的路径</span> <span class="k">String</span> <span class="n">path</span> <span class="p">=</span> <span class="n">session</span><span class="p">.</span><span class="n">getServletContext</span><span class="p">().</span><span class="n">getRealPath</span><span class="p">(</span><span class="n">separator</span><span class="p">+</span><span class="s2">"res"</span><span class="p">+</span><span class="n">separator</span><span class="p">+</span><span class="s2">"upload"</span><span class="p">);</span> <span class="k">if</span><span class="p">(</span><span class="c1">!checkPathName(fileName,response)) return ; String msg = baseExcelService.loadExcel(getSheet(file, path, fileName)); sendMsg(true,msg,response); } @RequestMapping("/DownLoadExcel") public void UpdownExcel(Students student,HttpServletResponse res,HttpSession session,HttpServletResponse response) throws Exception{ List&lt;Students&gt; stus = baseExcelService.queryList(student); if(stus.size()==0){ res.sendRedirect("/index.jsp"); return; } //下载的excel文件存放的本地路径 String path = session.getServletContext().getRealPath(separator+"res"+separator+"exportExcel"+separator); ServletOutputStream os = res.getOutputStream(); Students t = baseExcelService.queryTotal(student); //标题文字，数值中的第一个值+当前日期为文件名称，以后的每个元素为每列的标题 String[] title={"studets04","id","名字","年龄","性别"};//标题文字 //对应实体类的属性值 String[] parameters ={"id","name","age","sex"}; String[] endContent = {"","","",""}; //调用父类的处理方法，生成excel文件 String filename = getOutputName(stus,path,title,parameters,t,endContent); try { res.reset(); res.setCharacterEncoding("utf8"); res.setContentType("application/vnd.ms-excel;charset=utf8"); res.setHeader("Content-Disposition", "attachment;fileName=" +new String(filename.getBytes("utf-8"),"iso-8859-1")); os.write(FileUtils.readFileToByteArray(new File(path+separator+filename))); sendResult(true,response); os.flush(); } finally { if (os != null) { os.close(); } } } }
</span></code></pre></div></div>

<p>2）、service层的处理，把StudentsMapper注入到BaseExcelService</p>

<p>BaseExcelService代码：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">cn</span><span class="p">.</span><span class="n">wangze</span><span class="p">.</span><span class="n">service</span><span class="p">;</span>

<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">ArrayList</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">HashMap</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="k">List</span><span class="p">;</span> <span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">Map</span><span class="p">;</span> <span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">ServletOutputStream</span><span class="p">;</span> <span class="n">import</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">HttpSession</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">ss</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">Cell</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">ss</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">Row</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">poi</span><span class="p">.</span><span class="n">ss</span><span class="p">.</span><span class="n">usermodel</span><span class="p">.</span><span class="n">Sheet</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">beans</span><span class="p">.</span><span class="n">factory</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">Autowired</span><span class="p">;</span> <span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">stereotype</span><span class="p">.</span><span class="n">Service</span><span class="p">;</span> <span class="n">import</span> <span class="n">cn</span><span class="p">.</span><span class="n">wangze</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">Students</span><span class="p">;</span> <span class="n">import</span> <span class="n">cn</span><span class="p">.</span><span class="n">wangze</span><span class="p">.</span><span class="n">mapper</span><span class="p">.</span><span class="n">StudentsMapper</span><span class="p">;</span> <span class="p">@</span><span class="n">Service</span> <span class="k">public</span> <span class="n">class</span> <span class="n">BaseExcelService</span> <span class="p">{</span> <span class="p">@</span><span class="n">Autowired</span> <span class="n">private</span> <span class="n">StudentsMapper</span><span class="p">&lt;</span><span class="n">Students</span><span class="p">&gt;</span> <span class="n">studentsMapper</span><span class="p">;</span> <span class="p">//</span><span class="err">判断字符串是否为空</span> <span class="k">public</span> <span class="k">boolean</span> <span class="n">isEmpty</span><span class="p">(</span><span class="k">String</span> <span class="n">str</span><span class="p">)</span> <span class="p">{</span> <span class="n">return</span> <span class="n">str</span> <span class="p">==</span> <span class="n">null</span> <span class="p">||</span> <span class="n">str</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="p">==</span> <span class="m">0</span><span class="p">;</span> <span class="p">}</span> <span class="p">//</span><span class="err">获取单个表格</span><span class="p">(</span><span class="err">字段</span><span class="p">)</span><span class="err">存放的信息</span> <span class="n">private</span> <span class="k">String</span> <span class="nf">getValue</span><span class="p">(</span><span class="n">Cell</span> <span class="n">cell</span><span class="p">,</span><span class="k">String</span> <span class="n">cellLable</span><span class="p">,</span><span class="n">Map</span><span class="p">&lt;</span><span class="k">String</span><span class="p">,</span><span class="k">String</span><span class="p">&gt;</span> <span class="n">errMap</span><span class="p">){</span> <span class="n">cell</span><span class="p">.</span><span class="n">setCellType</span><span class="p">(</span><span class="n">Cell</span><span class="p">.</span><span class="n">CELL_TYPE_STRING</span><span class="p">);</span> <span class="k">String</span> <span class="n">value</span> <span class="p">=</span> <span class="n">cell</span><span class="p">.</span><span class="n">getStringCellValue</span><span class="p">().</span><span class="nf">trim</span><span class="p">();</span> <span class="n">return</span> <span class="n">value</span><span class="p">;</span> <span class="p">}</span> <span class="p">//</span><span class="err">通过这个方法将</span><span class="n">excel</span><span class="err">表的每行的数据放到</span><span class="n">info</span><span class="err">对象里面</span> <span class="n">private</span> <span class="k">String</span> <span class="n">addInfo</span><span class="p">(</span><span class="n">Row</span> <span class="n">row</span><span class="p">,</span><span class="n">Students</span> <span class="n">info</span><span class="p">){</span> <span class="n">Map</span><span class="p">&lt;</span><span class="k">String</span><span class="p">,</span><span class="k">String</span><span class="p">&gt;</span> <span class="n">errMap</span> <span class="p">=</span> <span class="n">new</span> <span class="n">HashMap</span><span class="p">&lt;</span><span class="k">String</span><span class="p">,</span><span class="k">String</span><span class="p">&gt;();</span> <span class="k">String</span> <span class="n">id</span> <span class="p">=</span> <span class="nf">getValue</span><span class="p">(</span><span class="n">row</span><span class="p">.</span><span class="n">getCell</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="s2">"ID"</span><span class="p">,</span><span class="n">errMap</span><span class="p">);</span> <span class="k">String</span> <span class="n">username</span> <span class="p">=</span> <span class="nf">getValue</span><span class="p">(</span><span class="n">row</span><span class="p">.</span><span class="n">getCell</span><span class="p">(</span><span class="m">1</span><span class="p">),</span><span class="s2">"姓名"</span><span class="p">,</span><span class="n">errMap</span><span class="p">);</span> <span class="k">String</span> <span class="n">age</span> <span class="p">=</span> <span class="nf">getValue</span><span class="p">(</span><span class="n">row</span><span class="p">.</span><span class="n">getCell</span><span class="p">(</span><span class="m">2</span><span class="p">),</span><span class="s2">"年龄"</span><span class="p">,</span><span class="n">errMap</span><span class="p">);</span> <span class="k">String</span> <span class="n">sex</span> <span class="p">=</span> <span class="nf">getValue</span><span class="p">(</span><span class="n">row</span><span class="p">.</span><span class="n">getCell</span><span class="p">(</span><span class="m">3</span><span class="p">),</span><span class="s2">"性别"</span><span class="p">,</span><span class="n">errMap</span><span class="p">);</span> <span class="k">String</span> <span class="n">errMsg</span> <span class="p">=</span> <span class="n">errMap</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"errMsg"</span><span class="p">);</span> <span class="k">if</span><span class="p">(</span><span class="c1">!isEmpty(errMsg)){ return errMsg; } info.setId(id); info.setName(username); info.setAge(age); info.setSex(sex); return null; } public String loadExcel(Sheet sheet) throws Exception{ //新建一个List集合，用来存放所有行信息，即每行为单条实体信息 List&lt;Students&gt; infos = new ArrayList&lt;Students&gt;(); //获取到数据行数，第一行是title，不需要存入数据库，所以rowNum从1开始 for (int rowNum = 1; rowNum &lt;= sheet.getLastRowNum(); rowNum++) { Students info = new Students(); String errMsg2 = addInfo(sheet.getRow(rowNum),info); if(errMsg2 != null) return errMsg2; infos.add(info); } if(infos.isEmpty()){ return "没有解析到学生数据，请查验EXCEL文件"; } //通过studentsMapper的insertSheetData方法，将实体类存放的数据插入到数据库 int result = studentsMapper.insertSheetData(infos); //若插入成功会返回大于1的整数，返回success if(result &gt;= 1){ return "success"; } return "error"; } //查询所有数据库存放的学生信息 public List&lt;Students&gt; queryList(Students students){ return studentsMapper.queryList(students); } //获取到的学生实体信息 public Students queryTotal(Students students){ return studentsMapper.queryTotal(students); } public void downExcel(HttpSession session,String separator){ } }
</span></code></pre></div></div>

<p>3）、实体层的处理，字段要对应excel表的字段</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">cn</span><span class="p">.</span><span class="n">wangze</span><span class="p">.</span><span class="n">domain</span><span class="p">;</span>

<span class="k">public</span> <span class="n">class</span> <span class="n">Students</span> <span class="p">{</span> <span class="k">String</span> <span class="n">id</span><span class="p">;</span> <span class="k">String</span> <span class="n">name</span><span class="p">;</span> <span class="k">String</span> <span class="n">age</span><span class="p">;</span> <span class="k">String</span> <span class="n">sex</span><span class="p">;</span> <span class="k">public</span> <span class="k">String</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span> <span class="n">return</span> <span class="n">id</span><span class="p">;</span> <span class="p">}</span> <span class="k">public</span> <span class="n">void</span> <span class="n">setId</span><span class="p">(</span><span class="k">String</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="n">this</span><span class="p">.</span><span class="n">id</span> <span class="p">=</span> <span class="n">id</span><span class="p">;</span> <span class="p">}</span> <span class="k">public</span> <span class="k">String</span> <span class="n">getName</span><span class="p">()</span> <span class="p">{</span> <span class="n">return</span> <span class="n">name</span><span class="p">;</span> <span class="p">}</span> <span class="k">public</span> <span class="n">void</span> <span class="n">setName</span><span class="p">(</span><span class="k">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span> <span class="n">this</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span> <span class="p">}</span> <span class="k">public</span> <span class="k">String</span> <span class="n">getAge</span><span class="p">()</span> <span class="p">{</span> <span class="n">return</span> <span class="n">age</span><span class="p">;</span> <span class="p">}</span> <span class="k">public</span> <span class="n">void</span> <span class="n">setAge</span><span class="p">(</span><span class="k">String</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span> <span class="n">this</span><span class="p">.</span><span class="n">age</span> <span class="p">=</span> <span class="n">age</span><span class="p">;</span> <span class="p">}</span> <span class="k">public</span> <span class="k">String</span> <span class="n">getSex</span><span class="p">()</span> <span class="p">{</span> <span class="n">return</span> <span class="n">sex</span><span class="p">;</span> <span class="p">}</span> <span class="k">public</span> <span class="n">void</span> <span class="n">setSex</span><span class="p">(</span><span class="k">String</span> <span class="n">sex</span><span class="p">)</span> <span class="p">{</span> <span class="n">this</span><span class="p">.</span><span class="n">sex</span> <span class="p">=</span> <span class="n">sex</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></div></div>

<p>4）、dao层处理：StudentsMapper.java是一个接口，业务到数据库需要执行的方法在这里声明，StudentsMapper.xml相当于接口的实现类，用来连接java和数据库的操作。</p>

<p>StudentsMapper.java代码：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">cn</span><span class="p">.</span><span class="n">wangze</span><span class="p">.</span><span class="n">mapper</span><span class="p">;</span>

<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="k">List</span><span class="p">;</span> <span class="k">public</span> <span class="n">interface</span> <span class="n">StudentsMapper</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">{</span> <span class="k">public</span> <span class="n">int</span> <span class="n">insertSheetData</span><span class="p">(</span><span class="k">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="k">list</span><span class="p">);</span> <span class="k">public</span> <span class="k">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">queryList</span><span class="p">(</span><span class="n">T</span> <span class="n">t</span><span class="p">);</span> <span class="k">public</span> <span class="n">T</span> <span class="n">queryTotal</span><span class="p">(</span><span class="n">T</span> <span class="n">t</span><span class="p">);</span> <span class="p">}</span>
</code></pre></div></div>

<p>StudentsMapper.xml代码：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">"cn.wangze.mapper.StudentsMapper"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">"ColumnList"</span><span class="nt">&gt;</span>
        id,name,age,sex
    <span class="nt">&lt;/sql&gt;</span>
    <span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">"ColumnList_t"</span> <span class="nt">&gt;</span> t.id,t.name,t.age,t.sex <span class="nt">&lt;/sql&gt;</span> <span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">"ValueList"</span><span class="nt">&gt;</span> #{id},#{name},#{age},#{sex} <span class="nt">&lt;/sql&gt;</span> <span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">"WhereClause"</span><span class="nt">&gt;</span> where 1=1 <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"id!=null and id!=''"</span><span class="nt">&gt;</span>and id=#{id}<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"name!=null and name!=''"</span><span class="nt">&gt;</span>and name=#{name}<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"age!=null and age!=''"</span><span class="nt">&gt;</span>and age=#{age}<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"sex!=null and sex!=''"</span><span class="nt">&gt;</span>and sex=#{sex}<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;/sql&gt;</span> <span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">"WhereClause_pager"</span> <span class="nt">&gt;</span> where 1=1 <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"t.id!=null and t.id!=''"</span><span class="nt">&gt;</span>and id=#{t.id}<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"t.name!=null and t.name!=''"</span><span class="nt">&gt;</span>and name=#{t.name}<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"t.age!=null"</span><span class="nt">&gt;</span>and age=#{t.age}<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"t.sex!=null and t.sex!=''"</span><span class="nt">&gt;</span>and sex=#{t.sex}<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;/sql&gt;</span> <span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">"SetClause"</span> <span class="nt">&gt;</span> set <span class="nt">&lt;trim</span> <span class="na">suffixOverrides=</span><span class="s">","</span> <span class="nt">&gt;</span> <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"id!=null"</span><span class="nt">&gt;</span>id=#{id},<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"name!=null"</span><span class="nt">&gt;</span>name=#{name},<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"pid!=null"</span><span class="nt">&gt;</span>age=#{age},<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"url!=null"</span><span class="nt">&gt;</span>sex=#{sex},<span class="nt">&lt;/if&gt;</span> <span class="nt">&lt;/trim&gt;</span> <span class="nt">&lt;/sql&gt;</span> <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"queryList"</span> <span class="na">resultType=</span><span class="s">"Students"</span><span class="nt">&gt;</span> select <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">"ColumnList"</span><span class="nt">/&gt;</span> from students <span class="nt">&lt;/select&gt;</span> <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"queryTotal"</span> <span class="na">parameterType=</span><span class="s">"Students"</span> <span class="na">resultType=</span><span class="s">"Students"</span><span class="nt">&gt;</span> select <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">"ColumnList"</span> <span class="nt">/&gt;</span> from students <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">"WhereClause"</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- (select &lt;include refid="ColumnList"/&gt; from t_account_cash t &lt;include refid="WhereClauseQuery"/&gt; group by to_char(t.add_time,'yyyy-mm-dd'),t.account_id) a --&gt;</span> <span class="nt">&lt;/select&gt;</span> <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">"insertSheetData"</span> <span class="na">useGeneratedKeys=</span><span class="s">"true"</span> <span class="na">parameterType=</span><span class="s">"java.util.List"</span><span class="nt">&gt;</span> <span class="c">&lt;!-- &lt;selectKey resultType="long" keyProperty="id" order="AFTER"&gt; SELECT LAST_INSERT_ID() &lt;/selectKey&gt; --&gt;</span> insert into students (id,name,age,sex) values <span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">"list"</span> <span class="na">item=</span><span class="s">"item"</span> <span class="na">index=</span><span class="s">"index"</span> <span class="na">separator=</span><span class="s">","</span> <span class="nt">&gt;</span> (#{item.id},#{item.name},#{item.age},#{item.sex}) <span class="nt">&lt;/foreach&gt;</span> <span class="nt">&lt;/insert&gt;</span> <span class="nt">&lt;/mapper&gt;</span>
</code></pre></div></div>

<p><strong>所有的代码就是这些了，操作的时候需要注意的多是路径的问题。最复杂的就是BaseExcelController的操作，它做的事情就是解析上传和创建下载excel文件。</strong></p>

<p><strong>执行完之后的结果图是这样：</strong></p>

<p>在数据库查看上传的excel表：</p>

<p><strong><img src="277cff0.png" alt="" /></strong></p>

<p>下载到D:\tomcat\tomcat6.0.32\webapps\ExcelHandleDemo\res\exportExcel文件夹下的excel表：</p>

<p><img src="0a0df62.png" alt="" /></p>

<p>这里有一点不足的地方，我相信你已经发现了，就是下载完excel表格之后，前端还没有和业务对接上，没有相应的提示来告诉操作人执行结果，只能通过代码设置好的路径去查看文件夹下是否有下载的excel文件，</p>

<p>不过这都是细节问题，相信难不倒聪明的各位。</p>

<p>这些代码是从项目里面摘出来的，所以有些可以优化的地方，视个人业务情况而定。</p>

  </div><div style="width:300px;height:250px;float:left;">
    <!-- 300_250_1 -->
    <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196"
        data-ad-slot="4142158067"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
<div style="width:300px;height:250px;float:left;">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- 300-250-2 -->
    <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196"
        data-ad-slot="5618891265"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div><a class="u-url" href="/2017/java%E5%AF%B9excel%E8%A1%A8%E6%A0%BC%E7%9A%84%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD%E5%A4%84%E7%90%86.html" hidden></a>
</article>
<div class="PageNavigation">
  
  <a class="prev" href="/2017/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3javaruntimeareajava%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.html">&laquo; 深入理解Java Runtime Area Java运行时数据区</a>
  
  
  <a class="next" href="/2017/%E4%BD%BF%E7%94%A8springcloud%E5%92%8Cdocker%E6%9E%84%E5%BB%BA%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84.html">使用Spring Cloud和Docker构建微服务架构 &raquo;</a>
  
</div>
<div class="sfix"><!-- 240x600 -->
<div class="fixedme">
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9477174171188196" data-ad-slot="9597600460"
        data-ad-format="auto"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
<script type="text/javascript">
    function offset(target) {
        var top = 0,
            left = 0

        while (target.offsetParent) {
            top += target.offsetTop
            left += target.offsetLeft
            target = target.offsetParent
        }

        return {
            top: top,
            left: left,
        }
    }
    window.onload = function () {
        var e = document.getElementsByClassName('sfix')[0];
        e.offset = offset(e);

        window.onscroll = function (event) {
            var e = document.getElementsByClassName('sfix')[0];
            if (window.pageYOffset && e.offset && window.pageYOffset > e.offset.top) {
                e.style.position = 'fixed';
                e.style.left = e.offset.left + 'px';
                e.style.right = 'auto';


            } else {
                e.style.position = 'absolute';
                e.style.left = 'auto';
                e.style.right = '-240px';

            }
        }
    }

</script></div>

<style>
  .wrapper {
    position: relative;
  }

  .sfix {
    position: absolute;
    top: 0;
    right: -240px;
    width: 240px;
    height: 600px;
  }

  .PageNavigation {
    font-size: 14px;
    display: block;
    width: auto;
    overflow: hidden;
    clear: both;
  }

  .PageNavigation a {
    display: block;
    width: 50%;
    float: left;
    margin: 1em 0;
  }

  .PageNavigation .next {
    text-align: right;
    float: right;
  }
</style>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Java面试</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Java面试</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
