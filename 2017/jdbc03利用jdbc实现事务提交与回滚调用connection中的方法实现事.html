<!-- build time:Sat Oct 27 2018 21:00:20 GMT+0800 (CST) --><!DOCTYPE html><html class="theme-next muse use-motion"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="description" content="1 Connection中的重用方法2 JDBC事务管理经典案例1 Connection类中常用的方法回顾　　1.1 Statement createStatement() throws SQLException;创建一个Statement实例（即：创建一个SQL执行对象）　　1.2 PreparedStatement prepareStatement(String sql) throws SQL"><meta name="keywords" content="JAVA,面试"><meta property="og:type" content="article"><meta property="og:title" content="JDBC03 利用JDBC实现事务提交与回滚【调用Connection中的方法实现事务管理】"><meta property="og:url" content="http://www.jfox.info/2017/jdbc03利用jdbc实现事务提交与回滚调用connection中的方法实现事.html"><meta property="og:site_name" content="java面试"><meta property="og:description" content="1 Connection中的重用方法2 JDBC事务管理经典案例1 Connection类中常用的方法回顾　　1.1 Statement createStatement() throws SQLException;创建一个Statement实例（即：创建一个SQL执行对象）　　1.2 PreparedStatement prepareStatement(String sql) throws SQL"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.jfox.info/2017/1133/5173d98.png"><meta property="og:image" content="http://www.jfox.info/2017/1133/6b4fc56.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/07/1499444663.gif"><meta property="og:image" content="http://www.jfox.info/2017/1133/6b4fc56.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/07/1499444663.gif"><meta property="og:image" content="http://www.jfox.info/2017/1133/6b4fc56.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/07/1499444663.gif"><meta property="og:image" content="http://www.jfox.info/2017/1133/6b4fc56.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/07/1499444663.gif"><meta property="og:image" content="http://www.jfox.info/2017/1133/6b4fc56.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/07/1499444663.gif"><meta property="og:image" content="http://www.jfox.info/2017/1133/6b4fc56.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/07/1499444663.gif"><meta property="og:image" content="http://www.jfox.info/2017/1133/6b4fc56.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/07/1499444663.gif"><meta property="og:image" content="http://www.jfox.info/2017/1133/6b4fc56.gif"><meta property="og:image" content="http://www.jfox.info/wp-content/uploads/2017/07/1499444663.gif"><meta property="og:updated_time" content="2018-10-27T12:29:39.342Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="JDBC03 利用JDBC实现事务提交与回滚【调用Connection中的方法实现事务管理】"><meta name="twitter:description" content="1 Connection中的重用方法2 JDBC事务管理经典案例1 Connection类中常用的方法回顾　　1.1 Statement createStatement() throws SQLException;创建一个Statement实例（即：创建一个SQL执行对象）　　1.2 PreparedStatement prepareStatement(String sql) throws SQL"><meta name="twitter:image" content="http://www.jfox.info/2017/1133/5173d98.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.jfox.info/2017/jdbc03利用jdbc实现事务提交与回滚调用connection中的方法实现事.html"><title>JDBC03 利用JDBC实现事务提交与回滚【调用Connection中的方法实现事务管理】 | java面试</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">java面试</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.jfox.info/2017/jdbc03利用jdbc实现事务提交与回滚调用connection中的方法实现事.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hello"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="java面试"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">JDBC03 利用JDBC实现事务提交与回滚【调用Connection中的方法实现事务管理】</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-01T23:53:53+08:00">2017-01-01</time></span></div></header><div class="post-body" itemprop="articleBody"><p>1 Connection中的重用方法</p><p>2 JDBC事务管理经典案例</p><h2 id="1-Connection类中常用的方法回顾"><a href="#1-Connection类中常用的方法回顾" class="headerlink" title="1 Connection类中常用的方法回顾"></a>1 Connection类中常用的方法回顾</h2><h3 id="1-1-Statement-createStatement-throws-SQLException"><a href="#1-1-Statement-createStatement-throws-SQLException" class="headerlink" title="　　1.1 Statement createStatement() throws SQLException;"></a>　　1.1 Statement createStatement() throws SQLException;</h3><p>创建一个Statement实例（即：创建一个SQL执行对象）</p><h3 id="1-2-PreparedStatement-prepareStatement-String-sql-throws-SQLException"><a href="#1-2-PreparedStatement-prepareStatement-String-sql-throws-SQLException" class="headerlink" title="　　1.2 PreparedStatement prepareStatement(String sql) throws SQLException;"></a>　　1.2 PreparedStatement prepareStatement(String sql) throws SQLException;</h3><p>创建一个PreparedStatement对象（即：创建一个预编译SQL执行对象）</p><h3 id="1-3-void-setAutoCommit-boolean-autoCommit-throws-SQLException"><a href="#1-3-void-setAutoCommit-boolean-autoCommit-throws-SQLException" class="headerlink" title="　　1.3 void setAutoCommit(boolean autoCommit) throws SQLException;"></a>　　1.3 void setAutoCommit(boolean autoCommit) throws SQLException;</h3><p>设置事务的自动提交（false为关闭自动提交，true为启动自动提交）</p><h3 id="1-4-void-commit-throws-SQLException"><a href="#1-4-void-commit-throws-SQLException" class="headerlink" title="　　1.4 void commit() throws SQLException;"></a>　　1.4 void commit() throws SQLException;</h3><p>手动提交事务</p><h3 id="1-5-void-rollback-throws-SQLException"><a href="#1-5-void-rollback-throws-SQLException" class="headerlink" title="　　1.5 void rollback() throws SQLException;"></a>　　1.5 void rollback() throws SQLException;</h3><p>手动回滚事务</p><h2 id="2-需要用到事务回滚的经典案例：银行转账案例"><a href="#2-需要用到事务回滚的经典案例：银行转账案例" class="headerlink" title="2 需要用到事务回滚的经典案例：银行转账案例"></a>2 需要用到事务回滚的经典案例：银行转账案例</h2><p>转出和转入是一个事务，如果转出成功但是转入失败的会就需要进行事务回滚，否则就出出现转出者余额减少但是转入者余额没有增加</p><p>注意：事务的提交与回滚是通过Connection提供的方法来调用的;本质上事务还是依赖数据库的实现；Connection的方法实质上也是调用了数据库事务机制.</p><p>2.1 不使用事务控制的转账业务</p><p>缺点：如果转入成功，但是转入失败的话，会造成转出者余额减少，但是转入者余额不变</p><p>项目结构图</p><p><img src="/2017/1133/5173d98.png" alt=""><br><img src="/2017/1133/6b4fc56.gif" alt=""><img src="/wp-content/uploads/2017/07/1499444663.gif" alt=""><br>1package cn.xiangxu.entity;<br>2 3import java.sql.Connection;<br>4import java.sql.PreparedStatement;<br>5import java.util.Scanner;<br>6 7import cn.xiangxu.tools.DBUtil;<br>8 9publicclass Test {<br>10publicstaticvoid main(String[] args) {<br>11 Scanner scanner = new Scanner(System.in);<br>12 System.out.println(“请输入转出用户名：”);<br>13 String outName = scanner.nextLine();<br>14 System.out.println(“请输入需要转出的资金额度：”);<br>15 Double money = Double.parseDouble(scanner.nextLine());<br>16 System.out.println(“请输入转入用户名：”);<br>17 String inName = scanner.nextLine();<br>18 System.out.println(“转出账户为：” + outName + “转出金额为：” + money + “转入账户为：” + inName);<br>192021 Connection conn = null;<br>22try {<br>23 conn = DBUtil.getConnection(); // 实例化连接对象<br>2425// conn.setAutoCommit(false); // 关闭自动提交事务功能2627 String sql = “UPDATE client “<br>28 + “SET account = account - ? “<br>29 + “WHERE name = ? “;<br>30 PreparedStatement ps = conn.prepareStatement(sql);<br>31 ps.setDouble(1, money);<br>32 ps.setString(2, outName);<br>33 Integer rs = ps.executeUpdate();<br>34if(rs &gt; 0) {<br>35 System.out.println(“转出成功”);<br>36 } else {<br>37 System.out.println(“转出失败”);<br>38return; // 转出失败跳出函数，不再执行下面的语句；但是finally中的语句还是会执行的，因为就算天塌下来finally中的语句都会执行39 }<br>4041 System.out.println(“======分割线=======”);<br>4243 String sql_in = “UPDATE client “<br>44 + “SET account = account + ? “<br>45 + “WHERE name = ? “;<br>46 PreparedStatement ps_in = conn.prepareStatement(sql_in);<br>47 ps_in.setDouble(1, money);<br>48 ps_in.setString(2, inName);<br>49 Integer judge_in = ps_in.executeUpdate();<br>50if(judge_in &gt; 0) {<br>51 System.out.println(“转入成功”);<br>52// conn.commit(); // 转出、转入都成功就提交事务53 } else {<br>54 System.out.println(“转入失败”);<br>55// conn.rollback(); // 转出成功、转入失败就回滚事务56 }<br>5758// conn.setAutoCommit(true); // 打开自动提交事务5960 } catch (Exception e) {<br>61// TODO Auto-generated catch block62 e.printStackTrace();<br>63 } finally {<br>64 System.out.println(“我是finally中的语句哟”);<br>65try {<br>66 DBUtil.closeConnection();<br>67 } catch (Exception e) {<br>68// TODO Auto-generated catch block69 e.printStackTrace();<br>70 }<br>71 }<br>72 }<br>73 }</p><p>转账业务java源代码<img src="/2017/1133/6b4fc56.gif" alt=""><img src="/wp-content/uploads/2017/07/1499444663.gif" alt=""><br>1CREATE TABLE client (<br>2 id INT (10) PRIMARY KEY,<br>3 name VARCHAR (10),<br>4 pwd VARCHAR (10),<br>5 account INT (20)<br>6 );</p><p>SQL语句<img src="/2017/1133/6b4fc56.gif" alt=""><img src="/wp-content/uploads/2017/07/1499444663.gif" alt=""><br>1package cn.xiangxu.tools;<br>2 3import java.io.IOException;<br>4import java.io.InputStream;<br>5import java.sql.Connection;<br>6import java.sql.SQLException;<br>7import java.util.Properties;<br>8 9import org.apache.commons.dbcp.BasicDataSource;<br>1011publicclass DBUtil {<br>12/<em>13 </em>ThreadLocal用于线程跨方法共享数据使用<br>14 <em>ThreadLocal内部有一个Map, key为需要共享数据的线程本身,value就是其需要共享的数据<br>15</em>/16privatestatic ThreadLocal<connection>tl; // 声明一个类似于仓库的东西17privatestatic BasicDataSource dataSource; // 声明一个数据库连接池对象<br>1819// 静态代码块，在类加载的时候执行，而且只执行一次20static {<br>21 tl = new ThreadLocal<connection>(); // 实例化仓库对象22 dataSource = new BasicDataSource(); // 实例数据库连接池对象2324 Properties prop = new Properties(); // 创建一个Properties对象用（该对象可以用来加载配置文件中的属性列表）25 InputStream is = DBUtil.class.getClassLoader().getResourceAsStream(“config/mysql.properties”); // 读取配置文件信息26try {<br>27 prop.load(is); // 加载配置文件中的属性列表2829 String driverClassName = prop.getProperty(“driverClassName”); // 获取属性信息30 String url = prop.getProperty(“url”);<br>31 String username = prop.getProperty(“username”);<br>32 String password = prop.getProperty(“password”);<br>33 Integer maxActive = Integer.parseInt(prop.getProperty(“maxActive”));<br>34 Integer maxWait = Integer.parseInt(prop.getProperty(“maxWait”));<br>3536 dataSource.setDriverClassName(driverClassName); // 初始化数据库连接池（即：配置数据库连接池的先关参数）37 dataSource.setUrl(url);<br>38 dataSource.setUsername(username);<br>39 dataSource.setPassword(password);<br>40 dataSource.setMaxActive(maxActive);<br>41 dataSource.setMaxWait(maxWait);<br>4243 is.close(); // 关闭输入流，释放资源44 } catch (IOException e) {<br>45// TODO Auto-generated catch block46 e.printStackTrace();<br>47 }<br>4849 }<br>5051/<strong>52 <em>创建连接对象（注意：静态方法可以直接通过类名来调用）<br>53 </em>@return 连接对象<br>54 <em>@throws Exception<br>55</em>/56publicstatic Connection getConnection() throws Exception {<br>57try {<br>58 Connection conn = dataSource.getConnection(); // 创建连接对象（利用数据库连接池进行创建）59 tl.set(conn); // 将连接对象放到仓库中60return conn;<br>61 } catch (Exception e) {<br>62// TODO Auto-generated catch block63 e.printStackTrace();<br>64throw e;<br>65 }<br>66 }<br>6768/</strong>69 <em>关闭连接对象（注意：静态方法可以通过类名直接调用）<br>70 </em>@throws Exception<br>71*/72publicstaticvoid closeConnection() throws Exception {<br>73 Connection conn = tl.get(); // 从仓库中取出连接对象74 tl.remove(); // 清空仓库75if(conn != null) { // 判断连接对象是否释放资源76try {<br>77 conn.close();<br>78 } catch (Exception e) {<br>79// TODO Auto-generated catch block80 e.printStackTrace();<br>81throw e;<br>82 }<br>83 }<br>84 }<br>8586 }</connection></connection></p><p>数据库连接池的java源代码<img src="/2017/1133/6b4fc56.gif" alt=""><img src="/wp-content/uploads/2017/07/1499444663.gif" alt=""><br>1# zhe shi zhu shi , yi ban bu yong zhong wen<br>2# deng hao liang bian mei you kong ge, mo wei mei you fen hao<br>3# hou mian bu neng you kong ge<br>4driverClassName=com.mysql.jdbc.Driver<br>5url=jdbc:mysql://localhost:3306/test<br>6username=root<br>7password=182838<br>8maxActive=100<br>9 maxWait=3000</p><p>数据库信息文件<img src="/2017/1133/6b4fc56.gif" alt=""><img src="/wp-content/uploads/2017/07/1499444663.gif" alt=""><br>1<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">2<modelversion>4.0.0</modelversion>3<groupid>cn.xiangxu</groupid>4<artifactid>testJDBC</artifactid>5<version>0.0.1-SNAPSHOT</version>6<dependencies>7<dependency>8<groupid>mysql</groupid>9<artifactid>mysql-connector-java</artifactid>10<version>5.1.37</version>11</dependency>12<dependency>13<groupid>junit</groupid>14<artifactid>junit</artifactid>15<version>4.12</version>16</dependency>17<dependency>18<groupid>commons-dbcp</groupid>19<artifactid>commons-dbcp</artifactid>20<version>1.4</version>21</dependency>22</dependencies>23</project></p><p>maven依赖文件</p><h3 id="2-2-利用事务控制的转账业务"><a href="#2-2-利用事务控制的转账业务" class="headerlink" title="　　2.2 利用事务控制的转账业务"></a>　　2.2 利用事务控制的转账业务</h3><p><img src="/2017/1133/6b4fc56.gif" alt=""><img src="/wp-content/uploads/2017/07/1499444663.gif" alt=""><br>1package cn.xiangxu.entity;<br>2 3import java.sql.Connection;<br>4import java.sql.PreparedStatement;<br>5import java.sql.SQLException;<br>6import java.util.Scanner;<br>7 8import cn.xiangxu.tools.DBUtil;<br>910publicclass Test {<br>11publicstaticvoid main(String[] args) {<br>12 Scanner scanner = new Scanner(System.in);<br>13 System.out.println(“请输入转出用户名：”);<br>14 String outName = scanner.nextLine();<br>15 System.out.println(“请输入需要转出的资金额度：”);<br>16 Double money = Double.parseDouble(scanner.nextLine());<br>17 System.out.println(“请输入转入用户名：”);<br>18 String inName = scanner.nextLine();<br>19 System.out.println(“转出账户为：” + outName + “转出金额为：” + money + “转入账户为：” + inName);<br>202122 Connection conn = null;<br>23try {<br>24 conn = DBUtil.getConnection(); // 实例化连接对象2526 conn.setAutoCommit(false); // 关闭自动提交事务功能2728 String sql = “UPDATE client “<br>29 + “SET account = account - ? “<br>30 + “WHERE name = ? “;<br>31 PreparedStatement ps = conn.prepareStatement(sql);<br>32 ps.setDouble(1, money);<br>33 ps.setString(2, outName);<br>34 Integer rs = ps.executeUpdate();<br>35if(rs &gt; 0) {<br>36 System.out.println(“转出成功”);<br>37 } else {<br>38 System.out.println(“转出失败”);<br>39return; // 转出失败跳出函数，不再执行下面的语句；但是finally中的语句还是会执行的，因为就算天塌下来finally中的语句都会执行40 }<br>4142 System.out.println(“======分割线=======”);<br>4344 String sql_in = “UPDATE client “<br>45 + “SET account = account + ? “<br>46 + “WHERE name = ? “;<br>47 PreparedStatement ps_in = conn.prepareStatement(sql_in);<br>48 ps_in.setDouble(1, money);<br>49 ps_in.setString(2, inName);<br>50 Integer judge_in = ps_in.executeUpdate();<br>51if(judge_in &gt; 0) {<br>52 System.out.println(“转入成功”);<br>53 conn.commit(); // 转出、转入都成功就提交事务54 } else {<br>55 System.out.println(“转入失败”);<br>56 conn.rollback(); // 转出成功、转入失败就回滚事务57 }<br>5859 conn.setAutoCommit(true); // 打开自动提交事务6061 } catch (Exception e) {<br>62// TODO Auto-generated catch block63try {<br>64 conn.rollback(); // 捕获到异常后也需要进行事务回滚65 } catch (SQLException e1) {<br>66// TODO Auto-generated catch block67 e1.printStackTrace();<br>68 }<br>69 e.printStackTrace();<br>70 } finally {<br>71 System.out.println(“我是finally中的语句哟”);<br>72try {<br>73 DBUtil.closeConnection();<br>74 } catch (Exception e) {<br>75// TODO Auto-generated catch block76 e.printStackTrace();<br>77 }<br>78 }<br>79 }<br>80 }</p><p>转账业务的java源代码</p><h3 id="2-3-将关闭自动提交功能、手动提交功能、手动回滚功能封装到一个类中"><a href="#2-3-将关闭自动提交功能、手动提交功能、手动回滚功能封装到一个类中" class="headerlink" title="　　2.3 将关闭自动提交功能、手动提交功能、手动回滚功能封装到一个类中"></a>　　2.3 将关闭自动提交功能、手动提交功能、手动回滚功能封装到一个类中</h3><p><img src="/2017/1133/6b4fc56.gif" alt=""><img src="/wp-content/uploads/2017/07/1499444663.gif" alt=""><br>1package cn.xiangxu.tools;<br>2 3import java.io.IOException;<br>4import java.io.InputStream;<br>5import java.sql.Connection;<br>6import java.sql.SQLException;<br>7import java.util.Properties;<br>8 9import org.apache.commons.dbcp.BasicDataSource;<br>10 11publicclass DBUtil {<br>12/<em> 13 </em>ThreadLocal用于线程跨方法共享数据使用<br>14 <em>ThreadLocal内部有一个Map, key为需要共享数据的线程本身,value就是其需要共享的数据<br>15</em>/ 16privatestatic ThreadLocal<connection>tl; // 声明一个类似于仓库的东西 17privatestatic BasicDataSource dataSource; // 声明一个数据库连接池对象<br>18 19// 静态代码块，在类加载的时候执行，而且只执行一次 20static {<br>21 tl = new ThreadLocal<connection>(); // 实例化仓库对象 22 dataSource = new BasicDataSource(); // 实例数据库连接池对象 23 24 Properties prop = new Properties(); // 创建一个Properties对象用（该对象可以用来加载配置文件中的属性列表） 25 InputStream is = DBUtil.class.getClassLoader().getResourceAsStream(“config/mysql.properties”); // 读取配置文件信息 26try {<br>27 prop.load(is); // 加载配置文件中的属性列表 28 29 String driverClassName = prop.getProperty(“driverClassName”); // 获取属性信息 30 String url = prop.getProperty(“url”);<br>31 String username = prop.getProperty(“username”);<br>32 String password = prop.getProperty(“password”);<br>33 Integer maxActive = Integer.parseInt(prop.getProperty(“maxActive”));<br>34 Integer maxWait = Integer.parseInt(prop.getProperty(“maxWait”));<br>35 36 dataSource.setDriverClassName(driverClassName); // 初始化数据库连接池（即：配置数据库连接池的先关参数） 37 dataSource.setUrl(url);<br>38 dataSource.setUsername(username);<br>39 dataSource.setPassword(password);<br>40 dataSource.setMaxActive(maxActive);<br>41 dataSource.setMaxWait(maxWait);<br>42 43 is.close(); // 关闭输入流，释放资源 44 } catch (IOException e) {<br>45// TODO Auto-generated catch block 46 e.printStackTrace();<br>47 }<br>48 49 }<br>50 51/<strong> 52 <em>创建连接对象（注意：静态方法可以直接通过类名来调用）<br>53 </em>@return 连接对象<br>54 <em>@throws Exception<br>55</em>/ 56publicstatic Connection getConnection() throws Exception {<br>57try {<br>58 Connection conn = dataSource.getConnection(); // 创建连接对象（利用数据库连接池进行创建） 59 tl.set(conn); // 将连接对象放到仓库中 60return conn;<br>61 } catch (Exception e) {<br>62// TODO Auto-generated catch block 63 e.printStackTrace();<br>64throw e;<br>65 }<br>66 }<br>67 68/</strong> 69 <em>关闭连接对象（注意：静态方法可以通过类名直接调用）<br>70 </em>@throws Exception<br>71<em>/ 72publicstaticvoid closeConnection() throws Exception {<br>73 Connection conn = tl.get(); // 从仓库中取出连接对象 74 tl.remove(); // 清空仓库 75if(conn != null) { // 判断连接对象是否释放资源 76try {<br>77 conn.close();<br>78 } catch (Exception e) {<br>79// TODO Auto-generated catch block 80 e.printStackTrace();<br>81throw e;<br>82 }<br>83 }<br>84 }<br>85 86/** 87 </em>在执行SQL语句前关闭JDBC的自动提交事务功能<br>88 <em>@throws SQLException<br>89</em>/ 90publicstaticvoid tansBegin() throws SQLException {<br>91try {<br>92 tl.get().setAutoCommit(false); // 从仓库中获取连接对象并调用setAutoCommit来关闭自动提交事务功能 93 } catch(SQLException e) {<br>94 e.printStackTrace();<br>95throw e;<br>96 }<br>97 }<br>98 99/<strong>100 <em>手动回滚功能<br>101 </em>@throws SQLException<br>102*/103publicstaticvoid transBack() throws SQLException {<br>104 tl.get().rollback(); // 从仓库中获取连接对象并调用rollback来实现事务回滚操作105 tl.get().setAutoCommit(true); // 回滚启动事务自动提交功能106 }<br>107108/</strong>109 <em>手动提交功能<br>110 </em>@throws SQLException<br>111*/112publicstaticvoid transCommit() throws SQLException {<br>113 tl.get().commit(); // 从仓库中获取连接对象并调用commit来实现事务提交操作114 tl.get().setAutoCommit(true); // 提交后启动事务自动提交功能115 }<br>116117 }</connection></connection></p><p>DBUtil<img src="/2017/1133/6b4fc56.gif" alt=""><img src="/wp-content/uploads/2017/07/1499444663.gif" alt=""><br>1package cn.xiangxu.entity;<br>2 3import java.sql.Connection;<br>4import java.sql.PreparedStatement;<br>5import java.sql.SQLException;<br>6import java.util.Scanner;<br>7 8import cn.xiangxu.tools.DBUtil;<br>910publicclass Test {<br>11publicstaticvoid main(String[] args) {<br>12 Scanner scanner = new Scanner(System.in);<br>13 System.out.println(“请输入转出用户名：”);<br>14 String outName = scanner.nextLine();<br>15 System.out.println(“请输入需要转出的资金额度：”);<br>16 Double money = Double.parseDouble(scanner.nextLine());<br>17 System.out.println(“请输入转入用户名：”);<br>18 String inName = scanner.nextLine();<br>19 System.out.println(“转出账户为：” + outName + “转出金额为：” + money + “转入账户为：” + inName);<br>202122 Connection conn = null;<br>23try {<br>24 conn = DBUtil.getConnection(); // 实例化连接对象2526 DBUtil.tansBegin(); // 关闭自动提交事务功能2728 String sql = “UPDATE client “<br>29 + “SET account = account - ? “<br>30 + “WHERE name = ? “;<br>31 PreparedStatement ps = conn.prepareStatement(sql);<br>32 ps.setDouble(1, money);<br>33 ps.setString(2, outName);<br>34 Integer rs = ps.executeUpdate();<br>35if(rs &gt; 0) {<br>36 System.out.println(“转出成功”);<br>37 } else {<br>38 System.out.println(“转出失败”);<br>39return; // 转出失败跳出函数，不再执行下面的语句；但是finally中的语句还是会执行的，因为就算天塌下来finally中的语句都会执行40 }<br>4142 System.out.println(“======分割线=======”);<br>4344 String sql_in = “UPDATE client “<br>45 + “SET account = account + ? “<br>46 + “WHERE name = ? “;<br>47 PreparedStatement ps_in = conn.prepareStatement(sql_in);<br>48 ps_in.setDouble(1, money);<br>49 ps_in.setString(2, inName);<br>50 Integer judge_in = ps_in.executeUpdate();<br>51if(judge_in &gt; 0) {<br>52 System.out.println(“转入成功”);<br>53 DBUtil.transCommit(); // 转出、转入都成功就提交事务54 } else {<br>55 System.out.println(“转入失败”);<br>56 DBUtil.transBack(); // 转出成功、转入失败就回滚事务57 }<br>5859 } catch (Exception e) {<br>60// TODO Auto-generated catch block61try {<br>62 DBUtil.transBack();// 捕获到异常后也需要进行事务回滚63 } catch (SQLException e1) {<br>64// TODO Auto-generated catch block65 e1.printStackTrace();<br>66 }<br>67 e.printStackTrace();<br>68 } finally {<br>69 System.out.println(“我是finally中的语句哟”);<br>70try {<br>71 DBUtil.closeConnection();<br>72 } catch (Exception e) {<br>73// TODO Auto-generated catch block74 e.printStackTrace();<br>75 }<br>76 }<br>77 }<br>78 }</p></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="4142158067"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div style="width:300px;height:250px;float:left"><ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9477174171188196" data-ad-slot="5618891265"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/comparatorcomparable小总结.html" rel="next" title="【comparator, comparable】小总结"><i class="fa fa-chevron-left"></i> 【comparator, comparable】小总结</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/棋牌源码开发牛牛算法思路.html" rel="prev" title="棋牌源码开发-牛牛算法思路">棋牌源码开发-牛牛算法思路 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">Overview</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Hello</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">1358</span> <span class="site-state-item-name">posts</span></a></div></nav></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Connection类中常用的方法回顾"><span class="nav-number">1.</span> <span class="nav-text">1 Connection类中常用的方法回顾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-Statement-createStatement-throws-SQLException"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 Statement createStatement() throws SQLException;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-PreparedStatement-prepareStatement-String-sql-throws-SQLException"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 PreparedStatement prepareStatement(String sql) throws SQLException;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-void-setAutoCommit-boolean-autoCommit-throws-SQLException"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 void setAutoCommit(boolean autoCommit) throws SQLException;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-void-commit-throws-SQLException"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 void commit() throws SQLException;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-void-rollback-throws-SQLException"><span class="nav-number">1.5.</span> <span class="nav-text">1.5 void rollback() throws SQLException;</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-需要用到事务回滚的经典案例：银行转账案例"><span class="nav-number">2.</span> <span class="nav-text">2 需要用到事务回滚的经典案例：银行转账案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-利用事务控制的转账业务"><span class="nav-number">2.1.</span> <span class="nav-text">2.2 利用事务控制的转账业务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-将关闭自动提交功能、手动提交功能、手动回滚功能封装到一个类中"><span class="nav-number">2.2.</span> <span class="nav-text">2.3 将关闭自动提交功能、手动提交功能、手动回滚功能封装到一个类中</span></a></li></ol></li></ol></div></div></section></div></aside><div class="sfix"><div class="fixedme"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9477174171188196" data-ad-slot="9597600460" data-ad-format="auto"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Hello</span></div><div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div><span class="post-meta-divider">|</span><div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script></body></html><!-- rebuild by neat -->